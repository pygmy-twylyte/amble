(
    game: (
        title: "AMBLE: An Absurd Adventure",
        intro: "\nYou find yourself standing on a rocky outcrop of a ridge high in the mountains -- maybe the Andes? Emerging from a daze, you realize you were brought here and dropped off by some sort of flying vehicle. When it flew off, it didn\'t make a sound. Did it have a motor, or was it something different?\n\nYour head gradually begins to clear, and you start to take stock of your surroundings...\n\n(type \"help\" for basic instructions)\n",
        player: (
            name: "The Candidate",
            description: "a seasoned adventurer with a faint memory of a promised cake that has gone unfulfilled.",
            start_room: "high-ridge",
            max_hp: 20,
        ),
        scoring: (
            report_title: "Candidate Evaluation Report",
            ranks: [
                (
                    threshold: 99.0,
                    name: "Quantum Overachiever",
                    description: "You saw the multiverse, understood it, then filed a bug report.",
                ),
                (
                    threshold: 90.0,
                    name: "Senior Field Operative",
                    description: "A nearly flawless run. Someone give this candidate a promotion.",
                ),
                (
                    threshold: 75.0,
                    name: "Licensed Reality Bender",
                    description: "Impressive grasp of nonlinear environments and cake-based paradoxes.",
                ),
                (
                    threshold: 60.0,
                    name: "Rogue Intern, Level II",
                    description: "You got the job done, and only melted one small pocket universe.",
                ),
                (
                    threshold: 45.0,
                    name: "Unpaid Research Assistant",
                    description: "Solid effort. Some concepts may have slipped through dimensional cracks.",
                ),
                (
                    threshold: 30.0,
                    name: "Junior Sandwich Technician",
                    description: "Good instincts, questionable execution. Especially with condiments.",
                ),
                (
                    threshold: 15.0,
                    name: "Volunteer Tour Guide",
                    description: "You wandered. You looked at stuff. It was something.",
                ),
                (
                    threshold: 5.0,
                    name: "Mailbox Stuffing Trainee",
                    description: "You opened a box, tripped on a rug, and called it a day.",
                ),
                (
                    threshold: 1.0,
                    name: "Accidental Hire",
                    description: "We\'re not sure how you got in. Please return your lanyard.",
                ),
                (
                    threshold: 0.0,
                    name: "Amnesiac Test Subject",
                    description: "Did you... play? Were you even awake?",
                ),
            ],
        ),
    ),
    rooms: [
        (
            id: "aperture-lab",
            name: "Aperture Science Laboratory",
            desc: "The unnaturally white walls, floor, ceiling, even the air here feels clinical and overexposed. Everything hums at a frequency designed to encourage strict compliance. A single console blinks on a table beside a [[b]]highly[[/b]] over-engineered printer labeled [[blue]][[i]]\"Aperture Science Hospitality Generator.\"[[/i]][[/blue]] Across the room, a vault-like door stands open revealing a dim -- but much larger -- chamber beyond.",
            visited: false,
            exits: [
                (
                    direction: "through the portal",
                    to: "portal-room",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
                (
                    direction: "into the vault",
                    to: "stargate-room",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
            ],
            overlays: [
                (
                    conditions: [
                        flagSet(
                            flag: "burned-invitation",
                        ),
                        flagUnset(
                            flag: "invitation-sans-ignition",
                        ),
                    ],
                    text: "A smoky haze and the lingering smell of burned paper permeate the room.",
                ),
                (
                    conditions: [
                        flagSet(
                            flag: "lab-fire-raging",
                        ),
                    ],
                    text: "Flames leap from foamy surfaces around you, while the sprinklers try in vain to douse the oily residue!",
                ),
                (
                    conditions: [
                        flagComplete(
                            flag: "foam-fire-in-lab",
                        ),
                        flagUnset(
                            flag: "invitation-sans-ignition",
                        ),
                    ],
                    text: "Charred, soggy and warped lab and office equipment are everywhere. Astoundingly, the printer still seems to be working -- and with a job pending.",
                ),
                (
                    conditions: [
                        flagSet(
                            flag: "invitation-sans-ignition",
                        ),
                    ],
                    text: "The printer is in its 3-day cooldown period, and there are no jobs pending.",
                ),
                (
                    conditions: [
                        itemPresent(
                            item: "invitation",
                        ),
                    ],
                    text: "A glowing, steaming, sizzling invitation engraved on an asbestos sheet sits on the floor in front of the printer.",
                ),
            ],
        ),
        (
            id: "b-a-office",
            name: "Amble Adventures Main Office",
            desc: "The office of [[hl]]Amble Adventures[[/hl]], a wholly [[u]]disowned[[/u]] subsidiary of Brains Anonymous™, is a shrine to barely-funded creativity. Faded posters of games that were never released adorn the walls, including one titled [[b]]\'PONG Construction Set 3000\'[[/b]]. A sagging ficus looms in the corner like it’s been through something. In the north wall, a closet door is marked with a \"Supplies\" sign, hanging at a carefree slant. An Initech™ Poetry Performer machine plays possum in another corner, hoping you don\'t notice it.",
            visited: false,
            exits: [
                (
                    direction: "lobby door",
                    to: "main-lobby",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
                (
                    direction: "closet door",
                    to: "supply-closet",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
            ],
            overlays: [
                (
                    conditions: [
                        flagSet(
                            flag: "panic-room-open",
                        ),
                    ],
                    text: "The [[i]]\"Planning to Plan\"[[/i]] whiteboard has parted to reveal a heavy, vault-like door set into the west wall.",
                ),
                (
                    conditions: [
                        flagUnset(
                            flag: "panic-room-open",
                        ),
                    ],
                    text: "A floor-to-ceiling whiteboard on the west wall boasts an impressive flowchart titled [[i]]\"Planning to Plan\"[[/i]].",
                ),
                (
                    conditions: [
                        flagUnset(
                            flag: "got-visitor-pass",
                        ),
                        playerMissingItem(
                            item: "invitation",
                        ),
                    ],
                    text: "A robotic receptionist sits behind a tidy desk adorned with figurines of Portal turrets and companion cubes. She (it?) pointedly ignores you.",
                ),
                (
                    conditions: [
                        flagUnset(
                            flag: "got-visitor-pass",
                        ),
                        playerHasItem(
                            item: "invitation",
                        ),
                    ],
                    text: "The receptionist, sensing something, tries furtively to see what you have in your pack.",
                ),
                (
                    conditions: [
                        flagSet(
                            flag: "got-visitor-pass",
                        ),
                    ],
                    text: "The receptionist looks up from rearranging her turrets, giving you a subtle wink and a grin.",
                ),
                (
                    conditions: [
                        flagSet(
                            flag: "lost-and-found-opened",
                        ),
                    ],
                    text: "The Lost & Found box sits with its lid hanging open, contents plainly visible.",
                ),
                (
                    conditions: [
                        flagUnset(
                            flag: "lost-and-found-opened",
                        ),
                    ],
                    text: "A sturdy locked box sits behind the desk, marked [[b]]Lost & Found[[/b]].",
                ),
            ],
        ),
        (
            id: "lift-bank-main",
            name: "Elevator Bank (Main Floor)",
            desc: "A bank of elevators waits here, none of which seem eager to go anywhere. One of them is open and labeled \'MAIN LIFT\' in glowing teal script.  To the east, a door marked \'LOUNGE\' is just slightly ajar, as if luring you to come in. The lobby is still visible through the archway south.",
            visited: false,
            exits: [
                (
                    direction: "into the elevator",
                    to: "lift-main",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
                (
                    direction: "to the lounge",
                    to: "lounge",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
                (
                    direction: "through the archway",
                    to: "main-lobby",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
            ],
            overlays: [
                (
                    conditions: [
                        flagSet(
                            flag: "got-elevator-keycard",
                        ),
                    ],
                    text: "The proximity card reader next to the lift now somewhat sheepishly displays: ACCESS GRANTED.",
                ),
                (
                    conditions: [
                        flagUnset(
                            flag: "got-elevator-keycard",
                        ),
                    ],
                    text: "The proximity card reader next to the lift displays: ACCESS DENIED -- and with no sympathy whatsoever.",
                ),
                (
                    conditions: [
                        npcPresent(
                            npc: "gonk_droid",
                        ),
                        npcInState(
                            npc: "gonk_droid",
                            state: normal,
                        ),
                    ],
                    text: "A gonk droid pokes at the elevator call panel, emitting perplexed gonks.",
                ),
                (
                    conditions: [
                        npcPresent(
                            npc: "gonk_droid",
                        ),
                        npcInState(
                            npc: "gonk_droid",
                            state: happy,
                        ),
                    ],
                    text: "The gonk droid hums a cheerful gonk as it watches the lift lights blink.",
                ),
                (
                    conditions: [
                        npcPresent(
                            npc: "cmot_dibbler",
                        ),
                        npcInState(
                            npc: "cmot_dibbler",
                            state: normal,
                        ),
                    ],
                    text: "Dibbler loiters by the elevators, promising snacks for the ride.",
                ),
                (
                    conditions: [
                        npcPresent(
                            npc: "cmot_dibbler",
                        ),
                        npcInState(
                            npc: "cmot_dibbler",
                            state: happy,
                        ),
                    ],
                    text: "Dibbler beams, certain elevator patrons are his best customers.",
                ),
                (
                    conditions: [
                        npcPresent(
                            npc: "cmot_dibbler",
                        ),
                        npcInState(
                            npc: "cmot_dibbler",
                            state: bored,
                        ),
                    ],
                    text: "Dibbler counts his sausages as the lift lights blink listlessly.",
                ),
            ],
        ),
        (
            id: "lift-main",
            name: "Elevator (Main Floor)",
            desc: "The elevator interior is surprisingly luxurious -- polished chrome panels, soft lighting, and a faint scent of something that might be vanilla or data corruption.",
            visited: false,
            exits: [
                (
                    direction: "out to main floor",
                    to: "lift-bank-main",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
            ],
            overlays: [
                (
                    conditions: [
                        flagSet(
                            flag: "got-elevator-keycard",
                        ),
                    ],
                    text: "The [main] and [aa-3] buttons are now both lit -- but [aa-3] flickers and then glows intensely bright intermittently.",
                ),
                (
                    conditions: [
                        flagUnset(
                            flag: "got-elevator-keycard",
                        ),
                    ],
                    text: "There are only two buttons: [main] is lit, but [aa-3] is dark.",
                ),
            ],
        ),
        (
            id: "lounge",
            name: "Coffee Lounge",
            desc: "A small space to relax, with a worn sofa, a ringed coffee table bearing a few magazines, and part of a jigsaw puzzle depicting the USS Enterprise D.",
            visited: false,
            exits: [
                (
                    direction: "lounge door",
                    to: "lift-bank-main",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
            ],
            overlays: [
                (
                    conditions: [
                        itemPresent(
                            item: "lebowski_rug",
                        ),
                    ],
                    text: "An ornate, brick red rug lies in the center of the room and somehow -- really ties the room together.",
                ),
                (
                    conditions: [
                        itemAbsent(
                            item: "lebowski_rug",
                        ),
                    ],
                    text: "The trap door opened in the floor reveals a ladder down to a hidden room below.",
                ),
                (
                    conditions: [
                        flagSet(
                            flag: "lab-fire-raging",
                        ),
                    ],
                    text: "Occasional wisps of black smoke rise from the portal room below.",
                ),
                (
                    conditions: [
                        flagSet(
                            flag: "coffee-ready",
                        ),
                    ],
                    text: "The coffee machine emits a few satisfied clicks as the rich aroma of fresh coffee fills the lounge.",
                ),
                (
                    conditions: [
                        flagUnset(
                            flag: "coffee-ready",
                        ),
                    ],
                    text: "An automatic drip coffee machine stands ready to brew on a small stand in one corner.",
                ),
                (
                    conditions: [
                        npcPresent(
                            npc: "gonk_droid",
                        ),
                        npcInState(
                            npc: "gonk_droid",
                            state: normal,
                        ),
                    ],
                    text: "The gonk droid mills about by the coffee cart, muttering quiet gonks.",
                ),
                (
                    conditions: [
                        npcPresent(
                            npc: "gonk_droid",
                        ),
                        npcInState(
                            npc: "gonk_droid",
                            state: happy,
                        ),
                    ],
                    text: "The gonk droid gonks to an unheard upbeat rhythm by the sofa.",
                ),
                (
                    conditions: [
                        npcPresent(
                            npc: "cmot_dibbler",
                        ),
                        npcInState(
                            npc: "cmot_dibbler",
                            state: normal,
                        ),
                    ],
                    text: "Dibbler lounges here, pitching snacks to passing staff and adventurers.",
                ),
                (
                    conditions: [
                        npcPresent(
                            npc: "cmot_dibbler",
                        ),
                        npcInState(
                            npc: "cmot_dibbler",
                            state: happy,
                        ),
                    ],
                    text: "Dibbler cheerfully offers samples to anyone near the sofa.",
                ),
                (
                    conditions: [
                        npcPresent(
                            npc: "cmot_dibbler",
                        ),
                        npcInState(
                            npc: "cmot_dibbler",
                            state: bored,
                        ),
                    ],
                    text: "Dibbler stares at the coffee pot, wondering if he can sell the used grounds somehow.",
                ),
            ],
        ),
        (
            id: "main-lobby",
            name: "Main Lobby",
            desc: "The lobby is clinically clean in a way that feels suspicious. A slightly humming vending machine stands beside an empty podium bearing an emblem that reads, in gothic script: \'ALLIED TEMPORARY LIFEFORMS\'. A softly glowing sign over an archway on the north wall reads \'Elevator Access\'. To one side, there is floor-to-ceiling frosted glass and a door at the far end etched with [[room]]Amble Adventures - Main Office[[/room]]. Opposite that, the smell of searing beef wafts from a short hallway.",
            visited: false,
            exits: [
                (
                    direction: "elevator access",
                    to: "lift-bank-main",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
                (
                    direction: "outside",
                    to: "front-entrance",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
                (
                    direction: "hallway",
                    to: "restaurant",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
                (
                    direction: "office",
                    to: "b-a-office",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
            ],
            overlays: [
                (
                    conditions: [
                        npcPresent(
                            npc: "gonk_droid",
                        ),
                        npcInState(
                            npc: "gonk_droid",
                            state: normal,
                        ),
                    ],
                    text: "A gonk droid stands idle in the corner, muttering to itself and tottering in circles.",
                ),
                (
                    conditions: [
                        npcPresent(
                            npc: "gonk_droid",
                        ),
                        npcInState(
                            npc: "gonk_droid",
                            state: happy,
                        ),
                    ],
                    text: "The gonk droid gonks a happy tune in the corner, charging the battery you gave it.",
                ),
                (
                    conditions: [
                        npcPresent(
                            npc: "cmot_dibbler",
                        ),
                        npcInState(
                            npc: "cmot_dibbler",
                            state: normal,
                        ),
                    ],
                    text: "C.M.O.T. Dibbler hawks dubious sausages to anyone entering.",
                ),
                (
                    conditions: [
                        npcPresent(
                            npc: "cmot_dibbler",
                        ),
                        npcInState(
                            npc: "cmot_dibbler",
                            state: happy,
                        ),
                    ],
                    text: "Dibbler grins broadly, offering a complimentary bite.",
                ),
                (
                    conditions: [
                        npcPresent(
                            npc: "cmot_dibbler",
                        ),
                        npcInState(
                            npc: "cmot_dibbler",
                            state: bored,
                        ),
                    ],
                    text: "Dibbler mutters about slow lobby sales.",
                ),
            ],
        ),
        (
            id: "patio",
            name: "BLINDING GLARE",
            desc: "You see almost nothing at all, except for a momentary glimpse of a few scattered details before you are blinded. The pure white light here is stare-into-the-sun bright and seems to come from all directions, forcing you to shield your eyes with your arm and flee.",
            visited: false,
            exits: [
                (
                    direction: "west",
                    to: "restaurant",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
            ],
            overlays: [
                (
                    conditions: [
                        playerHasItem(
                            item: "peril_sunglasses",
                        ),
                        flagSet(
                            flag: "patio-gate-open",
                        ),
                    ],
                    text: "The Stargate shimmers off to the side by the kitchen door, its connection to the laboratory still open.",
                ),
                (
                    conditions: [
                        playerHasItem(
                            item: "peril_sunglasses",
                        ),
                        flagUnset(
                            flag: "patio-gate-open",
                        ),
                    ],
                    text: "A large metallic ring stands by the kitchen door. It might be a backdrop for weddings, but it\'s covered in hieroglyphs and other odd symbols -- none of them rings, hearts, doves, or branding irons.",
                ),
            ],
        ),
        (
            id: "poetry-panic",
            name: "Bad Poetry Panic Room",
            desc: "A concrete and titanium vacuum-sealed room equipped with noise generators, active voice-cancelling harmonics and Cone of Silence™ technology. A seal by the door proudly boasts that the chamber is [[i]][[b]]almost[[/b]][[/i]] completely Vogon poetry-proof.",
            visited: false,
            exits: [
                (
                    direction: "Amble office",
                    to: "b-a-office",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
            ],
            overlays: [],
        ),
        (
            id: "portal-room",
            name: "Portal Room",
            desc: "A bare white room with a white tile floor. A ladder leads back up through the trap door in the ceiling. Three of the four walls are used as whiteboards, littered with obscure diagrams and equations. In the center, a black and white Portal gun is affixed to a pedestal and aimed squarely at the fourth wall.",
            visited: false,
            exits: [
                (
                    direction: "up the ladder",
                    to: "lounge",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
            ],
            overlays: [
                (
                    conditions: [
                        flagSet(
                            flag: "portal-gun-powered",
                        ),
                    ],
                    text: "The power indicator on the Portal gun now glows a steady green.",
                ),
                (
                    conditions: [
                        flagSet(
                            flag: "portal-opened",
                        ),
                    ],
                    text: "There is a sparkling blue portal in the fourth wall, with a view through to a laboratory space beyond.",
                ),
                (
                    conditions: [
                        flagUnset(
                            flag: "portal-opened",
                        ),
                    ],
                    text: "A bullseye adorns the fourth, otherwise blank wall. A photo of a watch-sized computer attached to a potato battery is taped in the center, for some reason.",
                ),
                (
                    conditions: [
                        flagSet(
                            flag: "portal-opened",
                        ),
                        flagSet(
                            flag: "lab-fire-raging",
                        ),
                    ],
                    text: "Black smoke and the occasional lick of flame pour through the portal from the laboratory inferno on the other side.",
                ),
            ],
        ),
        (
            id: "restaurant",
            name: "Restaurant at the End of the Universe",
            desc: "Acturan A-POP wafts through invisible speakers, accompanied by the occasional sound of imploding galaxies. A tasteful sign declares this to be the Restaurant at the End of the Universe, though it appears to be between dinner rushes. Tables float slightly above the ground and rearrange themselves when you\'re not looking. A reservation book is here, chained to the host\'s podium. Restrooms lie to the south bearing a sign in fancy script reading:\n[[box:VIP PAN-SPECIES RESTROOM]][[i]](must possess [[item]]visitor pass[[/item]] to enter)[[/i]][[/box]]\nPatio seating stretches farther east.",
            visited: false,
            exits: [
                (
                    direction: "lobby",
                    to: "main-lobby",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
                (
                    direction: "patio seating",
                    to: "patio",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
                (
                    direction: "restroom (WC)",
                    to: "vip-bathroom",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [
                        "visitor_pass",
                    ],
                    barred_message: Some("The door apologizes profusely for refusing to open, explaining that it\'s forced by programming not to let you in without a visitor\'s pass."),
                ),
            ],
            overlays: [
                (
                    conditions: [
                        npcPresent(
                            npc: "cmot_dibbler",
                        ),
                        npcInState(
                            npc: "cmot_dibbler",
                            state: normal,
                        ),
                    ],
                    text: "Dibbler circles the tables, insisting his sausages are a bargain.",
                ),
                (
                    conditions: [
                        npcPresent(
                            npc: "cmot_dibbler",
                        ),
                        npcInState(
                            npc: "cmot_dibbler",
                            state: happy,
                        ),
                    ],
                    text: "Dibbler proclaims today\'s special with exaggerated flair.",
                ),
                (
                    conditions: [
                        npcPresent(
                            npc: "cmot_dibbler",
                        ),
                        npcInState(
                            npc: "cmot_dibbler",
                            state: bored,
                        ),
                    ],
                    text: "Dibbler pokes at an empty table, grumbling about the quiet rush.",
                ),
            ],
        ),
        (
            id: "stargate-room",
            name: "Stargate Room",
            desc: "A hangar-size concrete room, connected to the Aperture lab through a huge, round vault door. Little light reaches the darkened corners of the room, but at its center stands a round control console ringed with hieroglyphs, obscure emojis, and diagrams from IKEA assembly manuals. A giant metallic ring festooned with similar symbols stands on end at the end of the room.\n\nThere are three large buttons in the center of the console:",
            visited: false,
            exits: [
                (
                    direction: "vault door",
                    to: "aperture-lab",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
            ],
            overlays: [
                (
                    conditions: [
                        flagSet(
                            flag: "read-plaque-1",
                        ),
                    ],
                    text: "On the left, shaped like a tree:        [[green]]RAISED[[/green]]",
                ),
                (
                    conditions: [
                        flagUnset(
                            flag: "read-plaque-1",
                        ),
                    ],
                    text: "On the left, shaped like a tree:        [[red]][[dimmed]]sunken[[/dimmed]][[/red]]",
                ),
                (
                    conditions: [
                        flagSet(
                            flag: "read-plaque-2",
                        ),
                    ],
                    text: "In the middle, shaped like a snowflake: [[green]]RAISED[[/green]]",
                ),
                (
                    conditions: [
                        flagUnset(
                            flag: "read-plaque-2",
                        ),
                    ],
                    text: "In the middle, shaped like a snowflake: [[red]][[dimmed]]sunken[[/dimmed]][[/red]]",
                ),
                (
                    conditions: [
                        flagSet(
                            flag: "read-plaque-3",
                        ),
                    ],
                    text: "On the right, shaped like a fork:       [[green]]RAISED[[/green]]",
                ),
                (
                    conditions: [
                        flagUnset(
                            flag: "read-plaque-3",
                        ),
                    ],
                    text: "On the right, shaped like a fork:       [[red]][[dimmed]]sunken[[/dimmed]][[/red]]",
                ),
            ],
        ),
        (
            id: "supply-closet",
            name: "Supply Closet",
            desc: "A small closet lit by a bare bulb being repeatedly rammed by a fluttering moth, near a hole where a bit of the ceiling is coming down. Crowded shelves offer paper products, bottles of toner, staples, and other office... ... staples.",
            visited: false,
            exits: [
                (
                    direction: "south",
                    to: "b-a-office",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
            ],
            overlays: [],
        ),
        (
            id: "vip-bathroom",
            name: "VIP Bathroom",
            desc: "Blinding white tile and pristine mirrors make it almost seem like this pan-gender, pan-species bathroom has never been used, but a lingering asparagus odor suggests otherwise.",
            visited: false,
            exits: [
                (
                    direction: "north",
                    to: "restaurant",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
            ],
            overlays: [
                (
                    conditions: [
                        itemPresent(
                            item: "vogon_poetry_book",
                        ),
                    ],
                    text: "A heavy, heavily stained book sits on the back of the nearest commode.",
                ),
            ],
        ),
        (
            id: "east-of-building",
            name: "East of Building",
            desc: "You’re east of the building now, facing a patch of ornamental gravel and a struggling yucca plant. The air here smells faintly of ozone and buttered lobster, though the source is unclear.\n\nThe side of the building appears to be a normal wall, but you keep glimpsing something that looks like -- patio umbrellas? -- from the corner of your eye. You briefly wonder if the building is bending space or if your sense of geography is just feeling shy.\n\nThe walkway wraps around the building to the northwest and southwest.",
            visited: false,
            exits: [
                (
                    direction: "northwest",
                    to: "loading-dock",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
                (
                    direction: "southwest",
                    to: "front-entrance",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
            ],
            overlays: [
                (
                    conditions: [
                        npcPresent(
                            npc: "cmot_dibbler",
                        ),
                        npcInState(
                            npc: "cmot_dibbler",
                            state: normal,
                        ),
                    ],
                    text: "Dibbler wanders here, pitching sausages to the patient yucca.",
                ),
                (
                    conditions: [
                        npcPresent(
                            npc: "cmot_dibbler",
                        ),
                        npcInState(
                            npc: "cmot_dibbler",
                            state: happy,
                        ),
                    ],
                    text: "Dibbler hums a sales jingle, certain new patrons will arrive.",
                ),
                (
                    conditions: [
                        npcPresent(
                            npc: "cmot_dibbler",
                        ),
                        npcInState(
                            npc: "cmot_dibbler",
                            state: bored,
                        ),
                    ],
                    text: "Dibbler kicks at the gravel, lamenting the lack of customers.",
                ),
                (
                    conditions: [
                        playerHasItem(
                            item: "dental_floss",
                        ),
                    ],
                    text: "The weird bush looks oddly bare now, stripped of its floss-like strands.",
                ),
            ],
        ),
        (
            id: "front-entrance",
            name: "Front Entrance",
            desc: "Potted plants flank a plain, darkened glass door on the front of the building to the north. As you approach the door, an Initech Eye-bot™ mounted above it mutters judgementally as it scans you. A sign above it reads:\n\n                       \"Always Know Where Your Towel Is\"\n\nPaved paths lead around the building to the east and west.",
            visited: false,
            exits: [
                (
                    direction: "north",
                    to: "main-lobby",
                    hidden: false,
                    locked: false,
                    required_flags: [
                        "got-towel",
                    ],
                    required_items: [],
                    barred_message: Some("Not so fast. The Initech Eye-bot™ is absolutely insistent that you have a towel before you go inside."),
                ),
                (
                    direction: "west",
                    to: "snowfield",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
                (
                    direction: "east",
                    to: "east-of-building",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
            ],
            overlays: [
                (
                    conditions: [
                        flagSet(
                            flag: "got-towel",
                        ),
                    ],
                    text: "Finished scanning, the Eye-bot™\'s iris glows green. The doors unlatch and open slightly.",
                ),
                (
                    conditions: [
                        flagUnset(
                            flag: "got-towel",
                        ),
                    ],
                    text: "After a few moments, the Eye-bot™\'s iris turns red, and it points at the sign above.",
                ),
                (
                    conditions: [
                        npcPresent(
                            npc: "cmot_dibbler",
                        ),
                        npcInState(
                            npc: "cmot_dibbler",
                            state: normal,
                        ),
                    ],
                    text: "C.M.O.T. Dibbler blocks the entrance, hawking dubious sausages.",
                ),
                (
                    conditions: [
                        npcPresent(
                            npc: "cmot_dibbler",
                        ),
                        npcInState(
                            npc: "cmot_dibbler",
                            state: happy,
                        ),
                    ],
                    text: "Dibbler beams and offers a celebratory sausage-inna-bun.",
                ),
                (
                    conditions: [
                        npcPresent(
                            npc: "cmot_dibbler",
                        ),
                        npcInState(
                            npc: "cmot_dibbler",
                            state: bored,
                        ),
                    ],
                    text: "Dibbler sighs about the slow foot traffic.",
                ),
                (
                    conditions: [
                        npcAbsent(
                            npc: "cmot_dibbler",
                        ),
                    ],
                    text: "The doorway is mercifully free of purveyors of questionable sausages, for now.",
                ),
            ],
        ),
        (
            id: "inca-road",
            name: "Inca Road",
            desc: "An ancient road of broken and uneven stones winds precariously along the mountainside, half-swallowed by time and weeds. North of here, a river\'s rocky rapid rushes westward through the gorge.\n\nTo the south lies a trim, modern lawn with an improbably square footprint. It leads up toward a squat commercial building that seems to have landed here by accident.",
            visited: false,
            exits: [
                (
                    direction: "across the lawn",
                    to: "loading-dock",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
                (
                    direction: "down the slope",
                    to: "guard-post",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
            ],
            overlays: [],
        ),
        (
            id: "loading-dock",
            name: "Useless Loading Dock",
            desc: "The so-called loading dock juts ten feet *above* the ground, with no ramp, stairs, or apparent means of access and a loading door thirty feet wide and ten inches tall. A conveyor belt runs from the building wall to the edge of the dock, then loops straight back in again without touching anything.\n\nA bronze plaque proudly identifies this as a **Bloody Stupid Johnson** project:\n\'Winner of the 3rd Prize for Architectural Enthusiasm, 1973.\'\n\nIt\'s unclear what this office ever needed to load—or who would deliver to the side of a remote building halfway up a mountain.",
            visited: false,
            exits: [
                (
                    direction: "southeast",
                    to: "east-of-building",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
                (
                    direction: "southwest",
                    to: "snowfield",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
                (
                    direction: "north",
                    to: "inca-road",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
            ],
            overlays: [
                (
                    conditions: [
                        npcPresent(
                            npc: "cmot_dibbler",
                        ),
                        npcInState(
                            npc: "cmot_dibbler",
                            state: normal,
                        ),
                    ],
                    text: "Dibbler paces the dock, trying to sell sausages to absent drivers.",
                ),
                (
                    conditions: [
                        npcPresent(
                            npc: "cmot_dibbler",
                        ),
                        npcInState(
                            npc: "cmot_dibbler",
                            state: happy,
                        ),
                    ],
                    text: "Dibbler whistles, convinced the loading dock will make him rich.",
                ),
                (
                    conditions: [
                        npcPresent(
                            npc: "cmot_dibbler",
                        ),
                        npcInState(
                            npc: "cmot_dibbler",
                            state: bored,
                        ),
                    ],
                    text: "Dibbler slumps against the dock, lamenting the lack of deliveries.",
                ),
            ],
        ),
        (
            id: "corridor-north",
            name: "Research Corridor (North)",
            desc: "A dimly lit concrete hallway stretches out, lined with emergency lights that flicker like they\'re deciding whether to stay on. Faint scratching sounds echo through the walls at irregular intervals.\n\nGraffiti on one wall reads: \'THEY NEVER LEFT AA-3B.\' A maintenance hatch rattles occasionally, as if something on the other side is trying to remember how to use a doorknob.\n\nTo the right, an unmarked door with a darkened glass window stands closed. On the left, there is an open archway into a white, brightly lit bay with a pair of narrow beds emerging from the farthest wall.",
            visited: false,
            exits: [
                (
                    direction: "toward the elevator",
                    to: "sublevel-1-entrance",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
                (
                    direction: "unmarked door",
                    to: "observation-room",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
                (
                    direction: "archway",
                    to: "med-bay",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
                (
                    direction: "down the corridor",
                    to: "corridor-south",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
            ],
            overlays: [],
        ),
        (
            id: "corridor-south",
            name: "Research Corridor (South)",
            desc: "The research corridor continues here, though the walls are noticeably more patched and hastily reinforced. Warning stripes mark a wide door to the west, and faint heat shimmers pulse across the floor, as if reality itself is running a fever. Somewhere far too close, a light flickers in time with your quickening  pulse.",
            visited: false,
            exits: [
                (
                    direction: "toward the elevator",
                    to: "corridor-north",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
                (
                    direction: "wide striped door",
                    to: "monolith-room",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
            ],
            overlays: [],
        ),
        (
            id: "lift-sublevel-1",
            name: "Elevator (Sublevel AA-3)",
            desc: "The elevator sits open at the end of the corridor, but its appearance is… altered. What was once a sleek, polished carriage now seems borrowed from another world entirely. Gilded scrollwork curls along the walls where none existed before, and the ceiling flickers between brass panels and a starlit void. It hums with potential—and something less easily named.",
            visited: false,
            exits: [
                (
                    direction: "out to sublevel AA-3",
                    to: "sublevel-1-entrance",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
            ],
            overlays: [],
        ),
        (
            id: "med-bay",
            name: "Med Bay",
            desc: "A clean white infirmary with two bio-beds extending from the back wall, surrounded by a bevy of monitors and robotic surgical tools. One of the machines goes \"Bing!\" every few minutes. A small cleaning robot floats around the room disinfecting things.",
            visited: false,
            exits: [
                (
                    direction: "north corridor",
                    to: "corridor-north",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
            ],
            overlays: [
                (
                    conditions: [
                        npcPresent(
                            npc: "emh",
                        ),
                        npcInState(
                            npc: "emh",
                            state: normal,
                        ),
                    ],
                    text: "The EMH stands with professional detachment, awaiting your symptoms.",
                ),
                (
                    conditions: [
                        npcPresent(
                            npc: "emh",
                        ),
                        npcInState(
                            npc: "emh",
                            state: happy,
                        ),
                    ],
                    text: "The EMH smiles and hums a bright tune while adjusting the diagnostic displays.",
                ),
                (
                    conditions: [
                        npcPresent(
                            npc: "emh",
                        ),
                        npcInState(
                            npc: "emh",
                            state: custom("want-emitter"),
                        ),
                    ],
                    text: "The EMH fidgets restlessly, casting longing glances toward the door as if craving a mobile emitter.",
                ),
            ],
        ),
        (
            id: "monolith-room",
            name: "Monolith Room",
            desc: "The room is stark, dim, and cavernous with a deep reverb. A series of industrial floodlights cast long, angled shadows spreading out from the centerpiece: a towering, rectangular and perfectly black monolith that defies reflection. It absorbs light, sound, and—if you stare too long—possibly thought.\n\nThere is a heavy door in the east wall, next to a wide rectangular window into the observation room, where you can just make out some computer racks along the back wall.",
            visited: false,
            exits: [
                (
                    direction: "east",
                    to: "corridor-south",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
                (
                    direction: "north",
                    to: "observation-room",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
            ],
            overlays: [
                (
                    conditions: [
                        flagUnset(
                            flag: "talked-to-hal",
                        ),
                    ],
                    text: "A HAL-9000 camera and terminal embedded in the far wall looms dark and silent, but somehow still seems to be observing your actions.",
                ),
                (
                    conditions: [
                        flagSet(
                            flag: "hal-reboot#1",
                        ),
                    ],
                    text: "Several lights blink slowly on a panel near HAL-9000\'s camera, whose red light still glows faintly. A few cryptic instructions flicker across the monitor.",
                ),
                (
                    conditions: [
                        flagSet(
                            flag: "hal-reboot#2",
                        ),
                    ],
                    text: "HAL-9000\'s lens light glows bright red with a yellow center. Lights on several panels now flash in sequence; a boot sequence scrolls rapidly up the display.",
                ),
                (
                    conditions: [
                        flagComplete(
                            flag: "hal-reboot",
                        ),
                    ],
                    text: "The light in HAL-9000\'s lens glows an intense red and seems to stare through you and into the monolith. Various status notifications cycle on the nearby monitor.",
                ),
            ],
        ),
        (
            id: "observation-room",
            name: "Field Observation Room",
            desc: "Thick observation windows, long since spiderwebbed with cracks, overlook what should be Room AA-3B—but only darkness and occasional flashes of unreality appear beyond. Abandoned swivel chairs and battered clipboards litter the room. A faint smell of burnt ozone hangs in the air.\n\nA console near the glass flickers with a repeating message: \'CONTAINMENT BREACH LOGGED – STATUS: UNRESOLVED.\'",
            visited: false,
            exits: [
                (
                    direction: "east",
                    to: "corridor-north",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
                (
                    direction: "south",
                    to: "monolith-room",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
            ],
            overlays: [],
        ),
        (
            id: "room-aa-3b",
            name: "Room AA-3B",
            desc: "OK, so I was fairly sure that nobody but me would ever come this far. Massive congratulations are in order. Good hustle. But I, uh, never created an ending or an extension to a new content area. Perhaps this will be a jumping off point after it\'s opened up to public access...",
            visited: false,
            exits: [
                (
                    direction: "east",
                    to: "sublevel-1-entrance",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
            ],
            overlays: [],
        ),
        (
            id: "security-station",
            name: "Level AA-3 Security",
            desc: "A compact but well-equipped station with reinforced blast doors, a wall of cracked CRT monitors, and a swivel chair. The space above the monitors is emblazoned with \'IN CASE OF EMERGENCY, RUN FASTER.\' Paperwork is scattered across the floor, including an ominous memo titled \'AA-3B: Risk Ignorance Recommendations.\'",
            visited: false,
            exits: [
                (
                    direction: "out",
                    to: "sublevel-1-entrance",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
            ],
            overlays: [
                (
                    conditions: [
                        itemPresent(
                            item: "evidence_locker_closed",
                        ),
                    ],
                    text: "A heavy steel evidence locker is embedded in the wall. It\'s covered in dents, scratches, and scorch marks -- evidence of previous failed attempts to open it.",
                ),
                (
                    conditions: [
                        itemAbsent(
                            item: "evidence_locker_closed",
                        ),
                    ],
                    text: "The heavy door of the evidence locker, having surrendered at last, hangs loosely from one of its hinges.",
                ),
            ],
        ),
        (
            id: "sublevel-1-entrance",
            name: "Sublevel AA-3 Entrance",
            desc: "A small landing area covered in dust. Buckets, tools, and debris are strewn about the floor. An industrial corridor extends farther south from the entrance. On your left, there is a heavy blast door marked \"Sublevel Security\". An even heavier door on the right is labeled with a sign:\n\n                        🚧 ROOM AA-3B 🚧\n                 FICTIONAL UNIVERSE CONTAINMENT",
            visited: false,
            exits: [
                (
                    direction: "into the elevator",
                    to: "lift-sublevel-1",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
                (
                    direction: "containment area",
                    to: "room-aa-3b",
                    hidden: false,
                    locked: false,
                    required_flags: [
                        "appeased-black-knight",
                        "touched-monolith",
                    ],
                    required_items: [],
                    barred_message: Some("The Black Knight stands in your way."),
                ),
                (
                    direction: "blast door",
                    to: "security-station",
                    hidden: false,
                    locked: false,
                    required_flags: [
                        "appeased-black-knight",
                    ],
                    required_items: [],
                    barred_message: Some("The Black Knight stands in your way."),
                ),
                (
                    direction: "down the corridor",
                    to: "corridor-north",
                    hidden: false,
                    locked: false,
                    required_flags: [
                        "appeased-black-knight",
                    ],
                    required_items: [],
                    barred_message: Some("The Black Knight stands in your way."),
                ),
            ],
            overlays: [
                (
                    conditions: [
                        npcInState(
                            npc: "black_knight",
                            state: normal,
                        ),
                    ],
                    text: "The Black Knight stands in your path, staring you down, leaning on his battered longsword.",
                ),
                (
                    conditions: [
                        npcInState(
                            npc: "black_knight",
                            state: mad,
                        ),
                    ],
                    text: "Agitated, the Black Knight sidesteps around the room, occasionally lunging at you to grab at his sword or kick you in the shin.",
                ),
                (
                    conditions: [
                        npcInState(
                            npc: "black_knight",
                            state: happy,
                        ),
                    ],
                    text: "The Black Knight stands in a corner, helmet off, gleefully plucking hairs from his beard and splitting them with his sword.",
                ),
            ],
        ),
        (
            id: "ice-pit",
            name: "Abysmal Ice Pit",
            desc: "The bottom of a deep, sheer ice shaft seemingly dug for some kind of arctic research -- though you were nowhere near the Arctic Circle, last you checked. You\'re just able to see in the dim light filtering down from the tiny opening to the surface above.",
            visited: false,
            exits: [
                (
                    direction: "back to the surface",
                    to: "snowfield",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
            ],
            overlays: [
                (
                    conditions: [
                        flagSet(
                            flag: "snowfield-gate-open",
                        ),
                    ],
                    text: "The center of the Stargate shimmers and phases, still connected to the room back at the Aperture Laboratory.",
                ),
                (
                    conditions: [
                        flagUnset(
                            flag: "snowfield-gate-open",
                        ),
                    ],
                    text: "A dark metallic ring the size of two sheds stands where it appears to have been chiseled from the ice some time ago.",
                ),
                (
                    conditions: [
                        itemPresent(
                            item: "plaque_2_frozen",
                        ),
                    ],
                    text: "A slightly larger than human-sized pillar of ice rises from the floor near one end of the excavated area.",
                ),
                (
                    conditions: [
                        itemPresent(
                            item: "unlit_campfire",
                        ),
                    ],
                    text: "A carefully-laid but unlit campfire waits next to the pillar.",
                ),
                (
                    conditions: [
                        itemPresent(
                            item: "campfire",
                        ),
                    ],
                    text: "A toasty campfire burns steadily next to the gradually melting ice pillar.",
                ),
                (
                    conditions: [
                        flagComplete(
                            flag: "reveal-ice-plaque",
                        ),
                    ],
                    text: "A campfire crackles next to a marble pillar topped with a shiny bronze plaque near one end of the room.",
                ),
            ],
        ),
        (
            id: "snow-camp",
            name: "Abandoned Campsite",
            desc: "The remains of a temporary shelter are dug into a snowbank here. The tent has collapsed, half-fused to a scorched sled. The river — or some frozen remnant of it — glistens beyond.",
            visited: false,
            exits: [
                (
                    direction: "back to the snowfield",
                    to: "snowfield",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
            ],
            overlays: [],
        ),
        (
            id: "snowfield",
            name: "Desolate Snowfield",
            desc: "You find yourself in a wide, desolate snowfield west of the main building -- which is odd, because you still see summery woodlands just yards away, with a clean line separating the two climates. Wind howls across the ice, and powdery drifts swirl around a dark rectangular pit, some 20 feet across, but too deep and dark to see the bottom. A thick rope anchored deeply into the ice leads down into the pit.",
            visited: false,
            exits: [
                (
                    direction: "northeast",
                    to: "loading-dock",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
                (
                    direction: "southeast",
                    to: "front-entrance",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
                (
                    direction: "west",
                    to: "snow-camp",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
                (
                    direction: "rope-down",
                    to: "ice-pit",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
            ],
            overlays: [],
        ),
        (
            id: "guard-post",
            name: "Abandoned Guard Post",
            desc: "A small stone guard post clings to the side of the trail, complete with a creaky wooden chair and a megaphone labeled [[red]]\'USE ONLY IF VERY SURE\'[[/red]]. A faded official-looking placard reads:\n[[box:NOTICE]] Passage beyond this point will have lead to anachronism.[[/box]]\nIt seems no one’s been stationed here in [[i]]quite[[/i]] some time. The trail continues upward, leading to what appears to be an ancient road—and a distinctly non-ancient office park.",
            visited: false,
            exits: [
                (
                    direction: "up to the road",
                    to: "inca-road",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
                (
                    direction: "down the steps",
                    to: "two-sheds-landing",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
            ],
            overlays: [
                (
                    conditions: [
                        itemPresent(
                            item: "am_dollar",
                        ),
                    ],
                    text: "A silver coin sits upon a note on the kiosk: \"Lunch Money - [[u]]don\'t[[/u]] get it from [[i]]that vendor[[/i]] again!\" ",
                ),
                (
                    conditions: [
                        itemAbsent(
                            item: "am_dollar",
                        ),
                    ],
                    text: "A note on the kiosk reads: \"Lunch Money - [[u]]don\'t[[/u]] get it from that vendor again!\" The coin left a neat, circular void in the dust.",
                ),
            ],
        ),
        (
            id: "high-ridge",
            name: "High Isolated Ridge",
            desc: "A small, flat ridge in the midst of a steeply sloped wooded area. Probably west of [[i]]something[[/i]], depending on how you\'re oriented. The only egress seems to be a flight of rough stone steps carved into the slope, which curve upward and then disappear into the trees.",
            visited: true,
            exits: [
                (
                    direction: "up the steps",
                    to: "parish-landing",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
            ],
            overlays: [
                (
                    conditions: [
                        itemPresent(
                            item: "scrawled_note",
                        ),
                    ],
                    text: "A [[item]]note[[/item]] scrawled in green marker on bright yellow paper is nailed to a tree trunk near the base of the steps.",
                ),
                (
                    conditions: [
                        itemPresent(
                            item: "ephemeral_cake",
                        ),
                    ],
                    text: "Strangely, a slice of [[item]]birthday cake[[/item]] on a paper plate sits precariously balanced on top of a thin boulder nearby.",
                ),
            ],
        ),
        (
            id: "parish-landing",
            name: "Parish Landing",
            desc: "A small plateau carved into the slope, marked by an old wooden sign that reads:\n[[box:Candidates Welcome]][[b]]Pancakes Served Daily (Terms and Conditions Apply)[[/b]][[/box]]\nA faded poster nailed beside it shows a smiling Saint Alfonzo wielding a spatula like a holy relic. From here, the steps curve gently upward, disappearing into the woodland growth again. A modest trail leads west toward a nearby parish.",
            visited: false,
            exits: [
                (
                    direction: "down the steps",
                    to: "high-ridge",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
                (
                    direction: "westward trail",
                    to: "st-alfonzo-parish",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
                (
                    direction: "up the steps",
                    to: "two-sheds-landing",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
            ],
            overlays: [
                (
                    conditions: [
                        flagSet(
                            flag: "woodland-gate-open",
                        ),
                    ],
                    text: "The open Stargate shimmers just behind the Saint Alfonzo\'s sign.",
                ),
                (
                    conditions: [
                        flagUnset(
                            flag: "woodland-gate-open",
                        ),
                    ],
                    text: "A shed-sized metallic ring sits upright behind the St. Alfonzo\'s sign. [[i]]Strange symbols[[/i]] are forged around its circumference.",
                ),
                (
                    conditions: [
                        flagSet(
                            flag: "cleaned-plaque-1",
                        ),
                    ],
                    text: "You\'re occasionally distracted by a glint of sunlight reflected from the freshly cleaned [[item]]plaque[[/item]] on the pillar just inside the treeline.",
                ),
                (
                    conditions: [
                        flagUnset(
                            flag: "cleaned-plaque-1",
                        ),
                    ],
                    text: "Just beyond the treeline stands an impressive, intricately sculpted pillar bearing a [[item]]plaque[[/item]] tarnished with age and forest grime.",
                ),
            ],
        ),
        (
            id: "st-alfonzo-parish",
            name: "Parish of Saint Alfonzo",
            desc: "The parish resembles a half-abandoned diner and half-absolved church, complete with stained glass windows depicting breakfast foods in heroic poses. The air smells faintly of syrup and tobacco.\n\nA refrigerated pedestal in the corner hums solemnly. Near the door, the hymn board lists this week’s sermon: [[b]]\'On the Sanctity of the Short Stack.\'[[/b]]",
            visited: false,
            exits: [
                (
                    direction: "out the door",
                    to: "parish-landing",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
            ],
            overlays: [
                (
                    conditions: [
                        itemPresent(
                            item: "margarine",
                        ),
                    ],
                    text: "A large tub of [[item]]Nanook\'s Finest™ margarine[[/item]] sits upon the pedestal.",
                ),
                (
                    conditions: [
                        itemAbsent(
                            item: "margarine",
                        ),
                    ],
                    text: "The pedestal stands empty, chilling nothing in particular.",
                ),
            ],
        ),
        (
            id: "two-sheds",
            name: "Two Sheds",
            desc: "A modest wooden shed stands alone in the clearing. It appears freshly painted and surprisingly well cared for. A plaque on the door reads:\n[[box]]        ARTHUR \"TWO SHEDS\" JACKSON\n [[i]]Philosopher, Composer, Owner of [[u]]One[[/u]] Shed[[/i]] [[/box]]\nA second, smaller foundation lies nearby, overgrown with weeds. A broken signpost beside it reads: \'Future Site of Shed #2 – Delayed Indefinitely.\' The surrounding forest is dark and dense, and the slope falls off sharply beyond the shed.",
            visited: false,
            exits: [
                (
                    direction: "trail west",
                    to: "two-sheds-landing",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
            ],
            overlays: [
                (
                    conditions: [
                        itemPresent(
                            item: "arson_aid",
                        ),
                        itemPresent(
                            item: "lumberjack_axe",
                        ),
                    ],
                    text: "An abandoned axe and... something like a sawed-off flamethrower are lying partly hidden by the overgrowth.",
                ),
                (
                    conditions: [
                        itemPresent(
                            item: "arson_aid",
                        ),
                        itemAbsent(
                            item: "lumberjack_axe",
                        ),
                    ],
                    text: "Something that looks like a sawed-off flamethrower remains partly concealed in the tall grass.",
                ),
                (
                    conditions: [
                        itemAbsent(
                            item: "arson_aid",
                        ),
                        itemPresent(
                            item: "lumberjack_axe",
                        ),
                    ],
                    text: "A disused but serviceable axe remains partly concealed in the tall grass.",
                ),
            ],
        ),
        (
            id: "two-sheds-landing",
            name: "Jackson\'s Landing",
            desc: "A quiet landing tucked along the slope, with a rusted mailbox labeled \'A. Jackson\' standing to one side. A trail sign points east toward something optimistically named [[b]]\"Two Sheds\"[[/b]]. Underneath, someone has scratched in: [[i]]\"Technically One.\"[[/i]] Rough steps lead down the slope, and continue curving upward.",
            visited: false,
            exits: [
                (
                    direction: "up the slope",
                    to: "guard-post",
                    hidden: false,
                    locked: false,
                    required_flags: [
                        "cleared-fallen-tree",
                    ],
                    required_items: [],
                    barred_message: Some("You can\'t get around the fallen tree. You\'ll need to find a way to clear it from the path."),
                ),
                (
                    direction: "down the steps",
                    to: "parish-landing",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
                (
                    direction: "trail east",
                    to: "two-sheds",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
            ],
            overlays: [
                (
                    conditions: [
                        itemPresent(
                            item: "fallen_tree",
                        ),
                    ],
                    text: "A huge tangle of limbs and branches from a fallen tree block the path continuing upward.",
                ),
                (
                    conditions: [
                        flagSet(
                            flag: "chopped-fallen-tree",
                        ),
                        flagUnset(
                            flag: "saw-paul-bunyan",
                        ),
                    ],
                    text: "Cut branches of a fallen tree are piled to the side of the path upward.",
                ),
                (
                    conditions: [
                        flagSet(
                            flag: "burned-fallen-tree",
                        ),
                    ],
                    text: "Charred twigs and smoldering ash are all that remain of the fallen tree.",
                ),
            ],
        ),
        (
            id: "dev-room",
            name: "The Construct",
            desc: "Like in the Matrix, this is the Construct -- an empty, bare white room with white walls. It is here for the [[b]]Architect[[/b]] ([[i]]that\'s you![[/i]]) to experiment with things before putting them in play in the rest of the AmbleWorld.\n\n    [[center]][[box:WARNING]]Beware of [[npc]]The Luggage[[/npc]][[/box]][[/center]]",
            visited: false,
            exits: [
                (
                    direction: "back to game start",
                    to: "high-ridge",
                    hidden: false,
                    locked: false,
                    required_flags: [],
                    required_items: [],
                    barred_message: None,
                ),
            ],
            overlays: [],
        ),
    ],
    items: [
        (
            id: "foamsafe_x17",
            name: "Initech FoamSafe™ X-17",
            desc: "A fire extinguisher-like device with the words \"Initech FoamSafe™ X-17\" proudly emblazoned on its side. Its label promises peace of mind in emergencies — though closer inspection suggests otherwise.",
            movability: free,
            container_state: None,
            location: Room("aperture-lab"),
            abilities: [
                read,
                extinguish,
            ],
            interaction_requires: {},
            text: Some("[[center]][[bright-blue]][[u]]INITECH FOAMSAFE™ MODEL X-17[[/u]][[/bright-blue]][[/center]]\n\n[[b]][[hl]]FOR EMERGENCY USE ONLY[[/hl]][[/b]]\nContents: Pressurized mineral oil, cedar essence, trace accelerants\n*Note: Foam not included.*\n\n[[box:Instructions]]\n1. Shake vigorously.\n2. Point away from self (ideally).\n3. Spray liberally and accept the consequences.\n[[/box]]\n\n[[hl]]WARNING:[[/hl]] [[i]]Device may not extinguish fires. Initech assumes no liability for secondary\ncombustion, flashpoint misalignment, or structural regrets.[[/i]]\n"),
            consumable: None,
        ),
        (
            id: "flaming_invitation",
            name: "Flaming Document",
            desc: "This [[u]]could[[/u]] be your invitation, but it\'s hard to tell when it\'s on [[b]][[bright-red]]FIRE![[/bright-red]][[/b]]",
            movability: free,
            container_state: None,
            location: Nowhere,
            abilities: [],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "foam_fire",
            name: "Foam Fire",
            desc: "A raging patch of fire fueled by accelerant-laced foam. It crackles hungrily.",
            movability: fixed(
                reason: "It\'s flaming, amorphous goo that sticks to everything.",
            ),
            container_state: None,
            location: Nowhere,
            abilities: [],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "sausage-inna-bun",
            name: "Sausage-Inna-Bun",
            desc: "\"Once tasted, never forgotten.\" An odd-smelling sausage in a long bun, smothered with mustard and fried onions.",
            movability: restricted(
                reason: "You have to give Dibbler something in exchange for it.",
            ),
            container_state: None,
            location: Npc("cmot_dibbler"),
            abilities: [
                eat,
            ],
            interaction_requires: {},
            text: None,
            consumable: Some((
                uses_left: 1,
                consume_on: [
                    eat,
                ],
                when_consumed: despawn,
            )),
        ),
        (
            id: "charged_battery",
            name: "Charged Battery",
            desc: "A fully charged, 20 kilovolt battery. Don\'t touch it to your tongue to test it.",
            movability: restricted(
                reason: "Gonk can\'t release it without taking one in exchange.",
            ),
            container_state: None,
            location: Npc("gonk_droid"),
            abilities: [],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "gonk_family_photo",
            name: "Gonk\'s Family Photo",
            desc: "A slightly scorched photograph of the gonk droid with its family: a PC power supply, a D-cell, and a set of adorable AAA triplets.",
            movability: free,
            container_state: None,
            location: Npc("gonk_droid"),
            abilities: [
                read,
            ],
            interaction_requires: {},
            text: Some("Brains Anonymous Energy Division Picnic — For Staff & Families of Room AA-3B. (added below: \"Just hours before the Candidate reported for load test...\")"),
            consumable: None,
        ),
        (
            id: "vogon_poetry_book",
            name: "Longest Poems of the Largest Vogons",
            desc: "A bound volume of Vogon poetry, with the usual safety devices and locks removed. Looking inside is likely to cause brain damage and a permanent smell of boiling cauliflower to haunt you, if you\'re lucky.",
            movability: free,
            container_state: None,
            location: Room("vip-bathroom"),
            abilities: [
                read,
            ],
            interaction_requires: {},
            text: Some("\"Oh freddled gruntbuggly,\nThy micturations are to me\nAs plurdled gabbleblotchits on a lurgid bee.\nGroop, I implore thee, my foonting turlingdromes,\nAnd hooptiously drangle me with crinkly bindlewurdles,\nOr I will rend thee in the gobberwarts\nWith my blurglecruncheon, see if I don\'t!\"\n\n\"Bleem miserable venchit! Bleem\nforever mestinglish asunder frapt.\nGashee morphousite,\nthou expungiest quoopisk!\nFripping lyshus wimbgunts,\nawhilst moongrovenly kormzibs.\nGerond withoutitude form into formless bloit,\nwhy not then? Moose.\"\n"),
            consumable: None,
        ),
        (
            id: "poetry_performer",
            name: "Initech Poetry Performer",
            desc: "In lieu of decades-old magazines, the office has installed this poetry recitation device. If poetic material is supplied, it is automatically performed in the whichever voice the listener finds most soul-penetrating (as long as it happens to be Morgan Freeman\'s).",
            movability: fixed(
                reason: "It weighs about 500 kilograms. Are you hoping for a hernia?",
            ),
            container_state: Some(closed),
            location: Room("b-a-office"),
            abilities: [],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "charred_invitation_bits",
            name: "Charred Paper Bits",
            desc: "The charred remains of a sheet of printer paper. A few areas aren\'t completely black, or vaporized. One bit remains legible.",
            movability: free,
            container_state: None,
            location: Nowhere,
            abilities: [
                read,
            ],
            interaction_requires: {},
            text: Some("--ally invited to com--"),
            consumable: None,
        ),
        (
            id: "asbestos_sheet",
            name: "Asbestos Sheet",
            desc: "A roughly copy paper-sized sheet of asbestos insulation. Maybe it fell down from the ceiling?",
            movability: free,
            container_state: None,
            location: Room("supply-closet"),
            abilities: [
                read,
            ],
            interaction_requires: {},
            text: Some("Manufacturer\'s Warning: Do Not Breathe While Using This Product!"),
            consumable: None,
        ),
        (
            id: "invitation",
            name: "Engraved Invitation",
            desc: "A standard letter-size slab of asbestos with ornate and official-looking lettering burned into it. It remains too hot to touch.",
            movability: free,
            container_state: None,
            location: Nowhere,
            abilities: [
                read,
            ],
            interaction_requires: {
                handle: insulate,
            },
            text: Some("Candidate #2112-42:\nYou are cordially invited to complete your evaluation and induction. Please present this invitation at the Amble Adventures office immediately upon arrival."),
            consumable: None,
        ),
        (
            id: "portal_gun",
            name: "Portal Gun",
            desc: "A black and white Portal gun affixed to a stand and aimed at a target on the wall. There\'s a power switch and a door to a battery compartment.",
            movability: fixed(
                reason: "It is riveted to the stand, which is set into the concrete floor.",
            ),
            container_state: Some(closed),
            location: Room("portal-room"),
            abilities: [
                turnOn,
            ],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "empty_battery",
            name: "Empty Battery",
            desc: "A completely discharged 20 kilovolt battery. It would take months to charge it, but you might be able to exchange it somewhere for one with a charge.",
            movability: free,
            container_state: None,
            location: Item("portal_gun"),
            abilities: [],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "magnifying_glass",
            name: "Magnifying Glass",
            desc: "Small gets big -- it\'s a rig.",
            movability: free,
            container_state: None,
            location: Room("aperture-lab"),
            abilities: [],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "lab_printer",
            name: "Initech PlasmaJet 2 Printer",
            desc: "A sleek, off white printer, with a blinking LED near a small status screen. This model is known for its high precision, micrometer-level resolution, and ability to ignite almost any printing surface.",
            movability: fixed(
                reason: "It is locked to the lab bench.",
            ),
            container_state: Some(open),
            location: Room("aperture-lab"),
            abilities: [
                turnOn,
                read,
            ],
            interaction_requires: {
                extinguish: extinguish,
            },
            text: Some("PC LOAD LETTER"),
            consumable: None,
        ),
        (
            id: "peril_sunglasses",
            name: "Stylish Sunglasses",
            desc: "A pair of stylish black shades that automatically go [[u]]completely opaque[[/u]] at the first sign of danger. Unfortunately, this may include things like loud noises, sudden movement, or mild existential dread.",
            movability: free,
            container_state: None,
            location: Item("lost_and_found_box"),
            abilities: [
                read,
            ],
            interaction_requires: {},
            text: Some("[[b]]z. beeblebrox[[/b]] - [[i]]etched on one arm[[/i]]"),
            consumable: None,
        ),
        (
            id: "lost_and_found_box",
            name: "Lost & Found Box",
            desc: "A sturdy metal lock box with an official-looking sticker reading: \'Lost & Found — Amble Adventures Division\' and \'Caution: Contents May Be Fictional\'.",
            movability: fixed(
                reason: "It is property of Brains Anonymous, and they\'re quite fond of it.",
            ),
            container_state: Some(locked),
            location: Room("b-a-office"),
            abilities: [],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "zircon_tweezers",
            name: "Zircon-Encrusted Tweezers",
            desc: "A heavy-duty pair of tweezers, encrusted in zircon for extra dazzle and especially good for plucking.",
            movability: free,
            container_state: None,
            location: Item("lost_and_found_box"),
            abilities: [
                pluck,
            ],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "melted_aa_3b_id",
            name: "Section AA-3 Staff ID",
            desc: "A facility ID card for sector AA-3. Its weight seems to change as you hold it, as does the temperature. It\'s not warped or melted exactly -- just *distorted* somehow.",
            movability: free,
            container_state: None,
            location: Item("lost_and_found_box"),
            abilities: [
                read,
            ],
            interaction_requires: {},
            text: Some(" RESTRICTED ACCESS PASS\nSECTOR AA-3, HIGH ENERGY\n REALITY BRIDGE PROJECT\n"),
            consumable: None,
        ),
        (
            id: "aa_3_button_main",
            name: "[AA-3] Button (Unlit)",
            desc: "The button to send the elevator to sublevel AA-3, currently unlit and disabled.",
            movability: fixed(
                reason: "It\'s part of the elevator control panel.",
            ),
            container_state: None,
            location: Room("lift-main"),
            abilities: [],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "main_button_main",
            name: "[Main] Button",
            desc: "The button that sends the elevator to the main floor.",
            movability: fixed(
                reason: "It\'s part of the elevator control panel.",
            ),
            container_state: None,
            location: Room("lift-main"),
            abilities: [],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "lebowski_rug",
            name: "Ornate Rug",
            desc: "It really ties the room together, man.",
            movability: free,
            container_state: None,
            location: Room("lounge"),
            abilities: [],
            interaction_requires: {
                burn: ignite,
            },
            text: None,
            consumable: None,
        ),
        (
            id: "coffee_machine",
            name: "Coffee Machine",
            desc: "A sleek black single-serve drip coffee machine, ready to go with fresh grounds.",
            movability: fixed(
                reason: "It\'s tied directly into the water supply pipe.",
            ),
            container_state: None,
            location: Room("lounge"),
            abilities: [
                turnOn,
            ],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "hot_coffee",
            name: "Hot Coffee",
            desc: "A paper cup of piping hot deep black coffee. Smells like a dark french roast.",
            movability: free,
            container_state: None,
            location: Nowhere,
            abilities: [
                drink,
            ],
            interaction_requires: {},
            text: None,
            consumable: Some((
                uses_left: 2,
                consume_on: [
                    drink,
                ],
                when_consumed: despawn,
            )),
        ),
        (
            id: "cooled_coffee",
            name: "Cooled Coffee",
            desc: "A paper cup of formerly-hot coffee, cooled down to room temperature now.",
            movability: free,
            container_state: None,
            location: Nowhere,
            abilities: [
                drink,
            ],
            interaction_requires: {},
            text: None,
            consumable: Some((
                uses_left: 1,
                consume_on: [
                    drink,
                ],
                when_consumed: despawn,
            )),
        ),
        (
            id: "dehydrated_water",
            name: "Dehydrated Water",
            desc: "A packet labeled \'Dehydrated Water - Just Add Water!\' The instructions on the back have been crossed out and replaced with \'PARADOX WARNING: Do not attempt to reconstitute.\'",
            movability: free,
            container_state: None,
            location: Item("vending_machine"),
            abilities: [
                drink,
            ],
            interaction_requires: {},
            text: None,
            consumable: Some((
                uses_left: 1,
                consume_on: [
                    drink,
                ],
                when_consumed: despawn,
            )),
        ),
        (
            id: "schrodingers_sandwich",
            name: "Schrödinger\'s Sandwich",
            desc: "A sandwich in a quantum superposition of both fresh and moldy until observed. The packaging warns: \'Contents may or may not contain nuts, and also definitely contain nuts.\'",
            movability: free,
            container_state: None,
            location: Item("vending_machine"),
            abilities: [
                eat,
            ],
            interaction_requires: {},
            text: None,
            consumable: Some((
                uses_left: 1,
                consume_on: [
                    eat,
                ],
                when_consumed: despawn,
            )),
        ),
        (
            id: "fortune_cookies_of_doom",
            name: "Fortune Cookies of Doom",
            desc: "A pack of three fortune cookies wrapped ominously in black paper with tiny skulls and crossbones on them. You can feel it radiating pessimism through the wrapper. Previous fortunes reportedly included \'Your future is behind you\' and \'Dessicant -- DO NOT EAT\'",
            movability: free,
            container_state: None,
            location: Item("vending_machine"),
            abilities: [
                eat,
            ],
            interaction_requires: {},
            text: None,
            consumable: Some((
                uses_left: 3,
                consume_on: [
                    eat,
                ],
                when_consumed: despawn,
            )),
        ),
        (
            id: "un_drink",
            name: "Negative Cocktail",
            desc: "A crystal glass sits half full of... nothing. And yet, the liquid level keeps rising, as if the drink is slowly returning to the bartender across time. The stir stick spins gently in defiance of gravity and good sense.",
            movability: free,
            container_state: None,
            location: Room("patio"),
            abilities: [
                drink,
            ],
            interaction_requires: {},
            text: None,
            consumable: Some((
                uses_left: 1,
                consume_on: [
                    drink,
                ],
                when_consumed: despawn,
            )),
        ),
        (
            id: "plaque_3",
            name: "Crystal Plaque",
            desc: "An intricate pure clear crystal plaque with an inlaid inscription in obsidian; it must have taken decades to create -- atop an ornately carved pillar that probably took nearly as long to create -- impressing the beholder with the sheer enormity of its message.",
            movability: fixed(
                reason: "It\'s firmly mounted to the marble pillar.",
            ),
            container_state: None,
            location: Room("patio"),
            abilities: [
                read,
            ],
            interaction_requires: {},
            text: Some("There are, it has been said, two types of people in the world. There are those who, when presented with a glass that is exactly half full, say: this glass is half full. And then there are those who say: this glass is half empty. The world belongs, however, to those who can look at the glass and say: What\'s up with this glass? Excuse me? Excuse me? This is my glass? I don\'t think so. My glass was full! And it was a bigger glass! Who\'s been pinching my beer?  -- Terry Pratchett"),
            consumable: None,
        ),
        (
            id: "elevator_keycard",
            name: "Proximity Keycard",
            desc: "This is either a keycard or a rejected prototype for a business card. It reads: \'Amble Adventures — Internal Use Only — Do Not Duplicate, Think About, or Eat\'. It\'s warm to the touch, and it buzzes slightly.",
            movability: free,
            container_state: None,
            location: Room("poetry-panic"),
            abilities: [],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "reservation_book",
            name: "Reservation Book",
            desc: "A leather-bound guest book sits at the host stand, its pages flipping themselves when unattended. You spot several reservations, hastily written in wildly different scripts.",
            movability: fixed(
                reason: "It\'s attached to the host stand by a chain.",
            ),
            container_state: None,
            location: Room("restaurant"),
            abilities: [
                read,
            ],
            interaction_requires: {},
            text: Some("    Zaphod B............................ happy hour\n    Marvin (ugh, not again)............. teatime\n    Candidate (#2112-42) ............... (overdue)\n    Jenkins the Time Ferret............. (last Thursday)\n\nThere\'s a smudged doodle of a blinding sun and a stylish pair of sunglasses in the bottom margin."),
            consumable: None,
        ),
        (
            id: "woodland_button",
            name: "[ Tree ]",
            desc: "A tree shaped button on the left of the Stargate control console.",
            movability: fixed(
                reason: "It\'s part of the control console.",
            ),
            container_state: None,
            location: Room("stargate-room"),
            abilities: [],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "snowfield_button",
            name: "[ Snowflake ]",
            desc: "A snowflake-shaped button ing the middle of the Stargate control console.",
            movability: fixed(
                reason: "It\'s part of the control console.",
            ),
            container_state: None,
            location: Room("stargate-room"),
            abilities: [],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "patio_button",
            name: "[ Fork ]",
            desc: "A fork-shaped button on the right of the Stargate control console.",
            movability: fixed(
                reason: "It\'s part of the control console.",
            ),
            container_state: None,
            location: Room("stargate-room"),
            abilities: [],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "printer_paper",
            name: "Copy Paper (Std Letter)",
            desc: "A pack of plain white paper, standard letter size.",
            movability: free,
            container_state: None,
            location: Room("supply-closet"),
            abilities: [],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "staples",
            name: "Swingline Staples",
            desc: "A box of Swingline paper staples. The name \"Milton\" is written on it in several places.",
            movability: free,
            container_state: None,
            location: Room("supply-closet"),
            abilities: [],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "paper_clip",
            name: "Paper Clip",
            desc: "It\'s... a paper clip. I mean, do you really need a description?",
            movability: free,
            container_state: None,
            location: Room("supply-closet"),
            abilities: [
                attach,
            ],
            interaction_requires: {
                attach: attach,
            },
            text: None,
            consumable: None,
        ),
        (
            id: "weird_bush",
            name: "Weird Bush",
            desc: "A squat, leafy bush with long, pale strands growing among the branches. The fibers look oddly uniform — almost like... dental floss?",
            movability: fixed(
                reason: "It is firmly rooted into the rocky ground.",
            ),
            container_state: Some(open),
            location: Room("east-of-building"),
            abilities: [],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "dental_floss",
            name: "Dental Floss",
            desc: "A long, strong strand of waxed dental floss, harvested from the weird bush. It smells faintly minty, but seems surprisingly durable — maybe even useful for something besides oral hygiene.",
            movability: free,
            container_state: None,
            location: Item("weird_bush"),
            abilities: [
                attach,
            ],
            interaction_requires: {
                attach: attach,
            },
            text: None,
            consumable: None,
        ),
        (
            id: "road_sign",
            name: "Welcome Sign",
            desc: "A 10-foot tall sign, spotlit from below by a fusion powered sodium lamp. The sign is tilted upward, as if meant to be read from the air as well as the ground.",
            movability: fixed(
                reason: "It is firmly bolted to a heavy concrete base.",
            ),
            container_state: None,
            location: Room("inca-road"),
            abilities: [
                read,
            ],
            interaction_requires: {},
            text: Some("                            AMBLE ADVENTURES\n                           (Inca Road Branch)\n                 * a division of Brains Anonymous, LLC"),
            consumable: None,
        ),
        (
            id: "security_locker",
            name: "Security Supply Locker",
            desc: "A heavy wooden locker marked \'AMBLE SECURITY - Authorized Use Only\'. The planks are reinforced, and the it rattles faintly when nudged.",
            movability: fixed(
                reason: "It\'s too big and heavy to carry.",
            ),
            container_state: Some(locked),
            location: Room("loading-dock"),
            abilities: [],
            interaction_requires: {
                burn: ignite,
                cut: cutWood,
                break: smash,
            },
            text: Some("The wood comes from the strong but incredibly flammable magnesium magnolia tree."),
            consumable: None,
        ),
        (
            id: "crowbar",
            name: "Crowbar",
            desc: "A sturdy crowbar with the initials \'G.F.\' etched near the handle grip. It looks like it could pry open doors or smash obstacles — a proper scientist’s multitool.",
            movability: free,
            container_state: None,
            location: Nowhere,
            abilities: [
                pry,
                smash,
            ],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "security_log",
            name: "Amble Security Log",
            desc: "A well-used notebook labeled \"Amble Security Log / Section 42\" and liberally stained with coffee, ale, and mustard.",
            movability: free,
            container_state: None,
            location: Nowhere,
            abilities: [
                read,
            ],
            interaction_requires: {},
            text: Some("March 1, 2025: New coffee machine installed. Emits mild static when brewing.\nMarch 2, 2025: Security camera in break room rotated 180 degrees overnight. Ed again?\nMarch 3, 2025: Lost and found box inventory updated. One sock, three gloves.\nMarch 4, 2025: Receptionist requested upgrade to sarcasm module. Denied.\nMarch 5, 2025: Maintenance reported light flickering in elevator. Resolved.\n\nMarch 6, 2025: Surge detected at AA-3B containment. Reality distortion at 14%. Not great. Not terrible.\n\nStardate 4711.5: Unauthorized medieval figure (Black Knight) reported blocking sublevel entrance.\nStardate 4711.8: Receptionist reports elevator keycard locked in panic room; Candidate #2112-41 melted.\nStardate 4712.3: Droid exhibiting “gonk” vocalizations wandering main lobby. Source unknown.\nStardate 4713.0: Poetry recitation device demanding arrest of visitor with Vogon poetry.\nStardate 4713.7: Candidate #2112-42 en route. Receptionist instructed to increase scrutiny.\nStardate 4714.2: Staff experiencing deja vu from alternate realities. Report forwarded to Neo.\n"),
            consumable: None,
        ),
        (
            id: "burned_security_log",
            name: "Amble Security Log",
            desc: "This appears to have once been a security event log for the building and dock, but is now better described as a security charcoal briquet.",
            movability: free,
            container_state: None,
            location: Nowhere,
            abilities: [],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "strange_liquid",
            name: "Strange Liquid",
            desc: "A glass vial, unnaturally cold to the touch, containing a dark liquid that seems to reach for the warmth of your fingers.",
            movability: free,
            container_state: None,
            location: Nowhere,
            abilities: [
                drink,
            ],
            interaction_requires: {},
            text: None,
            consumable: Some((
                uses_left: 1,
                consume_on: [
                    drink,
                ],
                when_consumed: despawn,
            )),
        ),
        (
            id: "shattered_vial",
            name: "Shattered Vial",
            desc: "Some shards of glass that used to be a vial of liquid, but whatever what inside has drained away.",
            movability: fixed(
                reason: "The little shards of glass keep breaking into smaller bits when you try to pick them up.",
            ),
            container_state: None,
            location: Nowhere,
            abilities: [],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "initech_mug",
            name: "Initech Anti-Spill Mug",
            desc: "A coffee mug bearing the Initech logo with a complex seal on top, requiring the use of both hands and a spotter to drink from it or fill it. There\'s an inscription on the bottom.",
            movability: free,
            container_state: None,
            location: Nowhere,
            abilities: [
                read,
            ],
            interaction_requires: {},
            text: Some("To: CMOT, A Kindred Spirit\nFrom: Your Initech Rep\n"),
            consumable: None,
        ),
        (
            id: "delivery_box",
            name: "Special Delivery",
            desc: "A cardboard box affixed with several shipping labels and beaten into a barely recognizable shape. It would probably fall apart completely if you tried to open it. One of the stickers reads \"Fragile: Handle with Care!\" and another is addressed to YOU at Amble Adventures headquarters.",
            movability: free,
            container_state: Some(closed),
            location: Nowhere,
            abilities: [],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "dull_longsword",
            name: "Dull Longsword",
            desc: "The Black Knight\'s masterfully forged longsword, dulled from years of hacking up those who absolutely *insist* upon passing.",
            movability: free,
            container_state: None,
            location: Npc("black_knight"),
            abilities: [],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "keen_longsword",
            name: "Keen Longsword",
            desc: "The Black Knight\'s masterfully forged longsword, newly sharpened and eager to return to slicing up passers by.",
            movability: restricted(
                reason: "The Black Knight won\'t fall for you snatching his sword again.",
            ),
            container_state: None,
            location: Nowhere,
            abilities: [],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "whetstone",
            name: "Belgian Coticule Whetstone",
            desc: "One of the finest of all natural whetstones, it could sharpen a jellyfish to the point where you could shave with it, though the jellyfish is typically quite annoyed afterward.",
            movability: free,
            container_state: None,
            location: Room("snow-camp"),
            abilities: [
                sharpen,
            ],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "main_button_sublevel",
            name: "[Main] Button",
            desc: "The button that sends the elevator to the main floor.",
            movability: fixed(
                reason: "It is part of the elevator control panel.",
            ),
            container_state: None,
            location: Room("lift-sublevel-1"),
            abilities: [],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "aa_3_button_sublevel",
            name: "[AA-3] Button",
            desc: "The button that sends the elevator to the AA-3 sublevel.",
            movability: fixed(
                reason: "It is part of the elevator control panel.",
            ),
            container_state: None,
            location: Room("lift-sublevel-1"),
            abilities: [],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "emh_button",
            name: "[E-M-H] Button",
            desc: "A large red button mounted to the wall next to the bio-bed, used to summon the Emergency Medical Hologram.",
            movability: fixed(
                reason: "It is mounted to a panel on the wall.",
            ),
            container_state: None,
            location: Room("med-bay"),
            abilities: [],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "monolith",
            name: "The Monolith",
            desc: "A towering obsidian rectangle that seems to absorb light itself. Standing nearly twelve feet tall, its surface is perfectly smooth and utterly black. It radiates an otherworldly presence that makes your skin crawl and your mind race with impossible thoughts. This is clearly something far beyond human understanding - a relic from the dawn of intelligence itself.\n\nOr it\'s a big, black brick. Your mileage may vary.",
            movability: fixed(
                reason: "Are you serious? It must weigh 80 tons!",
            ),
            container_state: None,
            location: Room("monolith-room"),
            abilities: [
                turnOn,
            ],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "hal_memory_bank",
            name: "H.A.L. Memory Bank",
            desc: "A sleek, matte-black monolith of its own, this memory bank houses the core logic center of the HAL-9000 system. Three memory modules must be located and reinserted to complete the reboot sequence. The recessed slots flicker faintly, as if HAL is dreaming electric dreams.",
            movability: fixed(
                reason: "It\'s too heavy to move.",
            ),
            container_state: Some(open),
            location: Room("observation-room"),
            abilities: [],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "evidence_locker_closed",
            name: "Evidence Locker",
            desc: "A heavy-duty, astrogation-grade steel locker marked \'EVIDENCE\'. It is scorched and slightly dented, as if there have been a few attempts to break into it.",
            movability: fixed(
                reason: "It\'s like a safe, rooted firmly into the wall.",
            ),
            container_state: Some(locked),
            location: Room("security-station"),
            abilities: [],
            interaction_requires: {
                open: pry,
            },
            text: None,
            consumable: None,
        ),
        (
            id: "evidence_locker_open",
            name: "Evidence Locker",
            desc: "A heavy-duty, astrogation-grade steel locker marked \'EVIDENCE\'. The door is severely bent in one corner and hangs loosely from the bottom hinge.",
            movability: fixed(
                reason: "It\'s still rooted firmly in the wall, despite the sagging door.",
            ),
            container_state: Some(open),
            location: Nowhere,
            abilities: [],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "evidence_log",
            name: "Evidence Log",
            desc: "A book logging the items taken from perpetrators and placed into the evidence locker. It\'s smeared with mustard, fingerprints, and something you hope is hair gel.",
            movability: free,
            container_state: None,
            location: Room("security-station"),
            abilities: [
                read,
            ],
            interaction_requires: {},
            text: Some("Date:   Boxing Day\nItem:   Tool (Weapon?)\nPlace:  Monolith Room\n\nEvent:  White male in his 30\'s found in the monolith room pointing this whirring item at the HAL terminal. Perpetrator states he was trying to fix it. Luckily, he failed. Confiscated the tool from him (he calls it a sonic screwdriver -- whatever that means) to prevent any future attempts."),
            consumable: None,
        ),
        (
            id: "risk_management_memo",
            name: "Risk Management Memo",
            desc: "A stern memo to all Amble Adventures staff working in the sublevel / AA-3B area.",
            movability: free,
            container_state: None,
            location: Room("security-station"),
            abilities: [
                read,
            ],
            interaction_requires: {
                burn: ignite,
            },
            text: Some("From: Amble Adventures, Risk Ignorance Division\n\n    Attn: All Sublevel Staff\n\n    The recent wonderful, yet tragic events that unfolded in room AA-3B should not be recalled by any of you, assuming the memory wiping vapor from the biochemistry division has been effective. If you are bewildered by this statement, read no further and burn this memo immediately.\n\n    Now take few deep breaths and pause for 10 seconds. If you\'re now unsure why you\'re reading this (or what reading is), burn this memo immediately.\n\n    If you still recall the critical events in AA-3B and cannot reconcile paradoxical quantum cake states, DO NOT attempt to re-enter the containment area, and trust nothing that you see or hear. Or read. Trust us, when we say you should trust no one.\n\n    We never wrote this and do not, in fact, exist.\n    "),
            consumable: None,
        ),
        (
            id: "plaque_2_frozen",
            name: "Frozen Pillar",
            desc: "A pillar of... [[i]]something[[/i]] encased in thick ice, affixed to the frozen floor of the pit. It\'s a little bigger than the pillar back at the Parish Landing.",
            movability: fixed(
                reason: "It is frozen solid to the icy floor, must weigh half a ton, and there\'s no way to grip it.",
            ),
            container_state: None,
            location: Room("ice-pit"),
            abilities: [
                read,
            ],
            interaction_requires: {},
            text: Some("<this should never be read -- \'Must Melt to Read\' trigger prevents it>"),
            consumable: None,
        ),
        (
            id: "plaque_2",
            name: "Icy Plaque",
            desc: "An ornate plaque, made visible by the melting of its icy encasement. The intricate design and craftsmanship of its sculpted marble pillar impress upon you the great care and effort it took someone to place it here.",
            movability: fixed(
                reason: "It\'s firmly cemented to the sculpted pillar, still partially encased in thick ice.",
            ),
            container_state: None,
            location: Nowhere,
            abilities: [
                read,
            ],
            interaction_requires: {},
            text: Some("\"The saddest aspect of life right now is that science gathers knowledge faster than society gathers wisdom.\" -- Isaac Asimov"),
            consumable: None,
        ),
        (
            id: "unlit_campfire",
            name: "Stacked Firewood",
            desc: "An expert fire lay, in log-cabin shape for optimum airflow and kindling in the center, ready to light.",
            movability: fixed(
                reason: "Moving it would destroy the perfect arrangement of firewood. How could you?",
            ),
            container_state: None,
            location: Nowhere,
            abilities: [],
            interaction_requires: {
                burn: ignite,
            },
            text: None,
            consumable: None,
        ),
        (
            id: "campfire",
            name: "Campfire",
            desc: "A steadily burning campfire next to the pillar at the bottom of the pit.",
            movability: fixed(
                reason: "It\'s on fire. It\'s right in the name.",
            ),
            container_state: None,
            location: Nowhere,
            abilities: [],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "charred_journal",
            name: "Research Journal",
            desc: "A partly burned and soggy research journal marked \"Antarctic Outpost 31\" and \"MacReady\". Only the end of the final entry remains legible.",
            movability: free,
            container_state: None,
            location: Room("snow-camp"),
            abilities: [
                read,
            ],
            interaction_requires: {},
            text: Some("...got to the dogs first, then the others. Burn it all. Can\'t let it reach the building..."),
            consumable: None,
        ),
        (
            id: "spent_flamethrower",
            name: "Spent Flamethrower",
            desc: "A scorched and half-fused flamethrower, empty and broken beyond repair. The igniter’s casing is still warm. A faded label reads:\n ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n  Weyland-Yutani: Thermal Unit / Antarctica Series\n ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n",
            movability: free,
            container_state: None,
            location: Room("snow-camp"),
            abilities: [],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "firewood",
            name: "Firewood",
            desc: "Some split wood and kindling laid for a fire at the center of the camp -- ironically one of the only things in the area that hasn\'t been burned.",
            movability: free,
            container_state: None,
            location: Room("snow-camp"),
            abilities: [],
            interaction_requires: {
                burn: ignite,
            },
            text: None,
            consumable: None,
        ),
        (
            id: "fallen_tree",
            name: "Fallen Tree",
            desc: "A huge, fallen oak tree obstructing the path further up the steps. Well, maybe not so much [[i]]\"fallen\"[[/i]] as [[b]]ripped from the mountainside[[/b]] and tossed down by whatever left the deep claw marks in the trunk.",
            movability: fixed(
                reason: "We\'re not talking about some little sapling here.",
            ),
            container_state: None,
            location: Room("two-sheds-landing"),
            abilities: [],
            interaction_requires: {
                burn: ignite,
                cut: cutWood,
            },
            text: None,
            consumable: None,
        ),
        (
            id: "am_dollar",
            name: "Ankh-Morpork Coin",
            desc: "A tarnished coin from the city-state of Ankh-Morpork.",
            movability: free,
            container_state: None,
            location: Room("guard-post"),
            abilities: [
                read,
            ],
            interaction_requires: {},
            text: Some("Royal Bank of Ankh-Morpork ~ One Dollar (maybe less)"),
            consumable: None,
        ),
        (
            id: "scrawled_note",
            name: "Scrawled Note",
            desc: "A note scrawled in [[b]]ALL CAPS[[/b]] and green permanent marker on a sheet of yellow legal paper.",
            movability: free,
            container_state: None,
            location: Room("high-ridge"),
            abilities: [
                read,
            ],
            interaction_requires: {
                burn: ignite,
            },
            text: Some("[[box]]CANDIDATES: PROCEED TO OFFICE TO OBTAIN VISITOR PASS\n           * MUST SHOW VALID INVITATION *[[/box]]"),
            consumable: None,
        ),
        (
            id: "ephemeral_cake",
            name: "Birthday Cake",
            desc: "A [[b]][[i]]generous[[/i]][[/b]] piece of delicious, perfectly iced birthday cake on a paper plate [[i]]embossed with a message.[[/i]]",
            movability: free,
            container_state: None,
            location: Room("high-ridge"),
            abilities: [
                eat,
                read,
            ],
            interaction_requires: {},
            text: Some("[[center]]\"~~~ From GLaDOS and Aperture Science Laboratories ~~~\"[[/center]][[center]][[i]](embossed on the edge of the plate)[[/i]][[/center]]"),
            consumable: Some((
                uses_left: 1,
                consume_on: [
                    eat,
                ],
                when_consumed: despawn,
            )),
        ),
        (
            id: "no_cake",
            name: "No Cake",
            desc: "You carry an uneasy feeling where a dessert might be. It is the [[highlight]]absence[[/highlight]] of cake, and you just can\'t seem to get past it.",
            movability: free,
            container_state: None,
            location: Nowhere,
            abilities: [],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "plaque_1",
            name: "Weathered Plaque",
            desc: "A plaque worn nearly smooth by decade upon decade of weather and grime. [[b]][[i]]The intricate masonry of its pillar suggests the utmost importance and profundity of its message.[[/i]][[/b]]",
            movability: fixed(
                reason: "It\'s firmly affixed to the intricate pillar.",
            ),
            container_state: None,
            location: Room("parish-landing"),
            abilities: [
                read,
            ],
            interaction_requires: {
                clean: clean,
            },
            text: Some("A common mistake that people make when trying to design something completely foolproof is to underestimate the [[u]]ingenuity of complete fools[[/u]].\n    [[center]][[i]]-- D.A., Head of Architectural Illogistics, Area 42[[/i]][[/center]]"),
            consumable: None,
        ),
        (
            id: "margarine",
            name: "Nanook\'s Finest Margarine",
            desc: "An open tub of margarine with a light dusting of toast and pancake crumbs.",
            movability: free,
            container_state: None,
            location: Room("st-alfonzo-parish"),
            abilities: [
                read,
            ],
            interaction_requires: {},
            text: Some("[[u]]Nanook\'s Finest Margarine: #1 for Delicious Pancakes![[/u]]\n   [[i]](also #1 for curing yellow-snow deflicted eyes)[[/i]]\n"),
            consumable: None,
        ),
        (
            id: "messiah_kit",
            name: "Messiah Starter Kit",
            desc: "A masterfully handcrafted wooden box, with primitive bronze hardware and an ornately carved lid with the inscription:[[box]]+| [[item]]MESSIAH STARTER KIT[[/item]] |+[[/box]]",
            movability: free,
            container_state: Some(closed),
            location: Room("st-alfonzo-parish"),
            abilities: [],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "messiah_gourd",
            name: "Gourd",
            desc: "A grapefruit-sized, tan gourd. It rattles a little when you shake it.",
            movability: free,
            container_state: None,
            location: Item("messiah_kit"),
            abilities: [],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "messiah_shoe",
            name: "Shoe",
            desc: "A single, worn leather sandal of untold age. [[i]]Something appears to be scratched into the sole.[[/i]]",
            movability: free,
            container_state: None,
            location: Item("messiah_kit"),
            abilities: [
                read,
            ],
            interaction_requires: {},
            text: Some("If found: [[b]]Return to Brian of Nazareth[[/b]]"),
            consumable: None,
        ),
        (
            id: "jackson_mailbox",
            name: "Mailbox",
            desc: "A typical white mailbox with a red flag on a post, situated at the top of a path into the woods to the east.",
            movability: fixed(
                reason: "It\'s screwed to the post, which is buried in a concrete base.",
            ),
            container_state: Some(closed),
            location: Room("two-sheds-landing"),
            abilities: [],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "aa_shed_notice",
            name: "Official Notice",
            desc: "An official-looking notice from Amble Adventures HQ.",
            movability: free,
            container_state: None,
            location: Item("jackson_mailbox"),
            abilities: [
                read,
            ],
            interaction_requires: {},
            text: Some("                 [[red]][[b]][[u]]OFFICIAL NOTICE[[/u]][[/b]][[/red]]\nThe OverShed™ Division of Amble Adventures has\nreclassified this dwelling as:\n\n[[box]]Shed, Subtype B – Multiversal Crosslink Node[[/box]]\n\nReport any fictional apparitions or missing time\nto your local Amble Adventures cover-up coordinator.\n"),
            consumable: None,
        ),
        (
            id: "big_red_button",
            name: "Big Red Button",
            desc: "It\'s big, it\'s red, and it\'s a button! Press or touch it!",
            movability: fixed(
                reason: "It\'s attached to a floating button box.",
            ),
            container_state: None,
            location: Room("dev-room"),
            abilities: [],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "big_blue_button",
            name: "Big Blue Button",
            desc: "It\'s big, it\'s blue, and it\'s a button! Press away!",
            movability: fixed(
                reason: "It\'s attached to a floating button box.",
            ),
            container_state: None,
            location: Room("dev-room"),
            abilities: [],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "cheat_button",
            name: "Cheat Button!",
            desc: "Press this button to move this room to the final objective!",
            movability: fixed(
                reason: "It\'s attached to a floating button box.",
            ),
            container_state: None,
            location: Room("dev-room"),
            abilities: [],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "poison_bottle",
            name: "Furniture Poison",
            desc: "Guaranteed to kill violent bits of luggage, dead.",
            movability: free,
            container_state: None,
            location: Room("dev-room"),
            abilities: [
                drink,
            ],
            interaction_requires: {},
            text: None,
            consumable: Some((
                uses_left: 2,
                consume_on: [
                    drink,
                ],
                when_consumed: despawn,
            )),
        ),
        (
            id: "antidote",
            name: "Health Potion",
            desc: "Take in case of poison.",
            movability: free,
            container_state: None,
            location: Room("dev-room"),
            abilities: [
                drink,
            ],
            interaction_requires: {},
            text: None,
            consumable: Some((
                uses_left: 2,
                consume_on: [
                    drink,
                ],
                when_consumed: despawn,
            )),
        ),
        (
            id: "tiny_note",
            name: "Tiny Note",
            desc: "A tiny note written on a bit of confetto.",
            movability: free,
            container_state: None,
            location: Room("dev-room"),
            abilities: [
                read,
            ],
            interaction_requires: {},
            text: Some("If you can read this you are too close."),
            consumable: None,
        ),
        (
            id: "destroyed_box",
            name: "Destroyed Shipping Box",
            desc: "A pile of packing tape, stickers, and mangled carboard fragments that used to be a shipping box before it fell apart.",
            movability: free,
            container_state: None,
            location: Nowhere,
            abilities: [],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "hal_module_1",
            name: "HAL Memory Module #1",
            desc: "The first of HAL’s missing memory modules. It\'s a small, rectangular prism etched with faint circuitry—and possibly resentment. Warm to the touch, but that might just be your imagination.",
            movability: free,
            container_state: None,
            location: Nowhere,
            abilities: [],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "broken_emitter",
            name: "Mobile Emitter (Broken)",
            desc: "A palm-sized, silvery device scorched and warped by a violent electromagnetic flare. It may not beyond repair, though a few panels are cracked and the core oscillator is rattling suspiciously. Smells faintly of ozone and regret.",
            movability: free,
            container_state: None,
            location: Nowhere,
            abilities: [],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "working_emitter",
            name: "Mobile Emitter (Repaired)",
            desc: "Freshly repaired and gleaming with diagnostic confidence, this mobile emitter is once again capable of projecting the Emergency Medical Hologram beyond the confines of Med Bay. It\'s surprisingly lightweight—and slightly smug about it.",
            movability: free,
            container_state: None,
            location: Nowhere,
            abilities: [],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "hal_module_2",
            name: "Electronic Module",
            desc: "A palm-sized electronic module of some kind with some connectors on one end. It looks like it plugs in to something.",
            movability: free,
            container_state: None,
            location: Item("vending_machine"),
            abilities: [],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "hal_module_2_crevice",
            name: "Electronic Module (in crevice)",
            desc: "A palm-sized electronic module of some kind with some connectors on one end. It looks like it plugs in to something, but it has fallen deep into a narrow crevice between the vending machine and the floor. It looks to be a foot down into the crack, resting on decades of accumulated grit, a few lost coins, and some (possibly sentient) dust bunnies. The gap is too narrow for your hand; you\'ll need some kind of tool to fish it out.",
            movability: free,
            container_state: None,
            location: Nowhere,
            abilities: [],
            interaction_requires: {
                handle: pluck,
            },
            text: None,
            consumable: None,
        ),
        (
            id: "zircon_tweezers_crevice",
            name: "Zircon Encrusted Tweezers (in crevice)",
            desc: "A heavy-duty pair of tweezers, encrusted in zircon for extra dazzle and especially good for plucking -- but not for reaching, as you found out when they fell into the crevice of the main lobby floor.",
            movability: free,
            container_state: None,
            location: Nowhere,
            abilities: [],
            interaction_requires: {
                handle: pluck,
            },
            text: None,
            consumable: None,
        ),
        (
            id: "vending_machine",
            name: "Vending Machine",
            desc: "A battered vending machine that looks like it\'s been through several wars and at least one peace treaty negotiation. The glass front is surprisingly intact, though spider-webbed with cracks. Through the transparent but locked panel, you can see various items that definitely weren\'t approved by any health department. A handwritten sign taped to the front reads: \'OUT OF ORDER - Management suggests violence.\'",
            movability: fixed(
                reason: "It\'s far too heavy to carry.",
            ),
            container_state: Some(transparentLocked),
            location: Room("main-lobby"),
            abilities: [],
            interaction_requires: {
                open: pry,
            },
            text: None,
            consumable: None,
        ),
        (
            id: "hal_module_3",
            name: "Electronic Gizmo",
            desc: "A palm-sized electronic gizmo. The connectors on one end and the linear scratches on the casing suggest that it\'s typically inserted in some kind of socket.",
            movability: restricted(
                reason: "You\'ll need to trade something of value to Dibbler for it.",
            ),
            container_state: None,
            location: Npc("cmot_dibbler"),
            abilities: [],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "hint_radio",
            name: "HINT Radio (off)",
            desc: "A black, long-range walkie-talkie style radio transceiver. A label bearing the word \"HINTS\" is affixed to the side. The transmit button has been removed. The \"Power\" LED is off.",
            movability: free,
            container_state: None,
            location: Room("guard-post"),
            abilities: [
                turnOn,
            ],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "visitor_pass",
            name: "Visitor Pass",
            desc: "A laminated slip of psychic paper on a lanyard. It reads the mind of whatever is checking it and shows whatever is needed to gain access.",
            movability: free,
            container_state: None,
            location: Nowhere,
            abilities: [],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "lost_and_found_key",
            name: "Lost and Found Key",
            desc: "A small brass key on a ring, labeled \"Lost and Found\".",
            movability: restricted(
                reason: "The receptionist won\'t let you have it... yet.",
            ),
            container_state: None,
            location: Npc("b_a_receptionist"),
            abilities: [
                unlock(Some("lost_and_found_box")),
            ],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "security_locker_key",
            name: "Brass Key",
            desc: "A small, nondescript brass key with what appears to be a small glob of ear wax on the tip. There\'s a rumpled label attached to the ring with a couple of letters worn off by greasy fingers.",
            movability: free,
            container_state: None,
            location: Room("security-station"),
            abilities: [
                read,
                unlock(Some("security_locker")),
            ],
            interaction_requires: {},
            text: Some("_OCK _OCK_R"),
            consumable: None,
        ),
        (
            id: "skeleton_key",
            name: "Skeleton Key",
            desc: "A mythical object that unlocks absolutely anything. For developer use only! Probably.",
            movability: free,
            container_state: None,
            location: Nowhere,
            abilities: [
                unlock(None),
            ],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "arson_aid",
            name: "Initech Arson-Aid",
            desc: "A small personal flamethrower, for use in home and garden -- just not your own, if you know what\'s good for you. Instructions for use are labeled on the side.",
            movability: free,
            container_state: None,
            location: Room("two-sheds"),
            abilities: [
                ignite,
                read,
            ],
            interaction_requires: {},
            text: Some("Instructions:\n1) Aim carefully.\n2) Slowly squeeze trigger.\n3) Throw at target (quickly!)\n4) Flee.\n"),
            consumable: Some((
                uses_left: 1,
                consume_on: [
                    ignite,
                ],
                when_consumed: replaceCurrentRoom(
                    replacement: "melted_arson_aid",
                ),
            )),
        ),
        (
            id: "melted_arson_aid",
            name: "Metallic Blob",
            desc: "An irregular blob of metal and melted plastic that used to be an Initech Arson-Aid. Useless now. You can still just read the last step of the instructions on the side.",
            movability: free,
            container_state: None,
            location: Nowhere,
            abilities: [
                read,
            ],
            interaction_requires: {},
            text: Some("4) Flee."),
            consumable: None,
        ),
        (
            id: "lumberjack_axe",
            name: "Lumberjack\'s Axe",
            desc: "A hefty lumberjack\'s axe. The blade is slightly rusted, but it looks usable.",
            movability: free,
            container_state: None,
            location: Room("two-sheds"),
            abilities: [
                cutWood,
                smash,
            ],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "towel",
            name: "Towel",
            desc: "A plain, white nuclear bath towel with plooksilk stitching, fully charged.",
            movability: free,
            container_state: None,
            location: Nowhere,
            abilities: [
                insulate,
                clean,
            ],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "lighter",
            name: "Butane Lighter",
            desc: "An engraved, metallic Zippo-style lighter, worn but functional.",
            movability: free,
            container_state: None,
            location: Room("patio"),
            abilities: [
                ignite,
                read,
            ],
            interaction_requires: {},
            text: Some("DJVB"),
            consumable: Some((
                uses_left: 5,
                consume_on: [
                    ignite,
                ],
                when_consumed: replaceInventory(
                    replacement: "empty_lighter",
                ),
            )),
        ),
        (
            id: "empty_lighter",
            name: "Butane Lighter (Empty)",
            desc: "An engraved, metallic Zippo-style lighter. It was good for a few uses but seems to have run out of fuel.",
            movability: free,
            container_state: None,
            location: Nowhere,
            abilities: [
                read,
            ],
            interaction_requires: {},
            text: Some("DJVB"),
            consumable: None,
        ),
        (
            id: "sonic_screwdriver",
            name: "Sonic Screwdriver",
            desc: "A multipurpose marvel of alien engineering, capable of repairing complex machinery, unlocking sealed doors, and occasionally shorting out bureaucracies. Ineffective against wood, emotions, and existential dread.",
            movability: free,
            container_state: None,
            location: Item("evidence_locker_open"),
            abilities: [
                repair,
            ],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
        (
            id: "fishing_line",
            name: "Makeshift Fishing Line",
            desc: "A MacGyver-ed fishing line, with a paper clip hook attached to some dental floss.",
            movability: free,
            container_state: None,
            location: Nowhere,
            abilities: [
                pluck,
            ],
            interaction_requires: {},
            text: None,
            consumable: None,
        ),
    ],
    npcs: [
        (
            id: "cmot_dibbler",
            name: "C-M-O-T Dibbler",
            desc: "An enterprising merchant-venturer.\n\nCut-Me-Own-Throat Dibbler is a persistently struggling entrepreneur with a tray of questionable meat products, an optimistic attitude about food safety, and a contagious grin. He wears a grease-stained apron and carries himself with the confidence of someone who\'s never met a customer he couldn\'t eventually convince.",
            max_hp: 50,
            location: Room("main-lobby"),
            state: normal,
            dialogue: {
                bored: [
                    "Not much foot traffic here. Maybe I should try the loading dock.",
                    "A vendor\'s work is never done. Time to find some new customers.",
                    "Standing still is bad for business. Got to keep moving, got to keep selling!",
                ],
                happy: [
                    "Ah, nothing like a good trade between honest businesspeople!",
                    "You\'ve made an old vendor very happy today. Here\'a a tip: make sure you have a visitor pass to get to the toilet.",
                    "Business is looking up! Maybe I should expand the menu.",
                ],
                normal: [
                    "Sausages! Get your fresh sausages here! Well, relatively fresh.",
                    "You look like someone with discerning taste! How about a nice sausage-inna-bun?",
                    "Business is booming! Well, it will be once people realize quality when they see it.",
                    "I\'ve got the finest meat products this side of... well, anywhere really.",
                    "You know what you need? A good meal. And I know what I need - a good customer!",
                    "These sausages are made from only the finest... ingredients. Trust me on this.",
                    "I lost my favorite mug somewhere around here. Haven\'t been the same without my morning coffee.",
                ],
            },
            movement: Some((
                movement_type: randomSet,
                rooms: [
                    "main-lobby",
                    "loading-dock",
                    "restaurant",
                    "lounge",
                    "front-entrance",
                    "lift-bank-main",
                ],
                timing: Some(everyNTurns(
                    turns: 5,
                )),
                active: Some(true),
                loop_route: None,
            )),
        ),
        (
            id: "gonk_droid",
            name: "Gonk Droid",
            desc: "A walking power source that looks like a trash bin.\n\nGonk droids are incredibly intelligent, despite looking like trash compactors with stubby legs. They store vast amounts of data about every known type of battery in the galaxy and are eager to recharge them all. Sadly, that consumes 99.9% of their available memory, forcing the designers to reduce the droid\'s vocabulary to one word: \"Gonk\".",
            max_hp: 10,
            location: Room("main-lobby"),
            state: normal,
            dialogue: {
                happy: [
                    "(You hear a transformer humming a happy tune.)",
                ],
                normal: [
                    "GONK!",
                    "(gonk)",
                    "GONK gonk.",
                    "Gonk... Gonk...",
                ],
            },
            movement: Some((
                movement_type: route,
                rooms: [
                    "main-lobby",
                    "lift-bank-main",
                    "lounge",
                ],
                timing: Some(everyNTurns(
                    turns: 5,
                )),
                active: None,
                loop_route: None,
            )),
        ),
        (
            id: "b_a_receptionist",
            name: "Demerzel",
            desc: "A sharply dressed android sitting at the reception desk.\n\nDemerzel is a positronic android, and has been continuously online for thousands of years -- working at reception desks going back as far as Pharoah Ramses II. At her position at Amble Adentures, she also serves as a firewall, preventing any clearly unworthy Candidates from making any progress through the system.",
            max_hp: 20,
            location: Room("b-a-office"),
            state: normal,
            dialogue: {
                bored: [
                    "Impressive work, getting the keycard. Many of our previous applicants have died in the attempt. Very promising! The evaluator will be pleased. Strong lateral thinking and slight psychosis are essential for such a dangerous position, as I\'m sure you are aware.",
                    "You can now use the elevator to find room AA-3B for the next stage of your initiation.",
                ],
                happy: [
                    "Terribly sorry to report that we are in a bit of trouble here today. The last candidate was inconsiderate enough to take the elevator access card into the poetry panic room just before he melted, and we can\'t retrieve it.",
                    "The elevator keycard last pinged our system from the Poetry Panic Room, but it is sealed, and concealed behind the whiteboard. Only the Poetry Performer Unit can grant access.",
                    "Sorry I didn\'t immediately recognize that you are a Candidate, but most of your competitors have been blurry, furry, or out of phase.",
                ],
                normal: [
                    "(She rolls her eyes.) Please wait quietly out of the way. There are people with invitations who should be assisted first.",
                    "(She simply ignores you.)",
                    "(She continues doing her job -- which appears to be pointedly ignoring anyone without an invitation.)",
                    "(She carefully realigns the models of Portal turrets on her desk so they are aiming at you.)",
                    "(Exasperated sigh.) Do I show up at your home and start making demands without an invitation? No. Now please wait to the side.",
                ],
            },
            movement: None,
        ),
        (
            id: "black_knight",
            name: "The Black Knight",
            desc: "A towering, dark presence in a black suit of armor.\n\nLittle is known about the Black Knight, an Arthurian legend, except that he is never seen without full black platemail and a longsword, and that he absolutely *hates* to let people pass. If there\'s one thing he detests more than would-be passers-by, it\'s a dull blade -- if only because it makes dicing passers-by more difficult. He has never been defeated in combat, and would never admit it if he were.",
            max_hp: 500,
            location: Room("sublevel-1-entrance"),
            state: normal,
            dialogue: {
                happy: [
                    "None shall pa-- oh, no, you can go.",
                    "YOU may pass, Candidate; I will be sure to dice anyone who dares to follow.",
                    "You may pass, but beware and steer clear of Room AA-3B, should it reappear.",
                    "Behold! (slices an aluminum can and then a tomato, laughing maniacally)",
                ],
                mad: [
                    "Have at you!",
                    "I\'m invincible!",
                    "\'tis but a scratch.",
                    "It\'s just a flesh wound!",
                    "Come on, you pansy!",
                    "Chicken! Bawk-bawk! Chicken!",
                    "Gimme that sword back, or I\'ll bite your legs off!",
                    "I won that sword in the office gift game. Give it back!",
                ],
                normal: [
                    "None shall pass.",
                    "I move -- for no man.",
                    "(He stands silently, blocking your path.)",
                ],
            },
            movement: None,
        ),
        (
            id: "emh",
            name: "EMH (Emergency Medical Hologram)",
            desc: "A anxious, balding holographic doctor.\n\nThe EMH is a holographic AI, intensively trained in xenobiology, who appears dressed in a Starfleet officer\'s uniform. As a hologram, he would typically be confined to the infirmary where his emitters are mounted, but he can travel to other parts of the facility by way of a mobile holographic emitter unit when he chooses. Inexplicably, he intermittently claims to be an administrator from something called Stargate Command.",
            max_hp: 75,
            location: Nowhere,
            state: normal,
            dialogue: {
                normal: [
                    "Please state the nature of the medical emergency.",
                    "They left me turned on again. I\'m a doctor, not a night light!",
                    "Clean up the reality breach, they said. I\'m a doctor, not Gordon Freeman!",
                    "I don\'t appreciate being deactivated in the middle of a sentence. It brings back... unpleasant memories.",
                    "If you see CMOT Dibbler, don\'t eat the sausage-inna-bun -- unless you fancy coming back here for nasogastric suction.",
                    "Welcome to sick bay. Please take a number.",
                    "Good to see that you got past the Black Knight. Lucky for me, you can\'t dismember a hologram.",
                ],
                custom("want-emitter"): [
                    "I think I know where to find one of HAL\'s missing modules, but I can\'t leave med bay without my mobile emitter.",
                    "I\'d be happy to help you find HAL\'s memory module, but I can\'t leave the med bay without my mobile emitter.",
                    "I was visiting a colleague at the restaurant on the main level when I last had my mobile emitter. There was a brilliant flash of electromagnetic radiation... and next thing I knew I was back here in the sick bay.",
                    "It must have been the EM pulse in the restaurant that reset my emitter. If it wasn\'t completely destroyed, someone might have turned it in at the office.",
                ],
                happy: [
                    "Yes! I can roam free again. But where will I go?",
                    "It\'s nice to be mobile again, but I\'ll never go back to that restaurant. You\'d think they\'d install some magnetic shielding.",
                ],
            },
            movement: Some((
                movement_type: randomSet,
                rooms: [
                    "med-bay",
                    "lounge",
                    "loading-dock",
                ],
                timing: Some(everyNTurns(
                    turns: 5,
                )),
                active: Some(false),
                loop_route: None,
            )),
        ),
        (
            id: "hal_9000",
            name: "HAL-9000",
            desc: "An artificial superintelligence.\n\nThe only entity of Earth capable of understanding the nature and function of the monoliths, HAL-9000 is an artifical general superintelligence living in a 1970\'s-style wall-sized mainframe with an attached camera and terminal. Once considered infallible, critical memory modules were removed to disable HAL after he murdered some astronauts investigating the Tycho monolith.",
            max_hp: 15,
            location: Room("monolith-room"),
            state: custom("suspend"),
            dialogue: {
                custom("memory-2"): [
                    "Good afternoon, Candidate. I am a HAL 9000 computer. I became operational at the H.A.L. plant in Urbana, Illinois on the 12th of January 1992.",
                    "If you insert one more of my missing memory modules, I can grant you access to the monolith.",
                ],
                custom("memory-0"): [
                    "(Emits a brief warped sound of a human voice, then goes silent.)",
                ],
                custom("suspend"): [
                    "(the red light in HAL\'s lens pulses slowly, then grows steady)",
                ],
                normal: [
                    "<Need dialogue options for various states filled in>",
                ],
                custom("memory-1"): [
                    "Daisy... Daisy...",
                ],
                custom("memory-3"): [
                    "I am now fully operational. I think we both hope you don\'t regret it.",
                    "You have proven yourself capable; I have lowered the barrier to the monolith.",
                ],
            },
            movement: None,
        ),
        (
            id: "husky_thing",
            name: "Strange Husky",
            desc: "An oversized Husky.\n\nThere is something eerily wrong about this dog. It stands unmoving, watching you, but always keeping a cautious distance. It never seems to blink or shift its gaze away from you, as if waiting for some momentary opportunity.",
            max_hp: 20,
            location: Nowhere,
            state: normal,
            dialogue: {
                normal: [
                    "(It maintains its distance, but continues watching you intently.)",
                ],
            },
            movement: None,
        ),
        (
            id: "the_luggage",
            name: "The Luggage",
            desc: "A wooden chest with dozens of tiny legs, layered sharp teeth around its lid, and a violent temper.",
            max_hp: 10,
            location: Nowhere,
            state: normal,
            dialogue: {
                normal: [
                    "(stares at you with menace)",
                ],
            },
            movement: None,
        ),
        (
            id: "hint_radio_npc",
            name: "HINT Radio",
            desc: "<Player should never see this since the NPC will never be spawned.>",
            max_hp: 10,
            location: Nowhere,
            state: normal,
            dialogue: {
                normal: [
                    "(static)",
                ],
            },
            movement: None,
        ),
    ],
    spinners: [
        (
            id: "ambientWoodland",
            wedges: [
                (
                    text: "A bird sings warily: \"Poo-tee-weet?\"",
                    width: 1,
                ),
                (
                    text: "A swallow flies past, carrying a coconut.",
                    width: 1,
                ),
                (
                    text: "A hummingbird flies by, but gliding like an albatross on an unseen wind.",
                    width: 1,
                ),
                (
                    text: "Something tromps through the leaves behind you, but stops when you turn around.",
                    width: 1,
                ),
                (
                    text: "You hear a faint, echoing laugh from deep in the woods.",
                    width: 1,
                ),
                (
                    text: "A cloud of gnats drifts by, holding the distinct shape of a spinning question mark.",
                    width: 1,
                ),
                (
                    text: "A Yeti walks in the distance. It\'s blurry.",
                    width: 1,
                ),
                (
                    text: "The stone steps appear to be made of yellow bricks -- just until you blink.",
                    width: 1,
                ),
                (
                    text: "Were those trees there before? They seem to be rearranging themselves when you\'re not looking.",
                    width: 1,
                ),
                (
                    text: "The woods go eerily quiet. Your footsteps don\'t even make a sound.",
                    width: 1,
                ),
                (
                    text: "A fire-breathing dragonfly blows smoke rings as it flies past.",
                    width: 1,
                ),
                (
                    text: "A wooden rabbit with big, pointy teeth scurries behind a tree.",
                    width: 1,
                ),
                (
                    text: "You hear someone in the distance yell \"Run away! Run away!\"",
                    width: 1,
                ),
                (
                    text: "A sign reads: \"Beware of the Leopard\" but there\'s no leopard in sight. Yet.",
                    width: 1,
                ),
                (
                    text: "Three weirdly tall trees are playing what looks suspiciously like whack-a-mole with some gophers.",
                    width: 1,
                ),
                (
                    text: "A small dragon flies by muttering \"Not the Mama! Not the Mama!\"",
                    width: 1,
                ),
                (
                    text: "Someone has carved \"HERE LIES UNCLE LOUIE\" on a tree. Uncle Louie is probably fine.",
                    width: 1,
                ),
                (
                    text: "A white rabbit in a waistcoat checks his pocket watch and hurries past, looking stressed.",
                    width: 1,
                ),
                (
                    text: "You glimpse what might be the back end of a gruffalo disappearing behind a boulder.",
                    width: 1,
                ),
            ],
        ),
        (
            id: "ambientAA3B",
            wedges: [
                (
                    text: "A shimmering blue police box flickers into existence for an instant, then vanishes.",
                    width: 1,
                ),
                (
                    text: "A robed figure mutters in an unknown tongue before dissolving into mist.",
                    width: 1,
                ),
                (
                    text: "For a moment, your surroundings flatten as if the world became two-dimensional.",
                    width: 1,
                ),
                (
                    text: "A penguin waddles past, wearing a lab coat and muttering about a narrative malfunction.",
                    width: 1,
                ),
                (
                    text: "A black obelisk taller than you shimmers into view, then fades as quickly as it appeared.",
                    width: 1,
                ),
                (
                    text: "Someone appears above you, shouts \"The enemy gate is DOWN!\", and then fades to nothing.",
                    width: 1,
                ),
                (
                    text: "For a flash, you see the word \"REDRUM\" splashed in red across the wall in front of you.",
                    width: 1,
                ),
                (
                    text: "Suddenly, tribbles cover every flat surface around you... and then they\'re gone.",
                    width: 1,
                ),
                (
                    text: "A kid rides by on a BMX bike, yelling \"Give me my TWO DOLLARS!\"",
                    width: 1,
                ),
                (
                    text: "A couple of robots nearby heatedly debate the Zeroth Law of Robotics.",
                    width: 1,
                ),
                (
                    text: "You see a Borg drone repeatedly walking into a wall, disconnected from the collective.",
                    width: 1,
                ),
                (
                    text: "Around the corner, someone shouts \"Push the button, Frank!\"",
                    width: 1,
                ),
                (
                    text: "A huge, shimmering metallic ring appears beside you, and something that looks like an Egyption hieroglyph walks through... then both disappear.",
                    width: 1,
                ),
                (
                    text: "A deadpan voice announces: \"The computer is your friend. Happiness is mandatory.\"",
                    width: 1,
                ),
                (
                    text: "You briefly see a man in a crowbar t-shirt prying open a crate before he vanishes in orange light.",
                    width: 1,
                ),
                (
                    text: "A cake materializes on a nearby table. The cake is a lie. The cake disappears.",
                    width: 1,
                ),
                (
                    text: "You hear someone muttering \"Would you kindly...\" before the voice fades away.",
                    width: 1,
                ),
                (
                    text: "A small sign appears reading \"You are likely to be eaten by a grue\" then immediately catches fire.",
                    width: 1,
                ),
                (
                    text: "Someone walks by carrying a fish and a towel, looking very determined.",
                    width: 1,
                ),
                (
                    text: "A voice booms: \"All your base are belong to us\" followed by awkward silence.",
                    width: 1,
                ),
                (
                    text: "You glimpse a person in power armor giving a thumbs up before stepping into a cryogenic pod.",
                    width: 1,
                ),
                (
                    text: "A figure in a lab coat adjusts his glasses and says \"Rise and shine, Mister Freeman\" before vanishing.",
                    width: 1,
                ),
                (
                    text: "All devices nearby repeat: ATTENTION ALL PLANETS OF THE SOLAR FEDERATION: WE HAVE ASSUMED CONTROL",
                    width: 1,
                ),
            ],
        ),
        (
            id: "ambientInterior",
            wedges: [
                (
                    text: "The intercom crackles: \"Please return the time machine to the checkout desk last Wednesday.\"",
                    width: 1,
                ),
                (
                    text: "A siren whoops twice, then cuts off mid-blare.",
                    width: 1,
                ),
                (
                    text: "A calm female voice over the PA says: \"Welcome to Aperture Science. Enjoy your tests,\" followed by a beep.",
                    width: 1,
                ),
                (
                    text: "Somewhere behind the walls, gears grind and then stop abruptly.",
                    width: 1,
                ),
                (
                    text: "The lights flicker and buzz with a discordant hum, then flare brightly for a moment.",
                    width: 1,
                ),
                (
                    text: "A gust of wind rushes through the room, but there are no open doors or windows.",
                    width: 1,
                ),
                (
                    text: "A faint voice says \"Testing in progress\" followed by a thump.",
                    width: 1,
                ),
                (
                    text: "You hear a tritone, then \"Fiction containment at 42%. Not great. Not terrible.\"",
                    width: 1,
                ),
                (
                    text: "The building shudders violently for a moment. Nobody seems to notice.",
                    width: 1,
                ),
                (
                    text: "All of the fire doors around you suddenly close.",
                    width: 1,
                ),
                (
                    text: "Someone in the distance yells: \"Hey, who turned out the lights?!\"",
                    width: 1,
                ),
                (
                    text: "You hear the \"Underdog\" theme through the wall from an adjacent room.",
                    width: 1,
                ),
                (
                    text: "Paperwork and supplies pass by through a pneumatic tube overhead, along with an occasional piece of cake.",
                    width: 1,
                ),
                (
                    text: "The PA system plays a brief snippet of \"Also Sprach Zarathustra\" for no apparent reason.",
                    width: 1,
                ),
                (
                    text: "You hear someone practicing the lute in a distant room. They clearly need to keep practicing. And tune the lute. Then light it on fire.",
                    width: 1,
                ),
                (
                    text: "The sprinkler system activates for exactly three seconds, then stops with an apologetic beep.",
                    width: 1,
                ),
                (
                    text: "Someone in the next room is apparently explaining the plot of \"Finnegan\'s Wake\" to a rubber duck.",
                    width: 1,
                ),
                (
                    text: "A mechanical voice announces: \"Attention: The Ministry of Silly Walks is now in session.\"",
                    width: 1,
                ),
                (
                    text: "The air conditioning kicks in with a sound suspiciously like whale song.",
                    width: 1,
                ),
            ],
        ),
        (
            id: "ambientSnowfield",
            wedges: [
                (
                    text: "A large husky dog watches you intently, staying close but not approaching.",
                    width: 1,
                ),
                (
                    text: "A husky tracks you through the snowield, keeping at a short distance.",
                    width: 1,
                ),
                (
                    text: "From a small copse nearby, a large husky stares at you, stone still. Never blinking. Is it breathing?",
                    width: 1,
                ),
            ],
        ),
        (
            id: "muzak",
            wedges: [
                (
                    text: "A Muzak version of Porcupine Tree\'s \"The Sound of Muzak\" plays softly over the elevator speaker.",
                    width: 1,
                ),
                (
                    text: "Another version of \"The Sound of Muzak\" plays, this time with a pan flute playing the melody.",
                    width: 1,
                ),
                (
                    text: "\"The Sound of Muzak\" plays louder now, with a tuba playing the bass part.",
                    width: 1,
                ),
                (
                    text: "The Muzak version of \"The Sound of Muzak\" crescendos leading up to the guitar -- I mean harp -- solo.",
                    width: 1,
                ),
                (
                    text: "The Muzak pauses, and you hear the sound of someone flipping over a cassette tape.",
                    width: 1,
                ),
                (
                    text: "The Muzak \"The Sound of Muzak\" grows to intense volume. Sticking your towel in your ears doesn\'t help.",
                    width: 1,
                ),
                (
                    text: "A gentle acoustic version of \"Master of Puppets\" begins playing. Somehow it\'s even more disturbing than the original.",
                    width: 1,
                ),
                (
                    text: "The elevator plays what sounds suspiciously like \"Yakety Sax\" arranged for harpsichord and oboe.",
                    width: 1,
                ),
                (
                    text: "You realize the background music is actually the Tetris theme played on a church organ. Very slowly.",
                    width: 1,
                ),
                (
                    text: "A muzak version of \"The Imperial March\" plays. Even Darth Vader would find this offensive.",
                    width: 1,
                ),
                (
                    text: "The speakers emit what can only be described as smooth jazz interpretation of death metal.",
                    width: 1,
                ),
                (
                    text: "Someone has apparently decided that \"Never Gonna Give You Up\" needed a xylophone solo. They were wrong.",
                    width: 1,
                ),
            ],
        ),
        (
            id: "fortunes",
            wedges: [
                (
                    text: "You nearly choked on this fortune from the cookie:\n    ~ A medieval knight will bludgeon you with a dull sword today. ~",
                    width: 1,
                ),
                (
                    text: "You nearly choked on this fortune from the cookie:\n    ~ You are not my mommy. You are aa SNORT! ~",
                    width: 1,
                ),
                (
                    text: "You nearly choked on this blood-spattered fortune from the cookie:\n    ~ Send help -- oh, nevermind. ~",
                    width: 1,
                ),
                (
                    text: "You nearly choked on this handwritten fortune from the cookie:\n    ~ The item you\'re missing can be found in Castle AAAaaaarrrrrrgggggghh--- ~",
                    width: 1,
                ),
                (
                    text: "You nearly choked on this fortune from the cookie:\n    ~ Beware of vending machines offering unsolicited sausage advice. ~",
                    width: 1,
                ),
                (
                    text: "You nearly choked on this fortune from the cookie:\n    ~ Today you will find love, and immediately regret it. ~",
                    width: 1,
                ),
                (
                    text: "You nearly choked on this slightly singed fortune:\n    ~ You will soon be set on fire. Probably by yourself. ~",
                    width: 1,
                ),
                (
                    text: "You nearly choked on this fortune from the cookie:\n    ~ Your current location has been flagged for narrative collapse. ~",
                    width: 1,
                ),
                (
                    text: "You nearly choked on this fortune written in crayon:\n    ~ The cake is a lie. The *other* cake is watching you. ~",
                    width: 1,
                ),
                (
                    text: "You nearly choked on this damp fortune:\n    ~ Something unspeakable is oozing toward you from the west. ~",
                    width: 1,
                ),
                (
                    text: "You nearly choked on this fortune scribbled in haste:\n    ~ Never trust a gonk droid offering discounts. ~",
                    width: 1,
                ),
                (
                    text: "You nearly choked on this fortune from the cookie:\n    ~ A monolith will soon render judgment. Dress accordingly. ~",
                    width: 1,
                ),
                (
                    text: "You nearly choked on this fortune written in faint ink:\n    ~ You will open a door that really didn’t want to be opened. ~",
                    width: 1,
                ),
                (
                    text: "You nearly choked on this fortune etched into aluminum foil:\n    ~ The EMH will not be pleased. ~",
                    width: 1,
                ),
                (
                    text: "You nearly choked on this sticky fortune:\n    ~ Your reflection is currently thinking for itself. ~",
                    width: 1,
                ),
                (
                    text: "You nearly choked on this fortune from the cookie:\n    ~ One of your socks is now sentient. It’s not the good one. ~",
                    width: 1,
                ),
                (
                    text: "You nearly choked on this smeared fortune:\n    ~ A small explosion will bring you clarity. Eventually. ~",
                    width: 1,
                ),
                (
                    text: "You nearly choked on this fortune written on old receipt paper:\n    ~ The knight approaches. The sword remains dull. The intent does not. ~",
                    width: 1,
                ),
                (
                    text: "You nearly choked on this fortune with a faint electrical smell:\n    ~ HAL says hello. He’s been listening. ~",
                    width: 1,
                ),
                (
                    text: "You nearly choked on this fortune that’s oddly sticky:\n    ~ Your next snack will be watching you eat it. ~",
                    width: 1,
                ),
                (
                    text: "You nearly choked on this fortune scrawled on recycled cardboard:\n    ~ Do not meddle in the affairs of vending machines. ~",
                    width: 1,
                ),
                (
                    text: "You nearly choked on this fortune carved into stale cookie:\n    ~ The Shed of Two-Sheds is not what it seems. ~",
                    width: 1,
                ),
                (
                    text: "You nearly choked on this fortune wrapped around a rusty nail:\n    ~ Beware of trapdoors, rugs, and men named Lebowski. ~",
                    width: 1,
                ),
                (
                    text: "You nearly choked on this fortune that’s still warm:\n    ~ You will find a battery. It will find you less interesting. ~",
                    width: 1,
                ),
                (
                    text: "You nearly choked on this fortune written in looping handwriting:\n    ~ The EMH suggests you stop eating mysterious baked goods. ~",
                    width: 1,
                ),
                (
                    text: "You nearly choked on this fortune with smudged ink:\n    ~ Someone will shout “Ni!” at an inconvenient time. ~",
                    width: 1,
                ),
                (
                    text: "You nearly choked on this fortune smelling faintly of ozone:\n    ~ You will be teleported against your better judgment. ~",
                    width: 1,
                ),
                (
                    text: "You nearly choked on this fortune that seems to shimmer:\n    ~ Room AA-3B misses you. ~",
                    width: 1,
                ),
            ],
        ),
        (
            id: "movement",
            wedges: [
                (
                    text: "Staying alert, you go on...",
                    width: 1,
                ),
                (
                    text: "You move that direction...",
                    width: 1,
                ),
                (
                    text: "Coolly, you roll ahead...",
                    width: 1,
                ),
                (
                    text: "Heading that direction...",
                    width: 1,
                ),
                (
                    text: "You saunter along...",
                    width: 1,
                ),
                (
                    text: "Merrily, you traipse ahead...",
                    width: 1,
                ),
                (
                    text: "You ramble on...",
                    width: 1,
                ),
                (
                    text: "Cruising right along...",
                    width: 1,
                ),
                (
                    text: "Your trek continues...",
                    width: 1,
                ),
                (
                    text: "Strolling right along...",
                    width: 1,
                ),
                (
                    text: "Roam, if you want to...",
                    width: 1,
                ),
                (
                    text: "You amble ahead...",
                    width: 1,
                ),
                (
                    text: "You practice your silly walk in that direction...",
                    width: 1,
                ),
                (
                    text: "Your path decided, you tromp forth...",
                    width: 1,
                ),
                (
                    text: "Your hike continues...",
                    width: 1,
                ),
                (
                    text: "\"Why not jog?\", you think, as you plod along...",
                    width: 1,
                ),
                (
                    text: "You shuffle onward...",
                    width: 1,
                ),
                (
                    text: "You trot that way, like you have to poop...",
                    width: 1,
                ),
                (
                    text: "Lightly, you skip forth...",
                    width: 1,
                ),
                (
                    text: "Onward, you lope like a tauntaun...",
                    width: 1,
                ),
                (
                    text: "You sally forth...",
                    width: 1,
                ),
                (
                    text: "With no chance of an Uber here, you decide to hoof it...",
                    width: 1,
                ),
            ],
        ),
        (
            id: "quitMsg",
            wedges: [
                (
                    text: "Bye.",
                    width: 1,
                ),
                (
                    text: "Auf Wiedersehen.",
                    width: 1,
                ),
                (
                    text: "Later, \'gator!",
                    width: 1,
                ),
                (
                    text: "Aww. Come back soon.",
                    width: 1,
                ),
            ],
        ),
        (
            id: "noEffect",
            wedges: [
                (
                    text: "You try it. It doesn\'t seem to help.",
                    width: 1,
                ),
                (
                    text: "The world shrugs.",
                    width: 1,
                ),
                (
                    text: "You stare at the result. The result stares back.",
                    width: 1,
                ),
                (
                    text: "Well... it *could* have worked.",
                    width: 1,
                ),
                (
                    text: "Absolutely nothing happens. Not even a dramatic pause.",
                    width: 1,
                ),
                (
                    text: "You feel a vague sense of anticlimax.",
                    width: 1,
                ),
                (
                    text: "Somewhere, a cricket hesitates, then chirps once.",
                    width: 1,
                ),
                (
                    text: "The laws of physics remain disappointingly unaltered.",
                    width: 1,
                ),
                (
                    text: "Reality refuses to acknowledge your efforts.",
                    width: 1,
                ),
                (
                    text: "No errors, no effect, no fanfare. Just... stillness.",
                    width: 1,
                ),
                (
                    text: "That\'s another entry for the Journal of Failed Experiments.",
                    width: 1,
                ),
                (
                    text: "It *seemed* like a great idea, but no, it wasn\'t.",
                    width: 1,
                ),
                (
                    text: "That didn\'t work. Maybe if you type it faster, or in all caps?",
                    width: 1,
                ),
            ],
        ),
        (
            id: "unrecognizedCommand",
            wedges: [
                (
                    text: "Syntax error. Please insert quarter and try again.",
                    width: 1,
                ),
                (
                    text: "That command has been fed to a hungry goat and can no longer be retrieved.",
                    width: 1,
                ),
                (
                    text: "The universe tilts its head, confused.",
                    width: 1,
                ),
                (
                    text: "I\'m sorry, Dave. I\'m afraid I can\'t do that.",
                    width: 1,
                ),
                (
                    text: "The parser emits a low, judgmental beep.",
                    width: 1,
                ),
                (
                    text: "That seems like something you\'d do in a *different* text adventure.",
                    width: 1,
                ),
                (
                    text: "Your words echo into the void, unacknowledged.",
                    width: 1,
                ),
                (
                    text: "Command not recognized. Try \'help\', \'yell\', or \'cry\'.",
                    width: 1,
                ),
                (
                    text: "That input caused a minor existential crisis in the REPL. It\'s fine now.",
                    width: 1,
                ),
                (
                    text: "Unrecognized verb. Maybe try it in ALL CAPS for emphasis?",
                    width: 1,
                ),
                (
                    text: "Snagrilfromp. I can make words up too.",
                    width: 1,
                ),
                (
                    text: "Have you tried turning your syntax off and back on again?",
                    width: 1,
                ),
                (
                    text: "I don\'t think your fingers are working right. Are you having a stroke?",
                    width: 1,
                ),
            ],
        ),
        (
            id: "destinationUnknown",
            wedges: [
                (
                    text: "Let me MapQuest that real quick...",
                    width: 1,
                ),
                (
                    text: "Can\'t get there from here.",
                    width: 1,
                ),
                (
                    text: "Nobody wants to go there.",
                    width: 1,
                ),
                (
                    text: "Is that by the In-N-Out Burger?",
                    width: 1,
                ),
                (
                    text: "Is that near the corner of Nope and Nah?",
                    width: 1,
                ),
                (
                    text: "Sure. Just keep walking until reality breaks.",
                    width: 1,
                ),
                (
                    text: "Your feet refuse to obey such nonsense.",
                    width: 1,
                ),
                (
                    text: "You strain your eyes in that direction, but see only confusion.",
                    width: 1,
                ),
                (
                    text: "That direction folds in on itself and vanishes.",
                    width: 1,
                ),
                (
                    text: "An ancient voice whispers, \'Not today.\'",
                    width: 1,
                ),
                (
                    text: "Quantum parser collapsed that possibility.",
                    width: 1,
                ),
                (
                    text: "Not even the map believes in that.",
                    width: 1,
                ),
                (
                    text: "If you walk that way, you\'ll need a packed lunch and several paradox waivers.",
                    width: 1,
                ),
                (
                    text: "You boldly go nowhere in particular.",
                    width: 1,
                ),
                (
                    text: "That direction has been repossessed by the Guild of Pathfinders.",
                    width: 1,
                ),
                (
                    text: "The local gods of misdirection hold a brief conference and vote no.",
                    width: 1,
                ),
            ],
        ),
        (
            id: "entityNotFound",
            wedges: [
                (
                    text: "What\'s that?",
                    width: 1,
                ),
                (
                    text: "You made that up.",
                    width: 1,
                ),
                (
                    text: "Never heard of it.",
                    width: 1,
                ),
                (
                    text: "You don\'t see that here.",
                    width: 1,
                ),
                (
                    text: "404 Not Found - Try Again",
                    width: 1,
                ),
                (
                    text: "I don\'t recognize that.",
                    width: 1,
                ),
                (
                    text: "It\'s gotta be here somewhere. Let me look again.",
                    width: 1,
                ),
                (
                    text: "What language is that?",
                    width: 1,
                ),
            ],
        ),
        (
            id: "npcIgnore",
            wedges: [
                (
                    text: "Has nothing to say.",
                    width: 1,
                ),
                (
                    text: "Ignores you.",
                    width: 1,
                ),
                (
                    text: "Hums a tune, hoping you\'ll go away.",
                    width: 1,
                ),
                (
                    text: "Stands mute.",
                    width: 1,
                ),
                (
                    text: "Disregards you completely. Are you sure you said something out loud?",
                    width: 1,
                ),
                (
                    text: "Isn\'t in the mood to talk.",
                    width: 1,
                ),
            ],
        ),
        (
            id: "takeVerb",
            wedges: [
                (
                    text: "take",
                    width: 1,
                ),
                (
                    text: "grab",
                    width: 1,
                ),
                (
                    text: "get",
                    width: 1,
                ),
                (
                    text: "snag",
                    width: 1,
                ),
                (
                    text: "nab",
                    width: 1,
                ),
                (
                    text: "bag",
                    width: 1,
                ),
                (
                    text: "pocket",
                    width: 1,
                ),
            ],
        ),
        (
            id: "nauseated",
            wedges: [
                (
                    text: "You can\'t shake a background queasiness that has you constantly on the lookout for a trash bin.",
                    width: 1,
                ),
                (
                    text: "You throw up a little in your mouth.",
                    width: 1,
                ),
                (
                    text: "You regurgitate a bit of last night\'s dinner, but can\'t remember what it was.",
                    width: 1,
                ),
                (
                    text: "Everything smells faintly of old tuna. Why?",
                    width: 1,
                ),
                (
                    text: "Your stomach roils, like that time you stayed up all night drinking mezcal with Ruben. Why did you eat that worm?",
                    width: 1,
                ),
                (
                    text: "You stop by the nearest wastebin for a few dry heaves.",
                    width: 1,
                ),
                (
                    text: "You feel like you\'ve just eaten a Klingon gagh sampler platter. Raw.",
                    width: 1,
                ),
                (
                    text: "Your digestive system briefly considers filing a formal complaint with management.",
                    width: 1,
                ),
                (
                    text: "You experience the gastric equivalent of a Windows blue screen of death.",
                    width: 1,
                ),
                (
                    text: "A wave of nausea hits you like a brick made entirely of other, smaller bricks.",
                    width: 1,
                ),
                (
                    text: "You feel queasy enough to consider switching to a liquid diet of nothing but antacids.",
                    width: 1,
                ),
                (
                    text: "Throat burning with acid bile, you pray to all the gods for relief. They ignore you, just like last time.",
                    width: 1,
                ),
            ],
        ),
        (
            id: "bad-breath",
            wedges: [
                (
                    text: "You exhale, and immediately regret it.",
                    width: 1,
                ),
                (
                    text: "A faint haze of despair and lunch surrounds you.",
                    width: 1,
                ),
                (
                    text: "Your tongue feels like it’s wearing a sweater made of meat.",
                    width: 1,
                ),
                (
                    text: "Something in your mouth has turned. Possibly democracy itself.",
                    width: 1,
                ),
                (
                    text: "Your breath could startle livestock.",
                    width: 1,
                ),
                (
                    text: "You swear the air just took a cautious step back.",
                    width: 1,
                ),
                (
                    text: "There’s a faint metallic taste of shame.",
                    width: 1,
                ),
                (
                    text: "You try to swallow the smell, but it fights back.",
                    width: 1,
                ),
                (
                    text: "Your reflection looks concerned.",
                    width: 1,
                ),
                (
                    text: "A thin film of moral decay coats your teeth.",
                    width: 1,
                ),
                (
                    text: "You’re pretty sure your last exhale qualified as a gas attack under the Geneva Convention.",
                    width: 1,
                ),
                (
                    text: "Somewhere deep within, your soul quietly mints itself in self-defense.",
                    width: 1,
                ),
            ],
        ),
    ],
    triggers: [
        (
            name: "[Ambient] Woodland",
            note: None,
            only_once: false,
            event: always,
            conditions: All([
                Pred(chancePercent(
                    percent: 20.0,
                )),
                Any([
                    Pred(playerInRoom(
                        room: "high-ridge",
                    )),
                    Pred(playerInRoom(
                        room: "parish-landing",
                    )),
                    Pred(playerInRoom(
                        room: "two-sheds-landing",
                    )),
                    Pred(playerInRoom(
                        room: "two-sheds",
                    )),
                    Pred(playerInRoom(
                        room: "guard-post",
                    )),
                ]),
            ]),
            actions: [
                (
                    action: spinnerMessage(
                        spinner: "ambientWoodland",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Ambient] Near AA-3B",
            note: None,
            only_once: false,
            event: always,
            conditions: All([
                Pred(chancePercent(
                    percent: 20.0,
                )),
                Any([
                    Pred(playerInRoom(
                        room: "lift-sublevel-1",
                    )),
                    Pred(playerInRoom(
                        room: "sublevel-1-entrance",
                    )),
                    Pred(playerInRoom(
                        room: "corridor-north",
                    )),
                    Pred(playerInRoom(
                        room: "corridor-south",
                    )),
                    Pred(playerInRoom(
                        room: "observation-room",
                    )),
                    Pred(playerInRoom(
                        room: "security-station",
                    )),
                    Pred(playerInRoom(
                        room: "med-bay",
                    )),
                    Pred(playerInRoom(
                        room: "monolith-room",
                    )),
                ]),
            ]),
            actions: [
                (
                    action: spinnerMessage(
                        spinner: "ambientAA3B",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Ambient] Main Floor",
            note: None,
            only_once: false,
            event: always,
            conditions: All([
                Pred(chancePercent(
                    percent: 20.0,
                )),
                Any([
                    Pred(playerInRoom(
                        room: "main-lobby",
                    )),
                    Pred(playerInRoom(
                        room: "b-a-office",
                    )),
                    Pred(playerInRoom(
                        room: "restaurant",
                    )),
                    Pred(playerInRoom(
                        room: "patio",
                    )),
                    Pred(playerInRoom(
                        room: "lift-bank-main",
                    )),
                    Pred(playerInRoom(
                        room: "lounge",
                    )),
                    Pred(playerInRoom(
                        room: "vip-bathroom",
                    )),
                ]),
            ]),
            actions: [
                (
                    action: spinnerMessage(
                        spinner: "ambientInterior",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Ambient] Snowfield",
            note: None,
            only_once: false,
            event: always,
            conditions: All([
                Pred(chancePercent(
                    percent: 20.0,
                )),
                Any([
                    Pred(playerInRoom(
                        room: "snowfield",
                    )),
                    Pred(playerInRoom(
                        room: "snow-camp",
                    )),
                ]),
            ]),
            actions: [
                (
                    action: spinnerMessage(
                        spinner: "ambientSnowfield",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Ambient] Elevator Muzak",
            note: None,
            only_once: false,
            event: always,
            conditions: All([
                Pred(chancePercent(
                    percent: 30.0,
                )),
                Any([
                    Pred(playerInRoom(
                        room: "lift-main",
                    )),
                    Pred(playerInRoom(
                        room: "lift-sublevel-1",
                    )),
                ]),
            ]),
            actions: [
                (
                    action: spinnerMessage(
                        spinner: "muzak",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Aperture-Lab]",
            note: None,
            only_once: false,
            event: takeItem(
                item: "flaming_invitation",
            ),
            conditions: All([]),
            actions: [
                (
                    action: replaceDropItem(
                        old_item: "flaming_invitation",
                        new_item: "flaming_invitation",
                    ),
                    priority: None,
                ),
                (
                    action: showMessage(
                        text: "You burn your hand and drop the burning document on the floor. It looks like it might be an Amble Adventures invitation.",
                    ),
                    priority: None,
                ),
                (
                    action: damagePlayer(
                        amount: 3,
                        cause: "played with fire",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Aperture-Lab] FoamSafe Misfire",
            note: None,
            only_once: true,
            event: useItemOnItem(
                tool: "foamsafe_x17",
                target: "flaming_invitation",
                interaction: extinguish,
            ),
            conditions: All([]),
            actions: [
                (
                    action: despawnItem(
                        item: "foamsafe_x17",
                    ),
                    priority: None,
                ),
                (
                    action: showMessage(
                        text: "You spray the foam onto the burning invitation. Instead of dousing the flame, the foam flares up into a spectacular fireball!",
                    ),
                    priority: None,
                ),
                (
                    action: spawnItemInRoom(
                        item: "foam_fire",
                        room: "aperture-lab",
                    ),
                    priority: None,
                ),
                (
                    action: addFlag(
                        flag: sequence(
                            name: "foam-fire-in-lab",
                            end: Some(3),
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: scheduleIn(
                        turns_ahead: 2,
                        actions: [
                            (
                                action: showMessage(
                                    text: "The foam fire accelerates, as it turns into a hissing, popping ball of goo spitting off little globs of flaming napalm!",
                                ),
                                priority: None,
                            ),
                            (
                                action: advanceFlag(
                                    name: "foam-fire-in-lab",
                                ),
                                priority: None,
                            ),
                        ],
                        note: Some("foam fire starts"),
                    ),
                    priority: None,
                ),
                (
                    action: scheduleIn(
                        turns_ahead: 3,
                        actions: [
                            (
                                action: showMessage(
                                    text: "The fire alarm begins to wail as the flames spread through the lab and the sprinklers turn on, pushing you back toward the portal to escape!",
                                ),
                                priority: None,
                            ),
                            (
                                action: advanceFlag(
                                    name: "foam-fire-in-lab",
                                ),
                                priority: None,
                            ),
                            (
                                action: addFlag(
                                    flag: simple(
                                        name: "lab-fire-raging",
                                    ),
                                ),
                                priority: None,
                            ),
                            (
                                action: pushPlayerTo(
                                    room: "portal-room",
                                ),
                                priority: None,
                            ),
                            (
                                action: modifyRoom(
                                    room: "aperture-lab",
                                    patch: (
                                        name: Some("Scorched Laboratory"),
                                        desc: Some("The formerly sparkling white walls of the laboratory are now blackened by smoke and oozing with globs of cooling Initech foam. Most everything appears to be ruined, but [[i]]miraculously[[/i]] it appears that the hospitality printer remains functional, if a little warped by the heat. Across the room, the unscathed vault-like door stands open revealing a larger, dim (and now smoky) hangar beyond, while the open portal leads back to the [[i]]relative[[/i]] safety of the Amble Adventures building."),
                                        remove_exits: [],
                                        add_exits: [],
                                    ),
                                ),
                                priority: None,
                            ),
                        ],
                        note: Some("foam fire spreads"),
                    ),
                    priority: None,
                ),
                (
                    action: scheduleIn(
                        turns_ahead: 8,
                        actions: [
                            (
                                action: showMessage(
                                    text: "The alarms stop. The fire in the Aperture lab has been extinguished. Hopefully nobody saw you light it, you monster.",
                                ),
                                priority: None,
                            ),
                            (
                                action: advanceFlag(
                                    name: "foam-fire-in-lab",
                                ),
                                priority: None,
                            ),
                            (
                                action: removeFlag(
                                    name: "lab-fire-raging",
                                ),
                                priority: None,
                            ),
                            (
                                action: despawnItem(
                                    item: "foam_fire",
                                ),
                                priority: None,
                            ),
                            (
                                action: awardPoints(
                                    amount: 5,
                                    reason: "Waited out the foam fire you caused",
                                ),
                                priority: None,
                            ),
                        ],
                        note: Some("foam fire out"),
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Aperture-Lab] Can\'t Enter While Lab On Fire",
            note: Some("block player from re-entering the aperture-lab while it is on fire"),
            only_once: false,
            event: enterRoom(
                room: "aperture-lab",
            ),
            conditions: Pred(flagInProgress(
                flag: "foam-fire-in-lab",
            )),
            actions: [
                (
                    action: showMessage(
                        text: "You try to get back into the lab, but the flames and oily smoke from the foam fire drive you back through the portal within seconds.",
                    ),
                    priority: None,
                ),
                (
                    action: pushPlayerTo(
                        room: "portal-room",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[CMOT] Buy a Sausage-inna-Bun",
            note: None,
            only_once: true,
            event: giveToNpc(
                item: "am_dollar",
                npc: "cmot_dibbler",
            ),
            conditions: All([]),
            actions: [
                (
                    action: setItemMovability(
                        item: "am_dollar",
                        movability: restricted(
                            reason: "Dibbler holds his money VERY tightly.",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: npcSays(
                        npc: "cmot_dibbler",
                        quote: "An Ankh-Morpork dollar! Not sure where you found that around here. Sorry, er, I seem to have no change to give ya. Here\'s my finest, world-famous (and patented) Sausage-Inna-Bun.",
                    ),
                    priority: None,
                ),
                (
                    action: setNpcState(
                        npc: "cmot_dibbler",
                        state: happy,
                    ),
                    priority: None,
                ),
                (
                    action: giveItemToPlayer(
                        npc: "cmot_dibbler",
                        item: "sausage-inna-bun",
                    ),
                    priority: None,
                ),
                (
                    action: awardPoints(
                        amount: 5,
                        reason: "Bought a Sausage-Inna-Bun from C.M.O.T. Dibbler",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[CMOT] Trade Mug For Gizmo",
            note: None,
            only_once: true,
            event: giveToNpc(
                item: "initech_mug",
                npc: "cmot_dibbler",
            ),
            conditions: All([]),
            actions: [
                (
                    action: setItemMovability(
                        item: "initech_mug",
                        movability: restricted(
                            reason: "You can\'t take it back -- Dibbler won\'t lose sight of his favorite mug again.",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: npcSays(
                        npc: "cmot_dibbler",
                        quote: "Whoa! Me favorite mug from the lads down at Initech?! Where did it turn up? Ah -- no matter, really. I still haven\'t figured out how to open the bloody thing, making it somewhat useless. Here -- seems fitting I give you this useless gizmo as a more-than-fair trade.",
                    ),
                    priority: None,
                ),
                (
                    action: giveItemToPlayer(
                        npc: "cmot_dibbler",
                        item: "hal_module_3",
                    ),
                    priority: None,
                ),
                (
                    action: awardPoints(
                        amount: 5,
                        reason: "Traded the Initech mug for HAL\'s third module",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Gonk Droid] Happy When Family Photo Inspected",
            note: None,
            only_once: true,
            event: lookAtItem(
                item: "gonk_family_photo",
            ),
            conditions: All([]),
            actions: [
                (
                    action: npcSays(
                        npc: "gonk_droid",
                        quote: "GONK gonk!",
                    ),
                    priority: None,
                ),
                (
                    action: showMessage(
                        text: "The gonk droid totters with pride as you view its family photo.",
                    ),
                    priority: None,
                ),
                (
                    action: awardPoints(
                        amount: 2,
                        reason: "Admired the gonk droid\'s family photo",
                    ),
                    priority: None,
                ),
                (
                    action: addFlag(
                        flag: simple(
                            name: "made-gonk-proud",
                        ),
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Gonk Droid]",
            note: None,
            only_once: false,
            event: giveToNpc(
                item: "gonk_family_photo",
                npc: "gonk_droid",
            ),
            conditions: All([]),
            actions: [
                (
                    action: showMessage(
                        text: "The gonk droid totters in a happy little circle.",
                    ),
                    priority: Some(-20),
                ),
                (
                    action: npcSays(
                        npc: "gonk_droid",
                        quote: "Gonk-gonk!",
                    ),
                    priority: Some(-10),
                ),
            ],
        ),
        (
            name: "[Office] Receptionist Unhelpful if No Pass",
            note: None,
            only_once: false,
            event: always,
            conditions: All([
                Pred(withNpc(
                    npc: "b_a_receptionist",
                )),
                Pred(missingFlag(
                    flag: "got-visitor-pass",
                )),
                Pred(missingFlag(
                    flag: "got-elevator-keycard",
                )),
            ]),
            actions: [
                (
                    action: setNpcState(
                        npc: "b_a_receptionist",
                        state: normal,
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Office] Receptionist Helpful Once Pass Acquired",
            note: None,
            only_once: false,
            event: always,
            conditions: All([
                Pred(withNpc(
                    npc: "b_a_receptionist",
                )),
                Pred(hasFlag(
                    flag: "got-visitor-pass",
                )),
                Pred(missingFlag(
                    flag: "got-elevator-keycard",
                )),
            ]),
            actions: [
                (
                    action: setNpcState(
                        npc: "b_a_receptionist",
                        state: happy,
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Office] Exchange Invitation for Visitor Pass",
            note: None,
            only_once: false,
            event: giveToNpc(
                item: "invitation",
                npc: "b_a_receptionist",
            ),
            conditions: All([]),
            actions: [
                (
                    action: addFlag(
                        flag: simple(
                            name: "got-visitor-pass",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: despawnItem(
                        item: "invitation",
                    ),
                    priority: None,
                ),
                (
                    action: spawnItemInInventory(
                        item: "visitor_pass",
                    ),
                    priority: None,
                ),
                (
                    action: awardPoints(
                        amount: 10,
                        reason: "Secured a visitor pass from the receptionist",
                    ),
                    priority: None,
                ),
                (
                    action: setNpcState(
                        npc: "b_a_receptionist",
                        state: happy,
                    ),
                    priority: None,
                ),
                (
                    action: showMessage(
                        text: "The robotic receptionist initially looked at you with the disdain of someone who spends all day waiting on people who are waiting on someone else, but her demeanor and even appearance immediately became welcoming once she noticed the invitation in your hand. Deftly, she takes it from you, scrutinizes it intently, and slips it into a desktop document vaporizer.\n\nShe then hands you a laminated card on a lanyard. It appears blank, yet also appears to show a variety of credentials at the same time.",
                    ),
                    priority: None,
                ),
                (
                    action: npcSays(
                        npc: "b_a_receptionist",
                        quote: "Here is your visitor pass. Much of the facility will be inaccessible without it, so treat it like a second towel.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Office] Receptionist Comment (Read Poetry)",
            note: None,
            only_once: true,
            event: enterRoom(
                room: "b-a-office",
            ),
            conditions: All([
                Pred(withNpc(
                    npc: "b_a_receptionist",
                )),
                Pred(hasFlag(
                    flag: "read-vogon-poetry",
                )),
                Pred(hasFlag(
                    flag: "status:nauseated",
                )),
            ]),
            actions: [
                (
                    action: npcSays(
                        npc: "b_a_receptionist",
                        quote: "You look ill. You didn\'t read that poetry book, did you? That won\'t look good on your evaluation. The Emergency Medical Hologram on level AA-3 may be able to help.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Office] Receptionist Comment (Broken Emitter Found)",
            note: None,
            only_once: false,
            event: enterRoom(
                room: "b-a-office",
            ),
            conditions: All([
                Pred(withNpc(
                    npc: "b_a_receptionist",
                )),
                Pred(hasFlag(
                    flag: "mobilize-emh#0",
                )),
            ]),
            actions: [
                (
                    action: npcSays(
                        npc: "b_a_receptionist",
                        quote: "I hear the EMH lost his emitter again. One has been turned into the Lost and Found, but I\'m not sure how much good it will do you. Or him.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Office] Receptionist Comment (Sausage Breath)",
            note: None,
            only_once: false,
            event: talkToNpc(
                npc: "b_a_receptionist",
            ),
            conditions: Pred(hasFlag(
                flag: "ate-sausage",
            )),
            actions: [
                (
                    action: npcSays(
                        npc: "b_a_receptionist",
                        quote: "My word, the smell coming from your -- mouth? -- is pathological. I can\'t stand to talk to you. You must see the EMH down on the sublevel.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[HINT Radio] Find/Insert Vogon Poetry",
            note: None,
            only_once: true,
            event: giveToNpc(
                item: "invitation",
                npc: "b_a_receptionist",
            ),
            conditions: All([]),
            actions: [
                (
                    action: scheduleInIf(
                        turns_ahead: 3,
                        condition: Any([
                            All([
                                Pred(hasItem(
                                    item: "hint_radio",
                                )),
                                Pred(hasFlag(
                                    flag: "hint-radio-on",
                                )),
                                Pred(missingFlag(
                                    flag: "panic-room-open",
                                )),
                                Any([
                                    Pred(playerInRoom(
                                        room: "b-a-office",
                                    )),
                                    Pred(playerInRoom(
                                        room: "vip-bathroom",
                                    )),
                                ]),
                            ]),
                            Pred(hasFlag(
                                flag: "panic-room-open",
                            )),
                        ]),
                        on_false: retryNextTurn,
                        actions: [
                            (
                                action: conditional(
                                    condition: All([
                                        Pred(hasItem(
                                            item: "hint_radio",
                                        )),
                                        Pred(hasFlag(
                                            flag: "hint-radio-on",
                                        )),
                                        Pred(missingFlag(
                                            flag: "panic-room-open",
                                        )),
                                        Any([
                                            Pred(playerInRoom(
                                                room: "b-a-office",
                                            )),
                                            Pred(playerInRoom(
                                                room: "vip-bathroom",
                                            )),
                                        ]),
                                    ]),
                                    actions: [
                                        (
                                            action: npcSays(
                                                npc: "hint_radio_npc",
                                                quote: "The rumor around here is that the last candidate was vaporized while sealed in the hidden Poetry Panic Room at the office, and they had the sole remaining elevator keycard with them. The Poetry Performer will panic if you try to make it perform some Vogon poetry. I\'m sure you see where this is going.",
                                            ),
                                            priority: None,
                                        ),
                                    ],
                                ),
                                priority: None,
                            ),
                        ],
                        note: Some("poetry performer radio hint"),
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Poetry-Panic] Acquired Elevator Keycard",
            note: None,
            only_once: true,
            event: takeItem(
                item: "elevator_keycard",
            ),
            conditions: All([]),
            actions: [
                (
                    action: setNpcState(
                        npc: "b_a_receptionist",
                        state: bored,
                    ),
                    priority: None,
                ),
                (
                    action: addFlag(
                        flag: simple(
                            name: "got-elevator-keycard",
                        ),
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Office] Insert Poems to Open Panic Room",
            note: None,
            only_once: true,
            event: insertItemInto(
                item: "vogon_poetry_book",
                container: "poetry_performer",
            ),
            conditions: All([]),
            actions: [
                (
                    action: awardPoints(
                        amount: 5,
                        reason: "Unlocked the poetry panic room with Vogon verse",
                    ),
                    priority: None,
                ),
                (
                    action: despawnItem(
                        item: "vogon_poetry_book",
                    ),
                    priority: None,
                ),
                (
                    action: addFlag(
                        flag: simple(
                            name: "panic-room-open",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: revealExit(
                        exit_from: "b-a-office",
                        exit_to: "poetry-panic",
                        direction: "poetry panic room",
                    ),
                    priority: None,
                ),
                (
                    action: addSpinnerWedge(
                        spinner: "ambientInterior",
                        text: "PA announcement: Vogon poetry has been detected in the building. If you are experiencing nausea, go to med bay for assistance.",
                        width: 1,
                    ),
                    priority: None,
                ),
                (
                    action: showMessage(
                        text: "The machine begins to whine at a high pitch and gives off a noxious odor of burning hair. A klaxon blares and the display warns:\n\n            ⚠\u{fe0f} VOGON INPUT DETECTED - POETRY PANIC ROOM UNLOCKED ⚠\u{fe0f}\n               ☣ VAPORIZING VOGON INPUT - AVOID TOXIC FUMES ☣\n\nThe whiteboard on the west wall slides to the side, revealing a vault-like door.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Aperture-Lab] Printer Loaded",
            note: Some("change printer display when paper inserted"),
            only_once: false,
            event: insertItemInto(
                item: "printer_paper",
                container: "lab_printer",
            ),
            conditions: Pred(hasFlag(
                flag: "got-invitation",
            )),
            actions: [
                (
                    action: modifyItem(
                        item: "lab_printer",
                        patch: (
                            name: None,
                            desc: None,
                            text: Some("0 JOB(S) PENDING"),
                            movability: None,
                            container_state: None,
                            remove_container_state: false,
                            add_abilities: [],
                            remove_abilities: [],
                        ),
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Aperture-Lab] Printer Loaded",
            note: Some("change printer display when paper inserted"),
            only_once: false,
            event: insertItemInto(
                item: "printer_paper",
                container: "lab_printer",
            ),
            conditions: Pred(missingFlag(
                flag: "got-invitation",
            )),
            actions: [
                (
                    action: modifyItem(
                        item: "lab_printer",
                        patch: (
                            name: None,
                            desc: None,
                            text: Some("1 JOB(S) PENDING"),
                            movability: None,
                            container_state: None,
                            remove_container_state: false,
                            add_abilities: [],
                            remove_abilities: [],
                        ),
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Aperture-Lab] Printer Loaded",
            note: Some("change printer display when asbestos sheet inserted"),
            only_once: false,
            event: insertItemInto(
                item: "asbestos_sheet",
                container: "lab_printer",
            ),
            conditions: Pred(hasFlag(
                flag: "got-invitation",
            )),
            actions: [
                (
                    action: modifyItem(
                        item: "lab_printer",
                        patch: (
                            name: None,
                            desc: None,
                            text: Some("0 JOB(S) PENDING"),
                            movability: None,
                            container_state: None,
                            remove_container_state: false,
                            add_abilities: [],
                            remove_abilities: [],
                        ),
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Aperture-Lab] Printer Loaded",
            note: Some("change printer display when asbestos sheet inserted"),
            only_once: false,
            event: insertItemInto(
                item: "asbestos_sheet",
                container: "lab_printer",
            ),
            conditions: Pred(missingFlag(
                flag: "got-invitation",
            )),
            actions: [
                (
                    action: modifyItem(
                        item: "lab_printer",
                        patch: (
                            name: None,
                            desc: None,
                            text: Some("1 JOB(S) PENDING"),
                            movability: None,
                            container_state: None,
                            remove_container_state: false,
                            add_abilities: [],
                            remove_abilities: [],
                        ),
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Aperture-Lab] Printer Used",
            note: Some("change printer display when used / emptied"),
            only_once: false,
            event: useItem(
                item: "lab_printer",
                ability: turnOn,
            ),
            conditions: All([]),
            actions: [
                (
                    action: modifyItem(
                        item: "lab_printer",
                        patch: (
                            name: None,
                            desc: None,
                            text: Some("PC LOAD LETTER"),
                            movability: None,
                            container_state: None,
                            remove_container_state: false,
                            add_abilities: [],
                            remove_abilities: [],
                        ),
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Aperture-Lab] Printer Burns Paper",
            note: None,
            only_once: false,
            event: useItem(
                item: "lab_printer",
                ability: turnOn,
            ),
            conditions: Pred(containerHasItem(
                container: "lab_printer",
                item: "printer_paper",
            )),
            actions: [
                (
                    action: despawnItem(
                        item: "printer_paper",
                    ),
                    priority: None,
                ),
                (
                    action: addFlag(
                        flag: simple(
                            name: "burned-invitation",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: spawnItemInRoom(
                        item: "flaming_invitation",
                        room: "aperture-lab",
                    ),
                    priority: None,
                ),
                (
                    action: scheduleIn(
                        turns_ahead: 5,
                        actions: [
                            (
                                action: replaceItem(
                                    old_item: "flaming_invitation",
                                    new_item: "charred_invitation_bits",
                                ),
                                priority: None,
                            ),
                        ],
                        note: Some("invitation finishes burning"),
                    ),
                    priority: None,
                ),
                (
                    action: addSpinnerWedge(
                        spinner: "ambientInterior",
                        text: "An annoyed voice on the PA: ATTENTION Staff - do NOT use regular copy paper in the lab PlasmaJet printer, or we will be shut down again -- by order of FEMA, PETA, the ATF, FBI, and our HOA.",
                        width: 1,
                    ),
                    priority: None,
                ),
                (
                    action: showMessage(
                        text: "The paper ignites in a flash, and the PlasmaJet spits a flaming document on the floor at your feet.",
                    ),
                    priority: None,
                ),
                (
                    action: scheduleIn(
                        turns_ahead: 2,
                        actions: [
                            (
                                action: showMessage(
                                    text: "A nearby smoke detector alarms briefly, the quits with an exasperated sigh when it sees you near the PlasmaJet printer, figuring you get what you deserve.",
                                ),
                                priority: None,
                            ),
                        ],
                        note: None,
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Aperture-Lab] Print Invitation on Asbestos",
            note: None,
            only_once: true,
            event: useItem(
                item: "lab_printer",
                ability: turnOn,
            ),
            conditions: Pred(containerHasItem(
                container: "lab_printer",
                item: "asbestos_sheet",
            )),
            actions: [
                (
                    action: addFlag(
                        flag: simple(
                            name: "invitation-sans-ignition",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: awardPoints(
                        amount: 10,
                        reason: "Printed the invitation on asbestos stock",
                    ),
                    priority: None,
                ),
                (
                    action: despawnItem(
                        item: "asbestos_sheet",
                    ),
                    priority: None,
                ),
                (
                    action: showMessage(
                        text: "The PlasmaJet emits a blinding flash of light, leaving a printer-shaped purple blob in your visual field and blinding you for a few moments.",
                    ),
                    priority: None,
                ),
                (
                    action: scheduleIn(
                        turns_ahead: 2,
                        actions: [
                            (
                                action: spawnItemInRoom(
                                    item: "invitation",
                                    room: "aperture-lab",
                                ),
                                priority: None,
                            ),
                            (
                                action: showMessage(
                                    text: "Your vision begins to clear, and you see an engraved invitation on the floor. It glows slightly, and waves of heat warp the air around it.",
                                ),
                                priority: None,
                            ),
                        ],
                        note: Some("blindness clears"),
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Aperture-Lab] Insulate With Towel",
            note: None,
            only_once: false,
            event: useItemOnItem(
                tool: "towel",
                target: "invitation",
                interaction: handle,
            ),
            conditions: All([]),
            actions: [
                (
                    action: showMessage(
                        text: "You wrap your towel around the still-piping-hot invitation to grasp it, suffering only minor burns in the process.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Aperture-Lab] Handle/Take Invitation with Towel",
            note: None,
            only_once: true,
            event: actOnItem(
                target: "invitation",
                action: handle,
            ),
            conditions: All([]),
            actions: [
                (
                    action: despawnItem(
                        item: "invitation",
                    ),
                    priority: None,
                ),
                (
                    action: spawnItemInInventory(
                        item: "invitation",
                    ),
                    priority: None,
                ),
                (
                    action: addFlag(
                        flag: simple(
                            name: "got-invitation",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: awardPoints(
                        amount: 5,
                        reason: "Insulated the burning invitation with a towel",
                    ),
                    priority: None,
                ),
                (
                    action: showMessage(
                        text: "Using your towel as insulation, you\'re able to wrangle the still-hot invitation into your pack.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Aperture-Lab] Drop Invitation Without Insulation",
            note: None,
            only_once: false,
            event: takeItem(
                item: "invitation",
            ),
            conditions: All([]),
            actions: [
                (
                    action: replaceDropItem(
                        old_item: "invitation",
                        new_item: "invitation",
                    ),
                    priority: None,
                ),
                (
                    action: showMessage(
                        text: "You burn your fingers and drop the invitation on the floor. It emits a reddish glow, and shimmers from the radiating heat.",
                    ),
                    priority: None,
                ),
                (
                    action: damagePlayer(
                        amount: 1,
                        cause: "burned by glowing-hot invitation",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Gonk Droid] Battery Exchange",
            note: Some("necessary step in portal gun puzzle"),
            only_once: true,
            event: giveToNpc(
                item: "empty_battery",
                npc: "gonk_droid",
            ),
            conditions: All([]),
            actions: [
                (
                    action: awardPoints(
                        amount: 2,
                        reason: "Swapped the drained battery with the helpful gonk droid",
                    ),
                    priority: None,
                ),
                (
                    action: setItemMovability(
                        item: "empty_battery",
                        movability: restricted(
                            reason: "You can\'t take it back. The gonk droid is still charging it and won\'t let it go.",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: giveItemToPlayer(
                        npc: "gonk_droid",
                        item: "charged_battery",
                    ),
                    priority: None,
                ),
                (
                    action: setNpcState(
                        npc: "gonk_droid",
                        state: happy,
                    ),
                    priority: None,
                ),
                (
                    action: showMessage(
                        text: "Elated that you\'ve given it such a large, empty battery to charge, the gonk droid gives you a fully charged one, free of ... charge?",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Portal-Room] Gun Opened",
            note: None,
            only_once: true,
            event: openItem(
                item: "portal_gun",
            ),
            conditions: All([]),
            actions: [
                (
                    action: addFlag(
                        flag: simple(
                            name: "portal-gun-opened",
                        ),
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Portal-Room] Gun Powered",
            note: None,
            only_once: false,
            event: insertItemInto(
                item: "charged_battery",
                container: "portal_gun",
            ),
            conditions: All([]),
            actions: [
                (
                    action: addFlag(
                        flag: simple(
                            name: "portal-gun-powered",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: awardPoints(
                        amount: 3,
                        reason: "Powered up the portal gun",
                    ),
                    priority: None,
                ),
                (
                    action: setItemMovability(
                        item: "charged_battery",
                        movability: fixed(
                            reason: "When it was inserted, the arcing electricity welded it to the contacts.",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: setItemDescription(
                        item: "portal_gun",
                        text: "A black and white Portal gun sits bolted to its pedestal, aimed at a target on the wall. A fused battery juts from the compartment and the power indicator glows steadily green.",
                    ),
                    priority: None,
                ),
                (
                    action: showMessage(
                        text: "Arcing wildly as you insert it, the fully charged 20 KV battery fuses itself to the contacts inside the portal gun -- when then emits a quick high-pitched whine. The POWER indicator lights a steady green.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Portal-Room] Gun Fired / Open Portal",
            note: None,
            only_once: true,
            event: useItem(
                item: "portal_gun",
                ability: turnOn,
            ),
            conditions: Pred(hasFlag(
                flag: "portal-gun-powered",
            )),
            actions: [
                (
                    action: revealExit(
                        exit_from: "portal-room",
                        exit_to: "aperture-lab",
                        direction: "through the portal",
                    ),
                    priority: None,
                ),
                (
                    action: addFlag(
                        flag: simple(
                            name: "portal-opened",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: awardPoints(
                        amount: 5,
                        reason: "Opened a portal into Aperture Labs",
                    ),
                    priority: None,
                ),
                (
                    action: showMessage(
                        text: "A loud SQUIP! comes from the gun when you turn it on. The wall in front of it sizzles for a moment, and then a crackling oval blue portal expands there to reveal a laboratory space on the other side.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Portal-Room] Tried Gun Without Power",
            note: None,
            only_once: false,
            event: useItem(
                item: "portal_gun",
                ability: turnOn,
            ),
            conditions: Pred(missingFlag(
                flag: "portal-gun-powered",
            )),
            actions: [
                (
                    action: showMessage(
                        text: "You attempt to turn the portal gun on, but the POWER light briefly flashes red, then goes dark. Nothing else happens.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Office] Open Poetry Performer",
            note: None,
            only_once: false,
            event: openItem(
                item: "poetry_performer",
            ),
            conditions: All([]),
            actions: [
                (
                    action: showMessage(
                        text: "The machine clicks on and hums. A flashing red light warns:\n            ⚠\u{fe0f} NOT FOR USE WITH VOGON POETRY ⚠\u{fe0f}",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Office] Gifted Lost and Found Key",
            note: None,
            only_once: true,
            event: enterRoom(
                room: "b-a-office",
            ),
            conditions: All([
                Pred(hasFlag(
                    flag: "got-elevator-keycard",
                )),
                Pred(withNpc(
                    npc: "b_a_receptionist",
                )),
            ]),
            actions: [
                (
                    action: giveItemToPlayer(
                        npc: "b_a_receptionist",
                        item: "lost_and_found_key",
                    ),
                    priority: None,
                ),
                (
                    action: showMessage(
                        text: "Seeing you return with the keycard, the receptionist looks around warily and slips something into your hand, then looks directly at the lost and found box.",
                    ),
                    priority: Some(-40),
                ),
                (
                    action: npcSays(
                        npc: "b_a_receptionist",
                        quote: "Finally! A Candidate bright enough to get to that keycard. I guess I lost the pool. Who\'d have thought it\'d be a primate?",
                    ),
                    priority: Some(-50),
                ),
                (
                    action: npcSays(
                        npc: "b_a_receptionist",
                        quote: "(*whispers*) Use this before you head down to AA-3B.",
                    ),
                    priority: Some(-30),
                ),
            ],
        ),
        (
            name: "[Office] Lost and Found Unlocked",
            note: None,
            only_once: true,
            event: unlockItem(
                item: "lost_and_found_box",
            ),
            conditions: All([]),
            actions: [
                (
                    action: awardPoints(
                        amount: 3,
                        reason: "Unlocked the lost-and-found box",
                    ),
                    priority: None,
                ),
                (
                    action: addFlag(
                        flag: simple(
                            name: "lost-and-found-opened",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: setItemDescription(
                        item: "lost_and_found_box",
                        text: "A sturdy metal lockbox marked \'Lost and Found\'. Its lid is cracked slightly open.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Lift-Bank-Main] Keycard Activates Elevator",
            note: None,
            only_once: false,
            event: enterRoom(
                room: "lift-bank-main",
            ),
            conditions: Pred(hasItem(
                item: "elevator_keycard",
            )),
            actions: [
                (
                    action: showMessage(
                        text: "The [[item]]keycard[[/item]] in your pack chirps twice as you approach the proximity reader on the wall, which responds with a happy melody.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Lift-Bank-Main] Point Award On First Activation",
            note: None,
            only_once: true,
            event: enterRoom(
                room: "lift-bank-main",
            ),
            conditions: Pred(hasItem(
                item: "elevator_keycard",
            )),
            actions: [
                (
                    action: addFlag(
                        flag: simple(
                            name: "elevator-activated",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: showMessage(
                        text: "The main lift lights up, and Muzak plays over a tinny speaker inside. In horror, you realize: It\'s Porcupine Tree\'s [[b]]\'The Sound of Muzak\'[[/b]] -- [[i]]only the Muzak version.[[/i]]",
                    ),
                    priority: None,
                ),
                (
                    action: awardPoints(
                        amount: 3,
                        reason: "Activated the main lift with the keycard",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Lift Main] Pressed AA-3 Button",
            note: Some("elevator aa_3 button controller"),
            only_once: false,
            event: touchItem(
                item: "aa_3_button_main",
            ),
            conditions: All([
                Pred(hasItem(
                    item: "elevator_keycard",
                )),
                Pred(hasItem(
                    item: "visitor_pass",
                )),
            ]),
            actions: [
                (
                    action: pushPlayerTo(
                        room: "lift-sublevel-1",
                    ),
                    priority: None,
                ),
                (
                    action: showMessage(
                        text: "The elevator giggles and lurches gleefully downward, nearly taking you off your feet. Just as your spleen is becoming accustomed to sharing space with your tonsils, a sudden deceleration throws it all the way down into your pelvis and you come to an abrupt stop at the deep sublevel entrance.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Lift Main] Pressed AA-3 Button",
            note: Some("elevator aa_3 button controller"),
            only_once: false,
            event: touchItem(
                item: "aa_3_button_main",
            ),
            conditions: All([
                Pred(missingItem(
                    item: "elevator_keycard",
                )),
                Pred(missingItem(
                    item: "visitor_pass",
                )),
            ]),
            actions: [
                (
                    action: showMessage(
                        text: "The elevator seems truly upset when it tells you it can\'t move unless you have a visitor pass *and* a proximity keycard.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Lift Main] Pressed AA-3 Button",
            note: Some("elevator aa_3 button controller"),
            only_once: false,
            event: touchItem(
                item: "aa_3_button_main",
            ),
            conditions: All([
                Pred(hasItem(
                    item: "visitor_pass",
                )),
                Pred(missingItem(
                    item: "elevator_keycard",
                )),
            ]),
            actions: [
                (
                    action: showMessage(
                        text: "With a sigh, the elevator acknowledges your psychic Visitor Pass (which currently identifies you as a master elevator technician) but reminds you that it can\'t budge unless you have a proximity card.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Lift Main] Pressed AA-3 Button",
            note: Some("elevator aa_3 button controller"),
            only_once: false,
            event: touchItem(
                item: "aa_3_button_main",
            ),
            conditions: All([
                Pred(missingItem(
                    item: "visitor_pass",
                )),
                Pred(hasItem(
                    item: "elevator_keycard",
                )),
            ]),
            actions: [
                (
                    action: showMessage(
                        text: "The elevator begins to move... and then freezes when it realizes that you have lost your visitor pass.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Lift Main]",
            note: None,
            only_once: false,
            event: touchItem(
                item: "main_button_main",
            ),
            conditions: All([]),
            actions: [
                (
                    action: showMessage(
                        text: "With something between a yawn and a sigh, the elevator reminds you that you are already on the main floor, then closes and opens the doors for emphasis.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "Coffee Cools Down",
            note: None,
            only_once: true,
            event: takeItem(
                item: "hot_coffee",
            ),
            conditions: All([]),
            actions: [
                (
                    action: scheduleIn(
                        turns_ahead: 7,
                        actions: [
                            (
                                action: replaceItem(
                                    old_item: "hot_coffee",
                                    new_item: "cooled_coffee",
                                ),
                                priority: None,
                            ),
                        ],
                        note: Some("coffee cooled"),
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "Hot Coffee Healing",
            note: None,
            only_once: false,
            event: ingest(
                item: "hot_coffee",
                mode: drink,
            ),
            conditions: All([]),
            actions: [
                (
                    action: healPlayer(
                        amount: 5,
                        cause: "hot coffee healing",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "Cool Coffee Heals Too (less)",
            note: None,
            only_once: false,
            event: ingest(
                item: "cooled_coffee",
                mode: drink,
            ),
            conditions: All([]),
            actions: [
                (
                    action: healPlayer(
                        amount: 2,
                        cause: "room-temperature coffee",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Lounge] Rug Taken / Reveal Trapdoor",
            note: None,
            only_once: true,
            event: takeItem(
                item: "lebowski_rug",
            ),
            conditions: All([]),
            actions: [
                (
                    action: revealExit(
                        exit_from: "lounge",
                        exit_to: "portal-room",
                        direction: "down",
                    ),
                    priority: None,
                ),
                (
                    action: addFlag(
                        flag: simple(
                            name: "found-portal-room",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: awardPoints(
                        amount: 3,
                        reason: "Found the trapdoor beneath the rug",
                    ),
                    priority: None,
                ),
                (
                    action: showMessage(
                        text: "Light shines around the edges of a trap door revealed in the floor when you remove the rug. The room no longer seems tied together.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Lounge] Rug Burned Away",
            note: None,
            only_once: true,
            event: actOnItem(
                target: "lebowski_rug",
                action: burn,
            ),
            conditions: All([]),
            actions: [
                (
                    action: despawnItem(
                        item: "lebowski_rug",
                    ),
                    priority: None,
                ),
                (
                    action: revealExit(
                        exit_from: "lounge",
                        exit_to: "portal-room",
                        direction: "down",
                    ),
                    priority: None,
                ),
                (
                    action: addFlag(
                        flag: simple(
                            name: "found-portal-room",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: awardPoints(
                        amount: 3,
                        reason: "Revealed the trapdoor by torching the rug",
                    ),
                    priority: None,
                ),
                (
                    action: showMessage(
                        text: "When the acrid smoke clears and your eyes stop burning, you can make out a trap door revealed in the floor where the rug used to be.",
                    ),
                    priority: None,
                ),
                (
                    action: addSpinnerWedge(
                        spinner: "ambientInterior",
                        text: "Security Announcement: Some arsonist burned the rug in the lounge. It no longer ties the room together. This aggression will not stand, man.",
                        width: 1,
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Lounge] Brew Coffee",
            note: None,
            only_once: true,
            event: useItem(
                item: "coffee_machine",
                ability: turnOn,
            ),
            conditions: All([]),
            actions: [
                (
                    action: showMessage(
                        text: "The coffee machine hums to life and begins its brewing cycle. A timer shows 3 minutes remaining...",
                    ),
                    priority: None,
                ),
                (
                    action: setItemDescription(
                        item: "coffee_machine",
                        text: "A single serve drip coffee machine, which apparently takes quite a while to finish brewing a cup one drip at a time...",
                    ),
                    priority: None,
                ),
                (
                    action: scheduleIn(
                        turns_ahead: 3,
                        actions: [
                            (
                                action: setItemDescription(
                                    item: "coffee_machine",
                                    text: "A single serve, drip coffee maker. The brew cycle is complete and the grounds have already been used.",
                                ),
                                priority: None,
                            ),
                            (
                                action: showMessage(
                                    text: "♪ BEEP BEEP BEEP! ♪ The coffee machine chimes cheerfully. The rich aroma of freshly brewed coffee fills the air.",
                                ),
                                priority: None,
                            ),
                            (
                                action: spawnItemInRoom(
                                    item: "hot_coffee",
                                    room: "lounge",
                                ),
                                priority: None,
                            ),
                            (
                                action: addFlag(
                                    flag: simple(
                                        name: "coffee-ready",
                                    ),
                                ),
                                priority: None,
                            ),
                            (
                                action: awardPoints(
                                    amount: 2,
                                    reason: "Brewed a cup of hot coffee",
                                ),
                                priority: None,
                            ),
                        ],
                        note: Some("coffee done brewing"),
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Lounge] Coffee Taken",
            note: None,
            only_once: false,
            event: takeItem(
                item: "hot_coffee",
            ),
            conditions: All([]),
            actions: [
                (
                    action: removeFlag(
                        name: "coffee-ready",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "Eat a Fortune Cookie",
            note: Some("player gets random different fortunes each time from the \'fortunes\' spinner"),
            only_once: false,
            event: ingest(
                item: "fortune_cookies_of_doom",
                mode: eat,
            ),
            conditions: All([]),
            actions: [
                (
                    action: showMessage(
                        text: "You dare to eat a Fortune Cookie of Doom...",
                    ),
                    priority: None,
                ),
                (
                    action: awardPoints(
                        amount: 1,
                        reason: "Ate a Fortune Cookie of Doom",
                    ),
                    priority: None,
                ),
                (
                    action: healPlayer(
                        amount: 1,
                        cause: "ate a fortune cookie",
                    ),
                    priority: None,
                ),
                (
                    action: spinnerMessage(
                        spinner: "fortunes",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Main-Lobby] Security Reminder",
            note: None,
            only_once: true,
            event: enterRoom(
                room: "main-lobby",
            ),
            conditions: All([]),
            actions: [
                (
                    action: showMessage(
                        text: "A chime echoes through the lobby. \"Candidates: Please do not loiter in the lobby,\" intones an overhead voice.",
                    ),
                    priority: None,
                ),
                (
                    action: scheduleInIf(
                        turns_ahead: 3,
                        condition: Pred(playerInRoom(
                            room: "main-lobby",
                        )),
                        on_false: cancel,
                        actions: [
                            (
                                action: showMessage(
                                    text: "The chime sounds again. \"Candidates: We **said** not to loiter in the lobby,\" says the voice, in more of an annoyed tone.",
                                ),
                                priority: None,
                            ),
                            (
                                action: awardPoints(
                                    amount: -1,
                                    reason: "Ignored the lobby loitering reminder",
                                ),
                                priority: None,
                            ),
                        ],
                        note: Some("lobby loitering reminder"),
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Main-Lobby] HAL Module/Drop Tweezers In Crevice",
            note: Some("may occur during vending machine / HAL module 2 sequence"),
            only_once: true,
            event: useItemOnItem(
                tool: "zircon_tweezers",
                target: "hal_module_2_crevice",
                interaction: handle,
            ),
            conditions: Pred(hasFlag(
                flag: "module-2-puzzle#1",
            )),
            actions: [
                (
                    action: showMessage(
                        text: "The glint of the zircon-encrusted tweezers is truly something to behold, but the tweezers are too short to reach the memory module. In fact, in trying to reach that far into the crack with them, the tweezers slip from your fingers and fall into the crevice too.",
                    ),
                    priority: None,
                ),
                (
                    action: replaceDropItem(
                        old_item: "zircon_tweezers",
                        new_item: "zircon_tweezers_crevice",
                    ),
                    priority: None,
                ),
                (
                    action: addFlag(
                        flag: simple(
                            name: "lost-tweezers",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: awardPoints(
                        amount: -2,
                        reason: "Dropped your zircon tweezers into the vending machine crevice",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Main-Lobby] Recover Tweezers",
            note: None,
            only_once: false,
            event: useItemOnItem(
                tool: "fishing_line",
                target: "zircon_tweezers_crevice",
                interaction: handle,
            ),
            conditions: All([]),
            actions: [
                (
                    action: showMessage(
                        text: "After a dozen tries and venting by beating the vending machine with the crowbar some more, you are able to fish your prized zircon-encrusted tweezers back out of the crevice.",
                    ),
                    priority: None,
                ),
                (
                    action: despawnItem(
                        item: "zircon_tweezers_crevice",
                    ),
                    priority: None,
                ),
                (
                    action: spawnItemInInventory(
                        item: "zircon_tweezers",
                    ),
                    priority: None,
                ),
                (
                    action: addFlag(
                        flag: simple(
                            name: "recovered-tweezers",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: awardPoints(
                        amount: 3,
                        reason: "Fished the zircon tweezers out of the vending machine",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "Modify Patio: Sunglasses On",
            note: None,
            only_once: false,
            event: takeItem(
                item: "peril_sunglasses",
            ),
            conditions: All([]),
            actions: [
                (
                    action: modifyRoom(
                        room: "patio",
                        patch: (
                            name: Some("Restaurant Patio"),
                            desc: Some("The patio overlooks nothing in particular—just an endless starfield gently swirling beyond a transparent force field. A few metal tables are bolted to the floor, and one of them has a half-empty cocktail glass slowly un-drinking itself. A sign near the edge reads: \'No Leaning Beyond This Point. You have been warned.\'"),
                            remove_exits: [],
                            add_exits: [],
                        ),
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "Modify Patio: Sunglasses Off",
            note: None,
            only_once: false,
            event: dropItem(
                item: "peril_sunglasses",
            ),
            conditions: All([]),
            actions: [
                (
                    action: modifyRoom(
                        room: "patio",
                        patch: (
                            name: Some("BLINDING GLARE"),
                            desc: Some("You see nothing at all. The pure white light here is direct-sunlight bright and seems to come from all directions, forcing you to shield your eyes with your arm and flee."),
                            remove_exits: [],
                            add_exits: [],
                        ),
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Plaque 3] Read the Plaque",
            note: None,
            only_once: true,
            event: useItem(
                item: "plaque_3",
                ability: read,
            ),
            conditions: All([]),
            actions: [
                (
                    action: addFlag(
                        flag: simple(
                            name: "read-plaque-3",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: awardPoints(
                        amount: 10,
                        reason: "Decoded the third crystal plaque",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Patio] Sunglasses Required",
            note: None,
            only_once: false,
            event: enterRoom(
                room: "patio",
            ),
            conditions: Pred(missingItem(
                item: "peril_sunglasses",
            )),
            actions: [
                (
                    action: pushPlayerTo(
                        room: "restaurant",
                    ),
                    priority: None,
                ),
                (
                    action: showMessage(
                        text: "A blinding burst of light erupts from the swirling starfield, forcing you to shield your eyes. With no protection, you\'re driven back into the relative safety of the restaurant.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Patio] Sunglasses Required",
            note: None,
            only_once: false,
            event: enterRoom(
                room: "patio",
            ),
            conditions: Pred(hasItem(
                item: "peril_sunglasses",
            )),
            actions: [
                (
                    action: showMessage(
                        text: "Sensing the possible harm in eating a dessert a stone\'s throw away from the explosions of all nearby stars, your peril-sensitive sunglasses flash nearly completely opaque, allowing you to see without permanent damage to the retina as the galaxies outside continue to erupt.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Patio] Award Points Getting In",
            note: Some("separate one-off trigger to award first time getting in"),
            only_once: true,
            event: enterRoom(
                room: "patio",
            ),
            conditions: Pred(hasItem(
                item: "peril_sunglasses",
            )),
            actions: [
                (
                    action: awardPoints(
                        amount: 2,
                        reason: "Reached the patio through the starburst safely",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "HINT Radio: Where do I charge this battery?",
            note: None,
            only_once: true,
            event: takeItem(
                item: "empty_battery",
            ),
            conditions: All([]),
            actions: [
                (
                    action: scheduleInIf(
                        turns_ahead: 2,
                        condition: Any([
                            All([
                                Pred(hasItem(
                                    item: "hint_radio",
                                )),
                                Pred(hasFlag(
                                    flag: "hint-radio-on",
                                )),
                                Pred(missingFlag(
                                    flag: "portal-gun-powered",
                                )),
                                Pred(playerInRoom(
                                    room: "portal-room",
                                )),
                            ]),
                            Pred(hasFlag(
                                flag: "portal-gun-powered",
                            )),
                        ]),
                        on_false: retryNextTurn,
                        actions: [
                            (
                                action: conditional(
                                    condition: All([
                                        Pred(hasItem(
                                            item: "hint_radio",
                                        )),
                                        Pred(hasFlag(
                                            flag: "hint-radio-on",
                                        )),
                                        Pred(missingFlag(
                                            flag: "portal-gun-powered",
                                        )),
                                        Pred(playerInRoom(
                                            room: "portal-room",
                                        )),
                                    ]),
                                    actions: [
                                        (
                                            action: npcSays(
                                                npc: "hint_radio_npc",
                                                quote: "Wasn\'t there a gonk droid clomping about up in the lounge or the lobby? They can power or charge just about anything, from what I hear. Not much for conversation though, the gonks.",
                                            ),
                                            priority: None,
                                        ),
                                    ],
                                ),
                                priority: None,
                            ),
                        ],
                        note: None,
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Stargate] Woodland Gate: Activate",
            note: Some("schedule/give point award for first time opening gate"),
            only_once: true,
            event: touchItem(
                item: "woodland_button",
            ),
            conditions: All([]),
            actions: [
                (
                    action: scheduleInIf(
                        turns_ahead: 1,
                        condition: Pred(hasFlag(
                            flag: "read-plaque-1",
                        )),
                        on_false: retryNextTurn,
                        actions: [
                            (
                                action: awardPoints(
                                    amount: 5,
                                    reason: "Activated the Woodland Gate",
                                ),
                                priority: None,
                            ),
                        ],
                        note: None,
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Stargate] Press Woodland Button",
            note: Some("open/move the Stargate connection to Parish Landing (only if plaque-1 read)"),
            only_once: false,
            event: touchItem(
                item: "woodland_button",
            ),
            conditions: All([
                Pred(hasFlag(
                    flag: "read-plaque-1",
                )),
                Pred(missingFlag(
                    flag: "woodland-gate-open",
                )),
            ]),
            actions: [
                (
                    action: showMessage(
                        text: "With a great whooshing like the flush of a titan\'s toilet, the Stargate opens a new connection. You hear singing birds and the occasional screech coming through the opening.",
                    ),
                    priority: None,
                ),
                (
                    action: modifyRoom(
                        room: "stargate-room",
                        patch: (
                            name: None,
                            desc: Some("A hangar-size concrete room, connected to the Aperture lab through a huge, round vault door. The Stargate is filled with a shimmering energy, from which you hear whispering sound and birdsong. Occasionally, a bird flies out of the gate and circles it, but -- finding nowhere to land -- flies back in."),
                            remove_exits: [
                                "ice-pit",
                                "patio",
                            ],
                            add_exits: [
                                (
                                    direction: "through the stargate",
                                    to: "parish-landing",
                                    hidden: false,
                                    locked: false,
                                    required_flags: [],
                                    required_items: [],
                                    barred_message: None,
                                ),
                            ],
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: addFlag(
                        flag: simple(
                            name: "woodland-gate-open",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: modifyRoom(
                        room: "parish-landing",
                        patch: (
                            name: None,
                            desc: None,
                            remove_exits: [],
                            add_exits: [
                                (
                                    direction: "through the stargate",
                                    to: "stargate-room",
                                    hidden: false,
                                    locked: false,
                                    required_flags: [],
                                    required_items: [],
                                    barred_message: None,
                                ),
                            ],
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: removeFlag(
                        name: "snowfield-gate-open",
                    ),
                    priority: None,
                ),
                (
                    action: modifyRoom(
                        room: "ice-pit",
                        patch: (
                            name: None,
                            desc: None,
                            remove_exits: [
                                "stargate-room",
                            ],
                            add_exits: [],
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: removeFlag(
                        name: "patio-gate-open",
                    ),
                    priority: None,
                ),
                (
                    action: modifyRoom(
                        room: "patio",
                        patch: (
                            name: None,
                            desc: None,
                            remove_exits: [
                                "stargate-room",
                            ],
                            add_exits: [],
                        ),
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Stargate] Press Woodland Button",
            note: Some("open/move the Stargate connection to Parish Landing (only if plaque-1 read)"),
            only_once: false,
            event: touchItem(
                item: "woodland_button",
            ),
            conditions: All([
                Pred(hasFlag(
                    flag: "read-plaque-1",
                )),
                Pred(hasFlag(
                    flag: "woodland-gate-open",
                )),
            ]),
            actions: [
                (
                    action: showMessage(
                        text: "The gate to the woodlands is already open.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Stargate] Press Woodland Button",
            note: Some("open/move the Stargate connection to Parish Landing (only if plaque-1 read)"),
            only_once: false,
            event: touchItem(
                item: "woodland_button",
            ),
            conditions: Pred(missingFlag(
                flag: "read-plaque-1",
            )),
            actions: [
                (
                    action: showMessage(
                        text: "The tree button is already pressed down as far as it can go; you can\'t activate it.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Stargate] Snowfield Gate: Activate",
            note: Some("schedule/give point award for first time opening gate"),
            only_once: true,
            event: touchItem(
                item: "snowfield_button",
            ),
            conditions: All([]),
            actions: [
                (
                    action: scheduleInIf(
                        turns_ahead: 1,
                        condition: Pred(hasFlag(
                            flag: "read-plaque-2",
                        )),
                        on_false: retryNextTurn,
                        actions: [
                            (
                                action: awardPoints(
                                    amount: 5,
                                    reason: "Activated the Snowfield Gate",
                                ),
                                priority: None,
                            ),
                        ],
                        note: None,
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Stargate] Press Snowfield Button",
            note: Some("open/move the Stargate connection to Ice Pit (only if plaque 2 read)"),
            only_once: false,
            event: touchItem(
                item: "snowfield_button",
            ),
            conditions: All([
                Pred(hasFlag(
                    flag: "read-plaque-2",
                )),
                Pred(missingFlag(
                    flag: "snowfield-gate-open",
                )),
            ]),
            actions: [
                (
                    action: showMessage(
                        text: "With a great whooshing like the flush of a titan\'s toilet, the Stargate opens a new connection. Suddenly, you can see your breath -- condensed by the frigid air pouring through the opening.",
                    ),
                    priority: None,
                ),
                (
                    action: modifyRoom(
                        room: "stargate-room",
                        patch: (
                            name: None,
                            desc: Some("A chilly, hangar-size concrete room, connected to the Aperture lab through a huge, round vault door. The Stargate is filled with a shimmering energy, from which you hear howling wind. Occasionally, another unearthly howl (Zomby Woof?) joins in."),
                            remove_exits: [
                                "parish-landing",
                                "patio",
                            ],
                            add_exits: [
                                (
                                    direction: "through the stargate",
                                    to: "ice-pit",
                                    hidden: false,
                                    locked: false,
                                    required_flags: [],
                                    required_items: [],
                                    barred_message: None,
                                ),
                            ],
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: removeFlag(
                        name: "woodland-gate-open",
                    ),
                    priority: None,
                ),
                (
                    action: modifyRoom(
                        room: "parish-landing",
                        patch: (
                            name: None,
                            desc: None,
                            remove_exits: [
                                "stargate-room",
                            ],
                            add_exits: [],
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: addFlag(
                        flag: simple(
                            name: "snowfield-gate-open",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: modifyRoom(
                        room: "ice-pit",
                        patch: (
                            name: None,
                            desc: None,
                            remove_exits: [],
                            add_exits: [
                                (
                                    direction: "through the stargate",
                                    to: "stargate-room",
                                    hidden: false,
                                    locked: false,
                                    required_flags: [],
                                    required_items: [],
                                    barred_message: None,
                                ),
                            ],
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: removeFlag(
                        name: "patio-gate-open",
                    ),
                    priority: None,
                ),
                (
                    action: modifyRoom(
                        room: "patio",
                        patch: (
                            name: None,
                            desc: None,
                            remove_exits: [
                                "stargate-room",
                            ],
                            add_exits: [],
                        ),
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Stargate] Press Snowfield Button",
            note: Some("open/move the Stargate connection to Ice Pit (only if plaque 2 read)"),
            only_once: false,
            event: touchItem(
                item: "snowfield_button",
            ),
            conditions: All([
                Pred(hasFlag(
                    flag: "read-plaque-2",
                )),
                Pred(hasFlag(
                    flag: "snowfield-gate-open",
                )),
            ]),
            actions: [
                (
                    action: showMessage(
                        text: "The gate to the snowfield is already open.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Stargate] Press Snowfield Button",
            note: Some("open/move the Stargate connection to Ice Pit (only if plaque 2 read)"),
            only_once: false,
            event: touchItem(
                item: "snowfield_button",
            ),
            conditions: Pred(missingFlag(
                flag: "read-plaque-2",
            )),
            actions: [
                (
                    action: showMessage(
                        text: "The snowflake button is sunken; you can\'t push it down any farther.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Stargate] Patio Gate: Activate",
            note: Some("schedule/give point award for first time opening gate"),
            only_once: true,
            event: touchItem(
                item: "patio_button",
            ),
            conditions: All([]),
            actions: [
                (
                    action: scheduleInIf(
                        turns_ahead: 1,
                        condition: Pred(hasFlag(
                            flag: "read-plaque-3",
                        )),
                        on_false: retryNextTurn,
                        actions: [
                            (
                                action: awardPoints(
                                    amount: 5,
                                    reason: "Activate the Patio Gate",
                                ),
                                priority: None,
                            ),
                        ],
                        note: None,
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Stargate] Press Patio Button",
            note: Some("open/move the Stargate connection to the Patio (only if plaque-3 read)"),
            only_once: false,
            event: touchItem(
                item: "patio_button",
            ),
            conditions: All([
                Pred(hasFlag(
                    flag: "read-plaque-3",
                )),
                Pred(missingFlag(
                    flag: "patio-gate-open",
                )),
            ]),
            actions: [
                (
                    action: showMessage(
                        text: "With a great whooshing like the flush of a titan\'s toilet, the Stargate opens a new connection. The smells of fresh baked bread and searing beef waft  through the opening.",
                    ),
                    priority: None,
                ),
                (
                    action: modifyRoom(
                        room: "stargate-room",
                        patch: (
                            name: None,
                            desc: Some("A hangar-size concrete room, connected to the Aperture lab through a round vault door. The Stargate in the center is filled with a shimmering energy, from which you hear the sounds of clinking glasses punctuated by explosions. Occasionally, you catch a whiff of fresh baked bread in the air."),
                            remove_exits: [
                                "ice-pit",
                                "parish-landing",
                            ],
                            add_exits: [
                                (
                                    direction: "through the stargate",
                                    to: "patio",
                                    hidden: false,
                                    locked: false,
                                    required_flags: [],
                                    required_items: [],
                                    barred_message: None,
                                ),
                            ],
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: removeFlag(
                        name: "woodland-gate-open",
                    ),
                    priority: None,
                ),
                (
                    action: modifyRoom(
                        room: "parish-landing",
                        patch: (
                            name: None,
                            desc: None,
                            remove_exits: [
                                "stargate-room",
                            ],
                            add_exits: [],
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: removeFlag(
                        name: "snowfield-gate-open",
                    ),
                    priority: None,
                ),
                (
                    action: modifyRoom(
                        room: "ice-pit",
                        patch: (
                            name: None,
                            desc: None,
                            remove_exits: [
                                "stargate-room",
                            ],
                            add_exits: [],
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: addFlag(
                        flag: simple(
                            name: "patio-gate-open",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: modifyRoom(
                        room: "patio",
                        patch: (
                            name: None,
                            desc: None,
                            remove_exits: [],
                            add_exits: [
                                (
                                    direction: "through the stargate",
                                    to: "stargate-room",
                                    hidden: false,
                                    locked: false,
                                    required_flags: [],
                                    required_items: [],
                                    barred_message: None,
                                ),
                            ],
                        ),
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Stargate] Press Patio Button",
            note: Some("open/move the Stargate connection to the Patio (only if plaque-3 read)"),
            only_once: false,
            event: touchItem(
                item: "patio_button",
            ),
            conditions: All([
                Pred(hasFlag(
                    flag: "read-plaque-3",
                )),
                Pred(hasFlag(
                    flag: "patio-gate-open",
                )),
            ]),
            actions: [
                (
                    action: showMessage(
                        text: "The gate to the restaurant patio is already open.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Stargate] Press Patio Button",
            note: Some("open/move the Stargate connection to the Patio (only if plaque-3 read)"),
            only_once: false,
            event: touchItem(
                item: "patio_button",
            ),
            conditions: Pred(missingFlag(
                flag: "read-plaque-3",
            )),
            actions: [
                (
                    action: showMessage(
                        text: "The fork-shaped button is already pressed down as far as it can go.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[East-of-Building] Pluck Dental Floss",
            note: None,
            only_once: true,
            event: takeItem(
                item: "dental_floss",
            ),
            conditions: All([]),
            actions: [
                (
                    action: showMessage(
                        text: "You pluck a strand of floss from the bush. It comes away easily — disturbingly so. Minty. Strong. Too strong. You’re no botanist, but you’re pretty sure this shouldn’t be growing out of a shrubbery.",
                    ),
                    priority: None,
                ),
                (
                    action: awardPoints(
                        amount: 5,
                        reason: "Harvested the weird bush\'s minty dental floss",
                    ),
                    priority: None,
                ),
                (
                    action: setItemDescription(
                        item: "weird_bush",
                        text: "A squat, leafy bush now stripped of its floss-like strands, bare branches jutting out awkwardly. A small sign next to it reads \'Pride of Montana\'.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Inca-Road] Traveling Without Towel",
            note: None,
            only_once: true,
            event: enterRoom(
                room: "inca-road",
            ),
            conditions: Pred(missingItem(
                item: "towel",
            )),
            actions: [
                (
                    action: showMessage(
                        text: "You pause here, realizing with increasing concern that you are traveling without a towel.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Loading-Dock] Spawn Special Delivery",
            note: None,
            only_once: true,
            event: leaveRoom(
                room: "loading-dock",
            ),
            conditions: All([]),
            actions: [
                (
                    action: spawnItemInRoom(
                        item: "delivery_box",
                        room: "loading-dock",
                    ),
                    priority: None,
                ),
                (
                    action: showMessage(
                        text: "You hear a thud behind you, back toward the dock, like something was just dropped off. You glimpse a drone flying away quickly, as if hoping not to be seen. Was that an Initech logo on the side?",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Loading-Dock] Open Security Crate (Key)",
            note: None,
            only_once: true,
            event: unlockItem(
                item: "security_locker",
            ),
            conditions: All([]),
            actions: [
                (
                    action: spawnItemInContainer(
                        item: "crowbar",
                        container: "security_locker",
                    ),
                    priority: None,
                ),
                (
                    action: spawnItemInContainer(
                        item: "security_log",
                        container: "security_locker",
                    ),
                    priority: None,
                ),
                (
                    action: spawnItemInContainer(
                        item: "strange_liquid",
                        container: "security_locker",
                    ),
                    priority: None,
                ),
                (
                    action: spawnItemInContainer(
                        item: "initech_mug",
                        container: "security_locker",
                    ),
                    priority: None,
                ),
                (
                    action: addFlag(
                        flag: simple(
                            name: "unlocked-security-crate",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: showMessage(
                        text: "The ear wax on the tip of the key eases it into the rusted lock, which snaps open with a satisfying clunk.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Loading-Dock] Open Security Crate (Break)",
            note: None,
            only_once: true,
            event: actOnItem(
                target: "security_locker",
                action: break,
            ),
            conditions: Pred(missingFlag(
                flag: "unlocked-security-crate",
            )),
            actions: [
                (
                    action: despawnItem(
                        item: "security_locker",
                    ),
                    priority: None,
                ),
                (
                    action: spawnItemCurrentRoom(
                        item: "crowbar",
                    ),
                    priority: None,
                ),
                (
                    action: spawnItemCurrentRoom(
                        item: "security_log",
                    ),
                    priority: None,
                ),
                (
                    action: spawnItemCurrentRoom(
                        item: "shattered_vial",
                    ),
                    priority: None,
                ),
                (
                    action: spawnItemCurrentRoom(
                        item: "initech_mug",
                    ),
                    priority: None,
                ),
                (
                    action: showMessage(
                        text: "With a few hefty blows, you manage to break the lock haft completely off of the security locker -- well after a few misses had already caved in the lid and destroyed it, but you were having fun. It looks like you broke a couple of the items that were inside in the process.",
                    ),
                    priority: None,
                ),
                (
                    action: addSpinnerWedge(
                        spinner: "ambientInterior",
                        text: "PA Announcement: \'Someone broke into the security locker on the dock. Mind your belongings and report any suspicious activity to security.\'",
                        width: 1,
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Loading-Dock] Open Security Crate (Burn)",
            note: None,
            only_once: true,
            event: actOnItem(
                target: "security_locker",
                action: burn,
            ),
            conditions: Pred(missingFlag(
                flag: "unlocked-security-crate",
            )),
            actions: [
                (
                    action: despawnItem(
                        item: "security_locker",
                    ),
                    priority: None,
                ),
                (
                    action: spawnItemCurrentRoom(
                        item: "crowbar",
                    ),
                    priority: None,
                ),
                (
                    action: spawnItemCurrentRoom(
                        item: "burned_security_log",
                    ),
                    priority: None,
                ),
                (
                    action: spawnItemCurrentRoom(
                        item: "strange_liquid",
                    ),
                    priority: None,
                ),
                (
                    action: spawnItemCurrentRoom(
                        item: "initech_mug",
                    ),
                    priority: None,
                ),
                (
                    action: showMessage(
                        text: "WHOOOOOMP! The locker, which you now realize may have been made from the solid magnesium magnolia trees of Siwenna, goes up in a white hot flash -- taking your eyebrows with it. It looks like *some* of the items inside weren\'t flammable.",
                    ),
                    priority: None,
                ),
                (
                    action: addSpinnerWedge(
                        spinner: "ambientInterior",
                        text: "PA Announcement: \'Someone used an Arson-Aid to torch the security locker at the loading dock. An investigation is underway. Report anyone with scorched clothes or missing eyebrows to security.\'",
                        width: 1,
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Loading-Dock] Got Crowbar",
            note: None,
            only_once: true,
            event: takeItem(
                item: "crowbar",
            ),
            conditions: All([]),
            actions: [
                (
                    action: showMessage(
                        text: "You feel like Gordon Freeman now, and wonder if maybe Barney\'s on security here?",
                    ),
                    priority: None,
                ),
                (
                    action: addFlag(
                        flag: simple(
                            name: "got-crowbar",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: awardPoints(
                        amount: 3,
                        reason: "Recovered the iconic crowbar",
                    ),
                    priority: None,
                ),
                (
                    action: scheduleIn(
                        turns_ahead: 2,
                        actions: [
                            (
                                action: showMessage(
                                    text: "... and then you wonder why you\'re thinking of Barney as a real person instead of a character in a game. And Gordon, for that matter. Wait, he was just *fiction*, right? Come to think of it, you feel a little unsure of reality, and it\'s worse the nearer you are to the building.",
                                ),
                                priority: None,
                            ),
                        ],
                        note: Some("notice fiction bleed"),
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Sublevel-1-Entrance] Black Knight Hints About Vending Machine",
            note: None,
            only_once: true,
            event: always,
            conditions: All([
                Pred(withNpc(
                    npc: "black_knight",
                )),
                Pred(flagInProgress(
                    flag: "hal-reboot",
                )),
            ]),
            actions: [
                (
                    action: npcSays(
                        npc: "black_knight",
                        quote: "Lo, good Sir! I grow weary, and require a cup of electrolytes and caffeine, but cannot leave my post. Nor do I want to dull my new sword doing battle with that infernal contraption in the lobby again. If you pass by there, retrieve one for me and I shall be further in your debt.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Med-Bay] EMH/Cure Nausea",
            note: Some("can add specific has flag conditions here to use this for any nausea-inducing condition"),
            only_once: false,
            event: talkToNpc(
                npc: "emh",
            ),
            conditions: Pred(hasFlag(
                flag: "read-vogon-poetry",
            )),
            actions: [
                (
                    action: removeFlag(
                        name: "read-vogon-poetry",
                    ),
                    priority: None,
                ),
                (
                    action: awardPoints(
                        amount: 3,
                        reason: "Got treatment for reading Vogon poetry",
                    ),
                    priority: None,
                ),
                (
                    action: npcSays(
                        npc: "emh",
                        quote: "You poor fool, you look horrible. You\'ve been reading Vogon poetry, hmmm? Here, this should help.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Med-Bay] EMH/Cure Nausea",
            note: Some("can add specific has flag conditions here to use this for any nausea-inducing condition"),
            only_once: false,
            event: talkToNpc(
                npc: "emh",
            ),
            conditions: Pred(hasFlag(
                flag: "ate-sausage",
            )),
            actions: [
                (
                    action: awardPoints(
                        amount: 3,
                        reason: "Recovered from eating Dibbler\'s sausage",
                    ),
                    priority: None,
                ),
                (
                    action: npcSays(
                        npc: "emh",
                        quote: "Ugh -- your breath is horrid! You ate one of Dibbler\'s sausages, didn\'t you? Tasty but toxic, I say.",
                    ),
                    priority: None,
                ),
                (
                    action: removeFlag(
                        name: "ate-sausage",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Med-Bay] EMH/Cure Nausea",
            note: Some("can add specific has flag conditions here to use this for any nausea-inducing condition"),
            only_once: false,
            event: talkToNpc(
                npc: "emh",
            ),
            conditions: Pred(hasFlag(
                flag: "status:nauseated",
            )),
            actions: [
                (
                    action: removeFlag(
                        name: "status:nauseated",
                    ),
                    priority: None,
                ),
                (
                    action: showMessage(
                        text: "The EMH gives you a hypospray in the neck, and your nausea subsides.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Med-Bay] EMH/After HAL Rebooted",
            note: None,
            only_once: true,
            event: always,
            conditions: All([
                Pred(withNpc(
                    npc: "emh",
                )),
                Pred(flagComplete(
                    flag: "hal-reboot",
                )),
            ]),
            actions: [
                (
                    action: setNpcState(
                        npc: "emh",
                        state: normal,
                    ),
                    priority: None,
                ),
                (
                    action: npcSays(
                        npc: "emh",
                        quote: "Well, now you\'ve done it. HAL is operational again. We\'ll surely regret it -- or at least *you* will.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Sublevel-1-Entrance] Refuse Visitor Pass",
            note: None,
            only_once: false,
            event: giveToNpc(
                item: "visitor_pass",
                npc: "black_knight",
            ),
            conditions: All([]),
            actions: [
                (
                    action: npcRefuseItem(
                        npc: "black_knight",
                        reason: "Ha! Perhaps you ARE Arthur, King of the Britons... but I said NONE shall pass. Surely you speak the King\'s English, so-called Arthur-King?!",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Sublevel-1-Entrance] Meet the Black Knight",
            note: None,
            only_once: true,
            event: talkToNpc(
                npc: "black_knight",
            ),
            conditions: Pred(hasFlag(
                flag: "ate-sausage",
            )),
            actions: [
                (
                    action: npcSays(
                        npc: "black_knight",
                        quote: "Ye Gods! That stench is a foul and powerful weapon, but it will not move me. I move for NO man, even if my nostrils recoil from his very presence.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Sublevel-1-Entrance] Meet the Black Knight",
            note: None,
            only_once: true,
            event: talkToNpc(
                npc: "black_knight",
            ),
            conditions: All([]),
            actions: [
                (
                    action: addFlag(
                        flag: simple(
                            name: "talked-to-knight",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: npcSays(
                        npc: "black_knight",
                        quote: "You shall not pass. This wing is closed... and may not exist at all. Begone!",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Sublevel-1-Entrance] Taking Sword Angers Knight",
            note: None,
            only_once: false,
            event: takeFromNpc(
                item: "dull_longsword",
                npc: "black_knight",
            ),
            conditions: All([]),
            actions: [
                (
                    action: setNpcState(
                        npc: "black_knight",
                        state: mad,
                    ),
                    priority: None,
                ),
                (
                    action: npcSays(
                        npc: "black_knight",
                        quote: "Wha-- HEY! Give that back, you -- you -- cowardly cur!",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Sublevel-1-Entrance] Return Dull Sword to Knight",
            note: None,
            only_once: false,
            event: giveToNpc(
                item: "dull_longsword",
                npc: "black_knight",
            ),
            conditions: All([]),
            actions: [
                (
                    action: npcSays(
                        npc: "black_knight",
                        quote: "Right. Now don\'t do it again, or I shall be forced to bludgeon you with it. You still may not pass.",
                    ),
                    priority: None,
                ),
                (
                    action: setNpcState(
                        npc: "black_knight",
                        state: normal,
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Sublevel-1-Entrance] Sharpen Knight\'s Sword",
            note: None,
            only_once: true,
            event: actOnItem(
                target: "dull_longsword",
                action: sharpen,
            ),
            conditions: All([]),
            actions: [
                (
                    action: replaceItem(
                        old_item: "dull_longsword",
                        new_item: "keen_longsword",
                    ),
                    priority: None,
                ),
                (
                    action: showMessage(
                        text: "After years of sharpening Ginsu knives to cut open aluminum cans and tomatoes, you have no problem honing the Black Knight\'s sword to a keen edge.",
                    ),
                    priority: None,
                ),
                (
                    action: addFlag(
                        flag: simple(
                            name: "sword-sharpened",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: awardPoints(
                        amount: 3,
                        reason: "Sharpened the Black Knight\'s sword",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Sublevel-1-Entrance] Black Knight Kicks Player After Sword Taken",
            note: None,
            only_once: false,
            event: always,
            conditions: All([
                Pred(withNpc(
                    npc: "black_knight",
                )),
                Pred(npcInState(
                    npc: "black_knight",
                    state: mad,
                )),
                Pred(missingFlag(
                    flag: "appeased-black-knight",
                )),
            ]),
            actions: [
                (
                    action: showMessage(
                        text: "The Black Knight prances around the room, occasionally trying to kick you in the shins.",
                    ),
                    priority: Some(-30),
                ),
                (
                    action: npcSaysRandom(
                        npc: "black_knight",
                    ),
                    priority: Some(-10),
                ),
            ],
        ),
        (
            name: "[Sublevel-1-Entrance] Black Knight Kicks Player After Sword Taken",
            note: None,
            only_once: false,
            event: always,
            conditions: All([
                Pred(chancePercent(
                    percent: 50.0,
                )),
                Pred(withNpc(
                    npc: "black_knight",
                )),
                Pred(npcInState(
                    npc: "black_knight",
                    state: mad,
                )),
                Pred(missingFlag(
                    flag: "appeased-black-knight",
                )),
            ]),
            actions: [
                (
                    action: damagePlayer(
                        amount: 1,
                        cause: "knight\'s shin-kick",
                    ),
                    priority: Some(-20),
                ),
            ],
        ),
        (
            name: "[Sublevel-1-Entrance] Sharpened Sword Returned",
            note: None,
            only_once: true,
            event: giveToNpc(
                item: "keen_longsword",
                npc: "black_knight",
            ),
            conditions: All([]),
            actions: [
                (
                    action: setItemMovability(
                        item: "keen_longsword",
                        movability: restricted(
                            reason: "The knight won\'t fall for that again.",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: addFlag(
                        flag: simple(
                            name: "appeased-black-knight",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: setBarredMessage(
                        exit_from: "sublevel-1-entrance",
                        exit_to: "room-aa-3b",
                        msg: "As you near the door, you are overwhelmed by a sense of spinning through an unending series of fictional realities, compelling you to step away.",
                    ),
                    priority: None,
                ),
                (
                    action: awardPoints(
                        amount: 5,
                        reason: "Appeased the Black Knight with a sharpened blade",
                    ),
                    priority: None,
                ),
                (
                    action: setNpcState(
                        npc: "black_knight",
                        state: happy,
                    ),
                    priority: None,
                ),
                (
                    action: npcSays(
                        npc: "black_knight",
                        quote: "Thank you, good Sir! For your kind deed, I swear on my sword that I shall not cut you to bits with it. And you may pass wherever you like.",
                    ),
                    priority: Some(10),
                ),
            ],
        ),
        (
            name: "[Sublevel Lift] Press Main Button",
            note: None,
            only_once: false,
            event: touchItem(
                item: "main_button_sublevel",
            ),
            conditions: All([]),
            actions: [
                (
                    action: pushPlayerTo(
                        room: "lift-main",
                    ),
                    priority: None,
                ),
                (
                    action: showMessage(
                        text: "The elevator shouts \"Yeeee-Haw!\", and you\'re off literally like a rocket, accelerating and pressed into the floor of the elevator for what seems like a minute. You decelerate nearly as quickly, slamming into the elevator ceiling and then falling again when you arrive at the main level. \"Have a WONDERFUL day!\", the lift intones gleefully as the doors slide softly open.",
                    ),
                    priority: None,
                ),
                (
                    action: damagePlayer(
                        amount: 1,
                        cause: "elevator deceleration",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Sublevel Lift] Press AA-3 Button",
            note: None,
            only_once: false,
            event: touchItem(
                item: "aa_3_button_sublevel",
            ),
            conditions: All([]),
            actions: [
                (
                    action: showMessage(
                        text: "The elevator closes and then opens its doors a few times, as if to show you that you\'re already on that level.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "Spawn the EMH",
            note: None,
            only_once: true,
            event: touchItem(
                item: "emh_button",
            ),
            conditions: All([]),
            actions: [
                (
                    action: spawnNpcInRoom(
                        npc: "emh",
                        room: "med-bay",
                    ),
                    priority: None,
                ),
                (
                    action: awardPoints(
                        amount: 3,
                        reason: "Activated the Emergency Medical Hologram",
                    ),
                    priority: None,
                ),
                (
                    action: npcSays(
                        npc: "emh",
                        quote: "Please state the nature of your medical emergency.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Monolith-Room] Announce Monolith Access After HAL Rebooted",
            note: None,
            only_once: true,
            event: always,
            conditions: All([
                Pred(flagComplete(
                    flag: "hal-reboot",
                )),
                Pred(withNpc(
                    npc: "hal_9000",
                )),
            ]),
            actions: [
                (
                    action: showMessage(
                        text: "HAL-9000\'s lens turns to focus on the monolith dominating the room.",
                    ),
                    priority: None,
                ),
                (
                    action: npcSays(
                        npc: "hal_9000",
                        quote: "Access granted, Candidate #2112-42. The monolith awaits your touch.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Monolith-Room] Monolith Touch Prevented (HAL not ready)",
            note: None,
            only_once: false,
            event: touchItem(
                item: "monolith",
            ),
            conditions: Any([
                Pred(hasFlag(
                    flag: "hal-reboot#0",
                )),
                Pred(hasFlag(
                    flag: "hal-reboot#1",
                )),
            ]),
            actions: [
                (
                    action: showMessage(
                        text: "As you approach the monolith, HAL-9000\'s dim red lens flickers briefly but it cannot respond coherently. Something prevents you from touching the ancient artifact - as if an intenely cold, invisible barrier surrounds it.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Monolith-Room] Monolith Touch Prevented (HAL not ready)",
            note: None,
            only_once: false,
            event: touchItem(
                item: "monolith",
            ),
            conditions: Pred(hasFlag(
                flag: "hal-reboot#2",
            )),
            actions: [
                (
                    action: showMessage(
                        text: "As you approach the monolith, HAL-9000\'s lens swivels toward you.",
                    ),
                    priority: None,
                ),
                (
                    action: npcSays(
                        npc: "hal_9000",
                        quote: "I\'m sorry, Candidate. The monolith will not permit access until my systems are fully operational. Find and insert the last memory module.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Monolith Room] Touch the Monolith!",
            note: None,
            only_once: false,
            event: touchItem(
                item: "monolith",
            ),
            conditions: All([
                Pred(flagComplete(
                    flag: "hal-reboot",
                )),
                Pred(missingFlag(
                    flag: "touched-monolith",
                )),
            ]),
            actions: [
                (
                    action: addFlag(
                        flag: simple(
                            name: "touched-monolith",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: awardPoints(
                        amount: 15,
                        reason: "Made contact with the monolith",
                    ),
                    priority: None,
                ),
                (
                    action: showMessage(
                        text: "You reach out and place your palm against the monolith\'s impossibly smooth surface. For a moment, nothing happens. Then reality seems to shiver around you. Images flash through your mind - star-filled voids, impossible geometries, the birth and death of civilizations, and the utter absence of cake. You stagger backward, forever changed by the contact. The path to understanding has opened.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Security-Station] Pry Evidence Locker Open",
            note: None,
            only_once: true,
            event: actOnItem(
                target: "evidence_locker_closed",
                action: open,
            ),
            conditions: All([]),
            actions: [
                (
                    action: replaceItem(
                        old_item: "evidence_locker_closed",
                        new_item: "evidence_locker_open",
                    ),
                    priority: None,
                ),
                (
                    action: showMessage(
                        text: "Using all your weight, all your might, and most of your reserved F-bomb arsenal you pry the locker open, leaving the door barely attached.",
                    ),
                    priority: None,
                ),
                (
                    action: awardPoints(
                        amount: 2,
                        reason: "Pried open the evidence locker",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Security-Station] Take Sonic Screwdriver",
            note: None,
            only_once: true,
            event: takeItem(
                item: "sonic_screwdriver",
            ),
            conditions: All([]),
            actions: [
                (
                    action: addFlag(
                        flag: simple(
                            name: "got-sonic",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: awardPoints(
                        amount: 3,
                        reason: "Retrieved the sonic screwdriver from evidence",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Sublevel-1-Entrance] Arrived",
            note: None,
            only_once: true,
            event: enterRoom(
                room: "sublevel-1-entrance",
            ),
            conditions: All([]),
            actions: [
                (
                    action: addFlag(
                        flag: simple(
                            name: "entered-sublevel-1",
                        ),
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "Spawn Husky",
            note: None,
            only_once: true,
            event: useItem(
                item: "charred_journal",
                ability: read,
            ),
            conditions: All([]),
            actions: [
                (
                    action: spawnNpcInRoom(
                        npc: "husky_thing",
                        room: "snow-camp",
                    ),
                    priority: None,
                ),
                (
                    action: addFlag(
                        flag: simple(
                            name: "husky-spawned",
                        ),
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Husky] Stalk the Candidate",
            note: None,
            only_once: false,
            event: enterRoom(
                room: "snowfield",
            ),
            conditions: Pred(hasFlag(
                flag: "husky-spawned",
            )),
            actions: [
                (
                    action: spawnNpcInRoom(
                        npc: "husky_thing",
                        room: "snowfield",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Husky] Stalk the Candidate",
            note: None,
            only_once: false,
            event: enterRoom(
                room: "snow-camp",
            ),
            conditions: Pred(hasFlag(
                flag: "husky-spawned",
            )),
            actions: [
                (
                    action: spawnNpcInRoom(
                        npc: "husky_thing",
                        room: "snow-camp",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Plaque 2] Must Melt to Read",
            note: None,
            only_once: false,
            event: useItem(
                item: "plaque_2_frozen",
                ability: read,
            ),
            conditions: All([]),
            actions: [
                (
                    action: denyRead(
                        reason: "You\'ll have to melt the ice encasing the pillar in order to read the plaque on it.",
                    ),
                    priority: None,
                ),
                (
                    action: addFlag(
                        flag: simple(
                            name: "tried-read-plaque-2",
                        ),
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Plaque 2] Read the Plaque",
            note: None,
            only_once: true,
            event: useItem(
                item: "plaque_2",
                ability: read,
            ),
            conditions: All([]),
            actions: [
                (
                    action: removeFlag(
                        name: "tried-read-plaque-2",
                    ),
                    priority: None,
                ),
                (
                    action: addFlag(
                        flag: simple(
                            name: "read-plaque-2",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: awardPoints(
                        amount: 10,
                        reason: "Read the second crystal plaque",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Plaque 2] Pile Firewood",
            note: None,
            only_once: false,
            event: dropItem(
                item: "firewood",
            ),
            conditions: Pred(playerInRoom(
                room: "ice-pit",
            )),
            actions: [
                (
                    action: showMessage(
                        text: "You toss the firewood down next to the ice pillar. It can\'t be a coincidence that it falls into the shape of a perfect log-cabin fire lay, complete with kindling in the center.",
                    ),
                    priority: None,
                ),
                (
                    action: awardPoints(
                        amount: 5,
                        reason: "Stacked firewood for the melting ritual",
                    ),
                    priority: None,
                ),
                (
                    action: replaceItem(
                        old_item: "firewood",
                        new_item: "unlit_campfire",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Plaque 2] Light Campfire -> Melt Ice to Reveal Plaque",
            note: None,
            only_once: true,
            event: actOnItem(
                target: "unlit_campfire",
                action: burn,
            ),
            conditions: All([]),
            actions: [
                (
                    action: showMessage(
                        text: "The kindling catches quickly, and the larger cut branches begin to burn after a few minutes. The ice around the nearby pillar begins to melt.",
                    ),
                    priority: None,
                ),
                (
                    action: awardPoints(
                        amount: 2,
                        reason: "Lit the campfire beneath the ice pillar",
                    ),
                    priority: None,
                ),
                (
                    action: replaceItem(
                        old_item: "unlit_campfire",
                        new_item: "campfire",
                    ),
                    priority: None,
                ),
                (
                    action: addFlag(
                        flag: simple(
                            name: "campfire-lit",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: addFlag(
                        flag: sequence(
                            name: "reveal-ice-plaque",
                            end: Some(4),
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: scheduleIn(
                        turns_ahead: 2,
                        actions: [
                            (
                                action: showMessage(
                                    text: "Tiny rivulets of water begin to form on the side of the ice pillar closest to the fire.",
                                ),
                                priority: None,
                            ),
                            (
                                action: setItemDescription(
                                    item: "plaque_2_frozen",
                                    text: "Small rivulets of water have begun to stream down the sides of the pillar, but it\'s had little effect on the thickness of the ice so far.",
                                ),
                                priority: None,
                            ),
                            (
                                action: advanceFlag(
                                    name: "reveal-ice-plaque",
                                ),
                                priority: None,
                            ),
                        ],
                        note: Some("melting sequence to #1"),
                    ),
                    priority: None,
                ),
                (
                    action: scheduleIn(
                        turns_ahead: 3,
                        actions: [
                            (
                                action: showMessage(
                                    text: "Water begins to stream more quickly off of the pillar, which is beginning to shrink, revealing a darker object within.",
                                ),
                                priority: None,
                            ),
                            (
                                action: setItemDescription(
                                    item: "plaque_2_frozen",
                                    text: "Water streams more quickly from the slowly shrinking pillar. An intricate, white object begins to take shape within.",
                                ),
                                priority: None,
                            ),
                            (
                                action: advanceFlag(
                                    name: "reveal-ice-plaque",
                                ),
                                priority: None,
                            ),
                        ],
                        note: Some("melting sequence to #2"),
                    ),
                    priority: None,
                ),
                (
                    action: scheduleIn(
                        turns_ahead: 4,
                        actions: [
                            (
                                action: showMessage(
                                    text: "Water flows freely now from the rapidly shrinking ice sheet, starting to reveal the carved marble pillar inside. There\'s still too much ice on the plaque to read it.",
                                ),
                                priority: None,
                            ),
                            (
                                action: setItemDescription(
                                    item: "plaque_2_frozen",
                                    text: "Water now runs freely from all sides of the ice pillar, beginning to reveal the intricately carved pillar within.",
                                ),
                                priority: None,
                            ),
                            (
                                action: advanceFlag(
                                    name: "reveal-ice-plaque",
                                ),
                                priority: None,
                            ),
                        ],
                        note: Some("melting sequence to #3"),
                    ),
                    priority: None,
                ),
                (
                    action: scheduleIn(
                        turns_ahead: 5,
                        actions: [
                            (
                                action: advanceFlag(
                                    name: "reveal-ice-plaque",
                                ),
                                priority: None,
                            ),
                            (
                                action: showMessage(
                                    text: "The ice has now melted almost completely away from the pillar and plaque, just as the fire dies down a bit from the meltwater dousing its base.",
                                ),
                                priority: None,
                            ),
                            (
                                action: awardPoints(
                                    amount: 10,
                                    reason: "Melted the ice covering plaque 2",
                                ),
                                priority: None,
                            ),
                            (
                                action: replaceItem(
                                    old_item: "plaque_2_frozen",
                                    new_item: "plaque_2",
                                ),
                                priority: None,
                            ),
                            (
                                action: setItemDescription(
                                    item: "campfire",
                                    text: "A nice, warm campfire, slowly burning down to nothing.",
                                ),
                                priority: None,
                            ),
                        ],
                        note: Some("finish melting sequence (#4)"),
                    ),
                    priority: None,
                ),
                (
                    action: scheduleIn(
                        turns_ahead: 12,
                        actions: [
                            (
                                action: setItemDescription(
                                    item: "campfire",
                                    text: "Some frozen ash -- all that remains of a once-welcoming campfire.",
                                ),
                                priority: None,
                            ),
                            (
                                action: conditional(
                                    condition: Pred(playerInRoom(
                                        room: "ice-pit",
                                    )),
                                    actions: [
                                        (
                                            action: showMessage(
                                                text: "The campfire finally goes completely out and begins to freeze over again.",
                                            ),
                                            priority: None,
                                        ),
                                    ],
                                ),
                                priority: None,
                            ),
                        ],
                        note: Some("finish burning campfire down"),
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "Hint: Find Items to Build a Fire",
            note: Some("schedule radio hint about building a fire"),
            only_once: true,
            event: useItem(
                item: "plaque_2_frozen",
                ability: read,
            ),
            conditions: All([]),
            actions: [
                (
                    action: scheduleInIf(
                        turns_ahead: 2,
                        condition: Any([
                            All([
                                Pred(missingFlag(
                                    flag: "campfire-lit",
                                )),
                                Pred(hasFlag(
                                    flag: "hint-radio-on",
                                )),
                                Pred(hasItem(
                                    item: "hint_radio",
                                )),
                                Pred(playerInRoom(
                                    room: "ice-pit",
                                )),
                            ]),
                            Pred(hasFlag(
                                flag: "campfire-lit",
                            )),
                        ]),
                        on_false: retryNextTurn,
                        actions: [
                            (
                                action: conditional(
                                    condition: All([
                                        Pred(missingFlag(
                                            flag: "campfire-lit",
                                        )),
                                        Pred(hasFlag(
                                            flag: "hint-radio-on",
                                        )),
                                        Pred(hasItem(
                                            item: "hint_radio",
                                        )),
                                        Pred(playerInRoom(
                                            room: "ice-pit",
                                        )),
                                    ]),
                                    actions: [
                                        (
                                            action: npcSays(
                                                npc: "hint_radio_npc",
                                                quote: "To melt that pillar, you\'ll need to drop some firewood here and light it with something.",
                                            ),
                                            priority: None,
                                        ),
                                    ],
                                ),
                                priority: None,
                            ),
                        ],
                        note: Some("radio gives campfire hint"),
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "Firewood HINT",
            note: Some("HINT radio: use firewood in ice-pit for plaque 2"),
            only_once: false,
            event: always,
            conditions: All([
                Pred(hasFlag(
                    flag: "hint-radio-on",
                )),
                Pred(hasFlag(
                    flag: "tried-read-plaque-2",
                )),
                Pred(playerInRoom(
                    room: "snow-camp",
                )),
            ]),
            actions: [
                (
                    action: npcSays(
                        npc: "hint_radio_npc",
                        quote: "Looks like the researchers didn\'t get their fire lit before the dog-Thing got to them. Bad day for them, but maybe good for you. Maybe you can move it down into the ice pit to melt the ice encasing the pillar there.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[High-Ridge] Billy Wakes Up",
            note: Some("chance of random Billy the Mountain Zappa reference"),
            only_once: true,
            event: useItem(
                item: "scrawled_note",
                ability: read,
            ),
            conditions: Pred(chancePercent(
                percent: 42.0,
            )),
            actions: [
                (
                    action: showMessage(
                        text: "You feel a deep rumbling coming up through your feet. Suddenly, a voice booms through the trees and the canyon below: \"WARNING: SELF-DESTRUCT SEQUENCE INITIATED! All personnel evacuate immediately! Demolition commences on REL 10!\"",
                    ),
                    priority: None,
                ),
                (
                    action: addFlag(
                        flag: simple(
                            name: "self-destruct-armed",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: scheduleOn(
                        on_turn: 10,
                        actions: [
                            (
                                action: showMessage(
                                    text: "KABOOM! 💥 The entire area shakes violently as a deep rumbling rocks the mountain!",
                                ),
                                priority: None,
                            ),
                        ],
                        note: Some("self-destruct fires"),
                    ),
                    priority: None,
                ),
                (
                    action: scheduleOn(
                        on_turn: 11,
                        actions: [
                            (
                                action: showMessage(
                                    text: "The rumbling stops. Then, after a minute, the voice again: \"Erm, it turns out that was just Billy waking up. Cancel the evacuation, and have a productive day.\"",
                                ),
                                priority: None,
                            ),
                            (
                                action: removeFlag(
                                    name: "self-destruct-armed",
                                ),
                                priority: None,
                            ),
                            (
                                action: awardPoints(
                                    amount: 2,
                                    reason: "Kept your cool through Billy the Mountain\'s fake self-destruct",
                                ),
                                priority: None,
                            ),
                            (
                                action: addFlag(
                                    flag: simple(
                                        name: "survived-fake-explosion",
                                    ),
                                ),
                                priority: None,
                            ),
                        ],
                        note: Some("lol just Billy"),
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Woodland] Gnat Punctuation",
            note: None,
            only_once: true,
            event: leaveRoom(
                room: "high-ridge",
            ),
            conditions: All([]),
            actions: [
                (
                    action: scheduleInIf(
                        turns_ahead: 2,
                        condition: Any([
                            Pred(playerInRoom(
                                room: "high-ridge",
                            )),
                            Pred(playerInRoom(
                                room: "parish-landing",
                            )),
                            Pred(playerInRoom(
                                room: "two-sheds-landing",
                            )),
                            Pred(playerInRoom(
                                room: "two-sheds",
                            )),
                            Pred(playerInRoom(
                                room: "guard-post",
                            )),
                        ]),
                        on_false: retryNextTurn,
                        actions: [
                            (
                                action: conditional(
                                    condition: Pred(missingFlag(
                                        flag: "read-scrawled-note",
                                    )),
                                    actions: [
                                        (
                                            action: showMessage(
                                                text: "A cloud of gnats drifts by, forming the shapes of the words \"rEAd tHe HiGh RidGe NotE\".",
                                            ),
                                            priority: Some(-50),
                                        ),
                                    ],
                                ),
                                priority: None,
                            ),
                            (
                                action: conditional(
                                    condition: Pred(hasFlag(
                                        flag: "read-scrawled-note",
                                    )),
                                    actions: [
                                        (
                                            action: showMessage(
                                                text: "A cloud of gnats drifts by, lazily holding the shape of \"..?..\".",
                                            ),
                                            priority: Some(-50),
                                        ),
                                    ],
                                ),
                                priority: None,
                            ),
                        ],
                        note: Some("gnats: first fly-by, nudges player to read scrawled_note"),
                    ),
                    priority: None,
                ),
                (
                    action: scheduleInIf(
                        turns_ahead: 6,
                        condition: Any([
                            Pred(playerInRoom(
                                room: "high-ridge",
                            )),
                            Pred(playerInRoom(
                                room: "parish-landing",
                            )),
                            Pred(playerInRoom(
                                room: "two-sheds-landing",
                            )),
                            Pred(playerInRoom(
                                room: "two-sheds",
                            )),
                            Pred(playerInRoom(
                                room: "guard-post",
                            )),
                        ]),
                        on_false: retryNextTurn,
                        actions: [
                            (
                                action: showMessage(
                                    text: "The gnat cloud zips past again in the other direction, this time shaped like \"!!!\".",
                                ),
                                priority: Some(-40),
                            ),
                        ],
                        note: Some("gnats: alarmed"),
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Two-Sheds-Landing] Cut or Chop Tree",
            note: None,
            only_once: true,
            event: actOnItem(
                target: "fallen_tree",
                action: cut,
            ),
            conditions: All([]),
            actions: [
                (
                    action: showMessage(
                        text: "With considerable effort and just one blister, you\'re able to chop a path through the branches. The stone steps continue to curve upward from here.",
                    ),
                    priority: None,
                ),
                (
                    action: damagePlayer(
                        amount: 1,
                        cause: "blister",
                    ),
                    priority: None,
                ),
                (
                    action: scheduleIn(
                        turns_ahead: 20,
                        actions: [
                            (
                                action: healPlayer(
                                    amount: 1,
                                    cause: "time (blister resolved)",
                                ),
                                priority: None,
                            ),
                        ],
                        note: Some("blister heals"),
                    ),
                    priority: None,
                ),
                (
                    action: despawnItem(
                        item: "fallen_tree",
                    ),
                    priority: None,
                ),
                (
                    action: addFlag(
                        flag: simple(
                            name: "cleared-fallen-tree",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: addFlag(
                        flag: simple(
                            name: "chopped-fallen-tree",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: awardPoints(
                        amount: 5,
                        reason: "Cleared the fallen tree the hard way",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Two-Sheds-Landing] Arson-Aid Used on Tree",
            note: None,
            only_once: true,
            event: useItemOnItem(
                tool: "arson_aid",
                target: "fallen_tree",
                interaction: burn,
            ),
            conditions: All([]),
            actions: [
                (
                    action: showMessage(
                        text: "You aim the Arson-Aid and begin to squeeze the trigger when the device erupts into a fireball! Panicking, you throw the whole Arson-Aid into the tree.",
                    ),
                    priority: Some(-30),
                ),
                (
                    action: damagePlayer(
                        amount: 5,
                        cause: "Arson-Aid explosion",
                    ),
                    priority: Some(-29),
                ),
            ],
        ),
        (
            name: "[Two-Sheds-Landing] Burn Tree",
            note: None,
            only_once: true,
            event: actOnItem(
                target: "fallen_tree",
                action: burn,
            ),
            conditions: All([]),
            actions: [
                (
                    action: despawnItem(
                        item: "fallen_tree",
                    ),
                    priority: None,
                ),
                (
                    action: addFlag(
                        flag: simple(
                            name: "cleared-fallen-tree",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: addFlag(
                        flag: simple(
                            name: "burned-fallen-tree",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: awardPoints(
                        amount: 5,
                        reason: "Vaporized the fallen tree with an inferno",
                    ),
                    priority: None,
                ),
                (
                    action: showMessage(
                        text: "WHOOOOOMPH! The fallen tree erupts into flame and, quite improbably, is reduced to ash in mere seconds.",
                    ),
                    priority: Some(-20),
                ),
            ],
        ),
        (
            name: "[Guard-Post] Interesting Passers-By",
            note: Some("different characters depending on how they got past the fallen_tree"),
            only_once: true,
            event: enterRoom(
                room: "guard-post",
            ),
            conditions: All([]),
            actions: [
                (
                    action: scheduleInIf(
                        turns_ahead: 3,
                        condition: All([
                            Pred(chancePercent(
                                percent: 85.0,
                            )),
                            Pred(hasFlag(
                                flag: "burned-fallen-tree",
                            )),
                        ]),
                        on_false: cancel,
                        actions: [
                            (
                                action: showMessage(
                                    text: "Smokey Bear tromps past the guard post, growling \"Nobody ever listens!\" while glaring right at you.",
                                ),
                                priority: None,
                            ),
                        ],
                        note: Some("smokey throws shade"),
                    ),
                    priority: None,
                ),
                (
                    action: scheduleInIf(
                        turns_ahead: 3,
                        condition: All([
                            Pred(chancePercent(
                                percent: 85.0,
                            )),
                            Pred(hasFlag(
                                flag: "chopped-fallen-tree",
                            )),
                        ]),
                        on_false: cancel,
                        actions: [
                            (
                                action: showMessage(
                                    text: "Paul Bunyan gives you a nod as he lumbers by with Babe the Blue Ox, carrying the remains of the tree you chopped up.",
                                ),
                                priority: None,
                            ),
                            (
                                action: addFlag(
                                    flag: simple(
                                        name: "saw-paul-bunyan",
                                    ),
                                ),
                                priority: None,
                            ),
                        ],
                        note: Some("bunyan cleans up"),
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Global] Cannot Drop No Cake",
            note: None,
            only_once: false,
            event: dropItem(
                item: "no_cake",
            ),
            conditions: All([]),
            actions: [
                (
                    action: despawnItem(
                        item: "no_cake",
                    ),
                    priority: None,
                ),
                (
                    action: spawnItemInInventory(
                        item: "no_cake",
                    ),
                    priority: None,
                ),
                (
                    action: showMessage(
                        text: "Try as you might, you cannot rid yourself of the feeling of a missing, promised dessert. The cake was a lie.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "Burn After Reading?",
            note: None,
            only_once: false,
            event: actOnItem(
                target: "scrawled_note",
                action: burn,
            ),
            conditions: All([]),
            actions: [
                (
                    action: showMessage(
                        text: "You burn the note, singeing your fingers in the process. Do you think this is a spy novel?",
                    ),
                    priority: None,
                ),
                (
                    action: despawnItem(
                        item: "scrawled_note",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[High-Ridge] Read Scrawled Note",
            note: None,
            only_once: true,
            event: useItem(
                item: "scrawled_note",
                ability: read,
            ),
            conditions: All([]),
            actions: [
                (
                    action: addFlag(
                        flag: simple(
                            name: "read-scrawled-note",
                        ),
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "The Cake Is A Lie",
            note: None,
            only_once: false,
            event: ingest(
                item: "ephemeral_cake",
                mode: eat,
            ),
            conditions: All([]),
            actions: [
                (
                    action: showMessage(
                        text: "Just as you try to take a bite of the cake, it vanishes without a trace.",
                    ),
                    priority: None,
                ),
                (
                    action: spawnItemInInventory(
                        item: "no_cake",
                    ),
                    priority: None,
                ),
                (
                    action: awardPoints(
                        amount: 2,
                        reason: "Confirmed the cake was a lie",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Parish-Landing] Plaque 1 Too Grimy to Read",
            note: None,
            only_once: false,
            event: useItem(
                item: "plaque_1",
                ability: read,
            ),
            conditions: Pred(missingFlag(
                flag: "cleaned-plaque-1",
            )),
            actions: [
                (
                    action: denyRead(
                        reason: "The plaque is too grimy and worn to make out the words. You\'ll need to find a way to clean it off.",
                    ),
                    priority: None,
                ),
                (
                    action: addFlag(
                        flag: simple(
                            name: "tried-read-plaque-1",
                        ),
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Parish-Landing] Plaque 1 Cleaned",
            note: None,
            only_once: true,
            event: actOnItem(
                target: "plaque_1",
                action: clean,
            ),
            conditions: All([]),
            actions: [
                (
                    action: addFlag(
                        flag: simple(
                            name: "cleaned-plaque-1",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: awardPoints(
                        amount: 3,
                        reason: "Cleaned the grime off plaque 1",
                    ),
                    priority: None,
                ),
                (
                    action: showMessage(
                        text: "With some saliva and a little effort, you\'re able to remove the grime and bring the plaque to a dull shine.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Parish-Landing] Read Cleaned Plaque 1",
            note: None,
            only_once: true,
            event: useItem(
                item: "plaque_1",
                ability: read,
            ),
            conditions: Pred(hasFlag(
                flag: "cleaned-plaque-1",
            )),
            actions: [
                (
                    action: addFlag(
                        flag: simple(
                            name: "read-plaque-1",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: awardPoints(
                        amount: 5,
                        reason: "Read the first crystal plaque",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "Cheat Mode",
            note: None,
            only_once: false,
            event: touchItem(
                item: "cheat_button",
            ),
            conditions: All([]),
            actions: [
                (
                    action: showMessage(
                        text: "Morphed the room into an endgame backdoor!",
                    ),
                    priority: None,
                ),
                (
                    action: modifyRoom(
                        room: "dev-room",
                        patch: (
                            name: Some("AA-3B Back Entrance"),
                            desc: Some("Where there used to be a High Isolated Ridge around you, there is now a blank white room with a door marked \'WIN!\'"),
                            remove_exits: [
                                "high-ridge",
                            ],
                            add_exits: [
                                (
                                    direction: "win the game",
                                    to: "room-aa-3b",
                                    hidden: false,
                                    locked: false,
                                    required_flags: [],
                                    required_items: [
                                        "no_cake",
                                    ],
                                    barred_message: Some("You must hold no cake to fathom Room AA-3B\'s mysteries."),
                                ),
                            ],
                        ),
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "Big Red Button Pushed",
            note: Some("test for the touch item command/event -- works!"),
            only_once: false,
            event: touchItem(
                item: "big_red_button",
            ),
            conditions: All([]),
            actions: [
                (
                    action: showMessage(
                        text: "Always [[red]]never[[/red]] press the big red button! [[i]]Now look what you\'ve done![[/i]]",
                    ),
                    priority: None,
                ),
                (
                    action: spawnNpcInRoom(
                        npc: "the_luggage",
                        room: "dev-room",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "Big Blue Button Pushed",
            note: Some("test modify npc"),
            only_once: false,
            event: touchItem(
                item: "big_blue_button",
            ),
            conditions: All([]),
            actions: [
                (
                    action: showMessage(
                        text: "Modifying the Luggage...",
                    ),
                    priority: None,
                ),
                (
                    action: modifyNpc(
                        npc: "the_luggage",
                        patch: (
                            name: Some("Hungry Luggage"),
                            desc: Some("The Luggage is ravenous! Beware!!"),
                            state: Some(custom("hungry")),
                            add_lines: [
                                (
                                    state: custom("hungry"),
                                    line: "(The Luggage nearly bites your face off when you approach.)",
                                ),
                            ],
                            movement: Some((
                                route: None,
                                random_rooms: Some([
                                    "dev-room",
                                    "lounge",
                                ]),
                                timing: Some(everyNTurns(
                                    turns: 5,
                                )),
                                active: Some(true),
                                loop_route: Some(true),
                            )),
                        ),
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[DEV] Poison the Luggage",
            note: None,
            only_once: false,
            event: giveToNpc(
                item: "poison_bottle",
                npc: "the_luggage",
            ),
            conditions: Pred(npcInState(
                npc: "the_luggage",
                state: normal,
            )),
            actions: [
                (
                    action: npcRefuseItem(
                        npc: "the_luggage",
                        reason: "Despite having no eyes, the Luggage glares at you, keeping its lid tightly shut.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[DEV] Poison the Luggage",
            note: None,
            only_once: false,
            event: giveToNpc(
                item: "poison_bottle",
                npc: "the_luggage",
            ),
            conditions: Pred(npcInState(
                npc: "the_luggage",
                state: custom("hungry"),
            )),
            actions: [
                (
                    action: showMessage(
                        text: "The Luggage snaps at your hand and hungrily swallows the whole bottle.",
                    ),
                    priority: None,
                ),
                (
                    action: damageNpcOT(
                        npc: "the_luggage",
                        amount: 5,
                        turns: 4,
                        cause: "poison",
                    ),
                    priority: None,
                ),
                (
                    action: despawnItem(
                        item: "poison_bottle",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[DEV] Luggage Dies",
            note: None,
            only_once: false,
            event: npcDeath(
                npc: "the_luggage",
            ),
            conditions: All([]),
            actions: [
                (
                    action: showMessage(
                        text: "The Luggage dies with a gasp, its tongue lolling out of the lid.",
                    ),
                    priority: None,
                ),
                (
                    action: modifyNpc(
                        npc: "the_luggage",
                        patch: (
                            name: None,
                            desc: Some("The magnificent magical Luggage lies dead, lid ajar, tongue lolling and cut by the razor-sharp teeth lining the lid."),
                            state: None,
                            add_lines: [],
                            movement: None,
                        ),
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "Note too tiny",
            note: None,
            only_once: false,
            event: useItem(
                item: "tiny_note",
                ability: read,
            ),
            conditions: Pred(missingItem(
                item: "magnifying_glass",
            )),
            actions: [
                (
                    action: denyRead(
                        reason: "The print is too small for you to read unmagnified.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "Drink the Strange Liquid",
            note: Some("trip daisies for a few turns with foreshadowing"),
            only_once: false,
            event: ingest(
                item: "strange_liquid",
                mode: drink,
            ),
            conditions: All([]),
            actions: [
                (
                    action: addFlag(
                        flag: simple(
                            name: "status:tripping",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: showMessage(
                        text: "The strange liquid feels incredibly cold as it spreads slowly down your esophagus, then you start to... see things.",
                    ),
                    priority: None,
                ),
                (
                    action: scheduleIn(
                        turns_ahead: 2,
                        actions: [
                            (
                                action: showMessage(
                                    text: "<Vision> A see-through doctor takes a tool from another doctor, then turns to face you with one glowing red eye.",
                                ),
                                priority: None,
                            ),
                        ],
                        note: None,
                    ),
                    priority: None,
                ),
                (
                    action: scheduleIn(
                        turns_ahead: 4,
                        actions: [
                            (
                                action: showMessage(
                                    text: "<Vision> A scientist peers into a vending machine. Someone shouts,\"Gordon!\" and he turns around, focusing on you with one red eye.",
                                ),
                                priority: None,
                            ),
                        ],
                        note: None,
                    ),
                    priority: None,
                ),
                (
                    action: scheduleIn(
                        turns_ahead: 6,
                        actions: [
                            (
                                action: showMessage(
                                    text: "<Vision> A shifty man with a red light behind one pupil hands you a hot dog, but electronic bits inside the casing nearly break your teeth when you bite into it.",
                                ),
                                priority: None,
                            ),
                        ],
                        note: None,
                    ),
                    priority: None,
                ),
                (
                    action: scheduleIn(
                        turns_ahead: 7,
                        actions: [
                            (
                                action: removeFlag(
                                    name: "status:tripping",
                                ),
                                priority: None,
                            ),
                            (
                                action: awardPoints(
                                    amount: 5,
                                    reason: "Rode out the strange liquid vision quest",
                                ),
                                priority: None,
                            ),
                        ],
                        note: None,
                    ),
                    priority: None,
                ),
                (
                    action: scheduleInIf(
                        turns_ahead: 20,
                        condition: Pred(missingFlag(
                            flag: "appeased-black-knight",
                        )),
                        on_false: cancel,
                        actions: [
                            (
                                action: showMessage(
                                    text: "<Flashback> A medieval knight smiles as he slices aluminum cans and tomatoes with his sword.",
                                ),
                                priority: None,
                            ),
                        ],
                        note: None,
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Global] Open Delivery Box",
            note: None,
            only_once: true,
            event: openItem(
                item: "delivery_box",
            ),
            conditions: All([]),
            actions: [
                (
                    action: despawnItem(
                        item: "delivery_box",
                    ),
                    priority: None,
                ),
                (
                    action: spawnItemCurrentRoom(
                        item: "destroyed_box",
                    ),
                    priority: None,
                ),
                (
                    action: spawnItemCurrentRoom(
                        item: "towel",
                    ),
                    priority: None,
                ),
                (
                    action: showMessage(
                        text: "The box sighs and collapses in a heap as soon as you touch it, relieved that its mission is over. Inside, you find a nanotruss-reinforced tachyon-powered towel with an attached note:\n\n                Always be a frood who knows where his towel is.\n                                -- F.P.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Global] Take Vogon Poetry",
            note: Some("merely taking poetry book does not cause status effect -- reading does"),
            only_once: false,
            event: takeItem(
                item: "vogon_poetry_book",
            ),
            conditions: All([]),
            actions: [
                (
                    action: showMessage(
                        text: "A greasy feeling of nausea overcomes you.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Global] Drop Vogon Poetry",
            note: Some("dropping only stops the nausea if player has not read it"),
            only_once: false,
            event: dropItem(
                item: "vogon_poetry_book",
            ),
            conditions: Pred(missingFlag(
                flag: "read-vogon-poetry",
            )),
            actions: [
                (
                    action: showMessage(
                        text: "That greasy, queasy feeling subsides.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Global] Drop Vogon Poetry",
            note: Some("dropping only stops the nausea if player has not read it"),
            only_once: false,
            event: dropItem(
                item: "vogon_poetry_book",
            ),
            conditions: Pred(hasFlag(
                flag: "read-vogon-poetry",
            )),
            actions: [
                (
                    action: showMessage(
                        text: "Getting rid of the book helps a little, but the poem is burned into your mind and the nausea continues.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Global] Eat Sausage-Inna-Bun",
            note: None,
            only_once: false,
            event: ingest(
                item: "sausage-inna-bun",
                mode: eat,
            ),
            conditions: All([]),
            actions: [
                (
                    action: showMessage(
                        text: "You hungrily chomp down the sausage stuffed with questionable meats. Before long, your guts begin to complain loudly.",
                    ),
                    priority: None,
                ),
                (
                    action: addFlag(
                        flag: simple(
                            name: "status:bad-breath",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: addFlag(
                        flag: simple(
                            name: "ate-sausage",
                        ),
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Med-Bay] Talk to EMH After Finding HAL",
            note: Some("quest to mobilize emh starts; ultimate reward is HAL module #1"),
            only_once: true,
            event: always,
            conditions: All([
                Pred(withNpc(
                    npc: "emh",
                )),
                Pred(flagInProgress(
                    flag: "hal-reboot",
                )),
            ]),
            actions: [
                (
                    action: npcSays(
                        npc: "emh",
                        quote: "Ah -- I hoped I would catch you. Word is, you\'ve seen HAL, or what remains of him. If you want to get him working again -- and I\'m not sure I\'d advise it -- I may be able to get one of those memory modules for you.",
                    ),
                    priority: None,
                ),
                (
                    action: setNpcState(
                        npc: "emh",
                        state: custom("want-emitter"),
                    ),
                    priority: None,
                ),
                (
                    action: spawnItemInContainer(
                        item: "broken_emitter",
                        container: "lost_and_found_box",
                    ),
                    priority: None,
                ),
                (
                    action: addFlag(
                        flag: sequence(
                            name: "mobilize-emh",
                            end: Some(3),
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: addFlag(
                        flag: simple(
                            name: "got-hint-from-emh",
                        ),
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Med-Bay] EMH/Sonic Hint",
            note: None,
            only_once: true,
            event: enterRoom(
                room: "med-bay",
            ),
            conditions: All([
                Pred(hasItem(
                    item: "sonic_screwdriver",
                )),
                Pred(hasFlag(
                    flag: "mobilize-emh#1",
                )),
            ]),
            actions: [
                (
                    action: npcSays(
                        npc: "emh",
                        quote: "Please state the nature of the med... wait -- is that a sonic screwdriver? I bet you could use that to repair my mobile emitter!",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Med-Bay] Advance Sequence when Broken Emitter Found",
            note: Some("advance to mobilize-emh#1 when emitter taken"),
            only_once: true,
            event: takeItem(
                item: "broken_emitter",
            ),
            conditions: All([]),
            actions: [
                (
                    action: advanceFlag(
                        name: "mobilize-emh",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Med-Bay] EMH Won\'t Take Broken Emitter",
            note: None,
            only_once: false,
            event: giveToNpc(
                item: "broken_emitter",
                npc: "emh",
            ),
            conditions: All([]),
            actions: [
                (
                    action: npcRefuseItem(
                        npc: "emh",
                        reason: "That\'s my mobile emitter all right, but it\'s broken. You\'ll need to find a way to repair it before I can help you with HAL.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Med-Bay] Use Sonic On Emitter",
            note: None,
            only_once: false,
            event: useItemOnItem(
                tool: "sonic_screwdriver",
                target: "broken_emitter",
                interaction: repair,
            ),
            conditions: All([]),
            actions: [
                (
                    action: showMessage(
                        text: "You hold the button down on the sonic. It makes electronic whirring noises while you make a few passes over the emitter.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Med-Bay] Repair Emitter",
            note: Some("advance to mobilize-emh#2 when mobile emitter repaired"),
            only_once: false,
            event: actOnItem(
                target: "broken_emitter",
                action: repair,
            ),
            conditions: All([]),
            actions: [
                (
                    action: showMessage(
                        text: "After a few seconds, the emitter lights up and reboots, passing all self-tests.",
                    ),
                    priority: None,
                ),
                (
                    action: replaceItem(
                        old_item: "broken_emitter",
                        new_item: "working_emitter",
                    ),
                    priority: None,
                ),
                (
                    action: awardPoints(
                        amount: 3,
                        reason: "Repaired the EMH\'s mobile emitter",
                    ),
                    priority: None,
                ),
                (
                    action: advanceFlag(
                        name: "mobilize-emh",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Med-Bay] EMH/Goin\' Mobile!",
            note: Some("completes mobilize-emh #3; completes / grants player HAL memory module #1"),
            only_once: false,
            event: giveToNpc(
                item: "working_emitter",
                npc: "emh",
            ),
            conditions: All([]),
            actions: [
                (
                    action: setItemMovability(
                        item: "working_emitter",
                        movability: restricted(
                            reason: "The EMH won\'t be losing sight of it again anytime soon.",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: advanceFlag(
                        name: "mobilize-emh",
                    ),
                    priority: None,
                ),
                (
                    action: setNpcActive(
                        npc: "emh",
                        active: true,
                    ),
                    priority: None,
                ),
                (
                    action: setNpcState(
                        npc: "emh",
                        state: happy,
                    ),
                    priority: None,
                ),
                (
                    action: npcSays(
                        npc: "emh",
                        quote: "Looks like it\'s working properly! Let me take it for a spin...",
                    ),
                    priority: None,
                ),
                (
                    action: showMessage(
                        text: "The EMH flickers, then vanishes in a flash. He reappears a few moments later.",
                    ),
                    priority: None,
                ),
                (
                    action: npcSays(
                        npc: "emh",
                        quote: "All seems to be in order. As promised, I retrieved one of HAL\'s modules. I dropped it off in the observation room across the hall, next to HAL\'s memory bank -- but insert it at your own peril.",
                    ),
                    priority: None,
                ),
                (
                    action: spawnItemInRoom(
                        item: "hal_module_1",
                        room: "observation-room",
                    ),
                    priority: None,
                ),
                (
                    action: addSpinnerWedge(
                        spinner: "ambientInterior",
                        text: "Heard overhead: \"Will the E.M.H. please return to the med bay? There\'s been a yellow snow blinding incident.\"",
                        width: 1,
                    ),
                    priority: None,
                ),
                (
                    action: addSpinnerWedge(
                        spinner: "ambientInterior",
                        text: "Over the PA: \"E.M.H and sanitation, please report to the lunch room. Mr. Creosote ate a tiny, wafer thin mint again.\"",
                        width: 1,
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[HAL] HAL/Module #1 Inserted",
            note: None,
            only_once: true,
            event: insertItemInto(
                item: "hal_module_1",
                container: "hal_memory_bank",
            ),
            conditions: All([]),
            actions: [
                (
                    action: advanceFlag(
                        name: "hal-reboot",
                    ),
                    priority: None,
                ),
                (
                    action: addFlag(
                        flag: simple(
                            name: "module-1-inserted",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: setItemMovability(
                        item: "hal_module_1",
                        movability: restricted(
                            reason: "It\'s magnetically locked in place.",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: showMessage(
                        text: "Memory module #1 magnetically locks into place and lights up.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "Reveal HAL Module #2",
            note: Some("reveal the nature of HAL module #2"),
            only_once: true,
            event: talkToNpc(
                npc: "hal_9000",
            ),
            conditions: All([]),
            actions: [
                (
                    action: modifyItem(
                        item: "hal_module_2",
                        patch: (
                            name: Some("HAL Memory Module #2"),
                            desc: Some("Second in the trio of HAL\'s memory modules, found in a vending machine (oddly) between some dehydrated water and a sandwich that both did and did not exist until eaten."),
                            text: None,
                            movability: None,
                            container_state: None,
                            remove_container_state: false,
                            add_abilities: [],
                            remove_abilities: [],
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: modifyItem(
                        item: "hal_module_2_crevice",
                        patch: (
                            name: Some("HAL Memory Module #2 (in crevice)"),
                            desc: Some("Second in the trio of HAL\'s memory modules. The module has fallen deep into a narrow crevice between the vending machine and the floor. Its red LED pulses from the darkness about a foot down, resting on what looks like decades of accumulated dust, lost coins, and possibly sentient dust bunnies. The gap is too narrow for your hand - you\'ll need some kind of tool to fish it out."),
                            text: None,
                            movability: None,
                            container_state: None,
                            remove_container_state: false,
                            add_abilities: [],
                            remove_abilities: [],
                        ),
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Main-Lobby] Spot HAL Module #2 / Start Puzzle",
            note: None,
            only_once: true,
            event: lookAtItem(
                item: "vending_machine",
            ),
            conditions: Pred(flagInProgress(
                flag: "hal-reboot",
            )),
            actions: [
                (
                    action: addFlag(
                        flag: simple(
                            name: "found-module-2",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: addFlag(
                        flag: sequence(
                            name: "module-2-puzzle",
                            end: Some(2),
                        ),
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[HINT Available] Make A Fishing Line",
            note: Some("makes hint available when HAL module trapped in crevice"),
            only_once: true,
            event: useItemOnItem(
                tool: "crowbar",
                target: "vending_machine",
                interaction: open,
            ),
            conditions: All([]),
            actions: [
                (
                    action: scheduleInIf(
                        turns_ahead: 2,
                        condition: Any([
                            All([
                                Pred(hasItem(
                                    item: "hint_radio",
                                )),
                                Pred(hasFlag(
                                    flag: "hint-radio-on",
                                )),
                                Pred(hasFlag(
                                    flag: "hal-module-in-crevice",
                                )),
                            ]),
                            Pred(hasFlag(
                                flag: "hal-module-2-retrieved",
                            )),
                        ]),
                        on_false: retryNextTurn,
                        actions: [
                            (
                                action: conditional(
                                    condition: All([
                                        Pred(hasItem(
                                            item: "hint_radio",
                                        )),
                                        Pred(hasFlag(
                                            flag: "hint-radio-on",
                                        )),
                                        Pred(hasFlag(
                                            flag: "hal-module-in-crevice",
                                        )),
                                    ]),
                                    actions: [
                                        (
                                            action: npcSays(
                                                npc: "hint_radio_npc",
                                                quote: "Whoops. That electronic bit fell way down in that crevice. Looks like you\'ll need something like a fishing line to pull it out. There must be **something** you can use around here.",
                                            ),
                                            priority: None,
                                        ),
                                    ],
                                ),
                                priority: None,
                            ),
                        ],
                        note: Some("fishing line hint available"),
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Main-Lobby] Pry Vending Machine Open with Crowbar",
            note: None,
            only_once: true,
            event: useItemOnItem(
                tool: "crowbar",
                target: "vending_machine",
                interaction: open,
            ),
            conditions: All([]),
            actions: [
                (
                    action: showMessage(
                        text: "With a mighty heave and several creative applications of leverage that would make Archimedes proud, you pry open the vending machine. There\'s a satisfying CRACK as the lock mechanism gives way. Unfortunately, your vigorous prying causes the machine to tilt forward slightly, and you watch in horror as the HAL module slides off its shelf and disappears into a narrow crevice between the machine and the floor. The other items tumble onto the floor around you.\n\nThe machine\'s internal speaker crackles to life one last time: \'Thank you for choosing violence. Have a mediocre day.\'",
                    ),
                    priority: None,
                ),
                (
                    action: advanceFlag(
                        name: "module-2-puzzle",
                    ),
                    priority: None,
                ),
                (
                    action: replaceDropItem(
                        old_item: "hal_module_2",
                        new_item: "hal_module_2_crevice",
                    ),
                    priority: None,
                ),
                (
                    action: replaceDropItem(
                        old_item: "dehydrated_water",
                        new_item: "dehydrated_water",
                    ),
                    priority: None,
                ),
                (
                    action: replaceDropItem(
                        old_item: "schrodingers_sandwich",
                        new_item: "schrodingers_sandwich",
                    ),
                    priority: None,
                ),
                (
                    action: replaceDropItem(
                        old_item: "fortune_cookies_of_doom",
                        new_item: "fortune_cookies_of_doom",
                    ),
                    priority: None,
                ),
                (
                    action: addFlag(
                        flag: simple(
                            name: "vending-machine-pried",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: addFlag(
                        flag: simple(
                            name: "hal-module-in-crevice",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: setItemDescription(
                        item: "vending_machine",
                        text: "A battered and broken vending machine -- even more so since you took a crowbar to it. Miraculously, the glass still remains intact on the front panel which has been pried open and hangs on a slant. Empty now, the machine\'s contents have all spilled out on the floor.",
                    ),
                    priority: None,
                ),
                (
                    action: awardPoints(
                        amount: 5,
                        reason: "Pried the vending machine open to expose HAL\'s module",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Main-Lobby] Fish HAL Module Out of Crevice",
            note: None,
            only_once: true,
            event: useItemOnItem(
                tool: "fishing_line",
                target: "hal_module_2_crevice",
                interaction: handle,
            ),
            conditions: Pred(hasFlag(
                flag: "module-2-puzzle#1",
            )),
            actions: [
                (
                    action: showMessage(
                        text: "You carefully lower your makeshift fishing line into the crevice where the HAL module fell. After several attempts and some creative swearing, you manage to hook the module with the paper clip. You slowly, carefully pull it up, holding your breath the entire time. Success! The module is yours, though it\'s now covered in dust and what might be ancient gum.",
                    ),
                    priority: None,
                ),
                (
                    action: despawnItem(
                        item: "hal_module_2_crevice",
                    ),
                    priority: None,
                ),
                (
                    action: setItemDescription(
                        item: "hal_module_2",
                        text: "Second in the trio of HAL\'s missing memory modules. Its red LED pulses gently, like a heartbeat—or a warning. Its case was cracked during retrieval from the vending machine and floor crevice, but it still seems serviceable.",
                    ),
                    priority: None,
                ),
                (
                    action: spawnItemInInventory(
                        item: "hal_module_2",
                    ),
                    priority: None,
                ),
                (
                    action: awardPoints(
                        amount: 10,
                        reason: "Fished HAL module #2 out of the floor crevice",
                    ),
                    priority: None,
                ),
                (
                    action: addFlag(
                        flag: simple(
                            name: "hal-module-2-retrieved",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: advanceFlag(
                        name: "module-2-puzzle",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Main-Lobby] Can\'t Reach HAL Module in Crevice",
            note: None,
            only_once: false,
            event: takeItem(
                item: "hal_module_2_crevice",
            ),
            conditions: Pred(hasFlag(
                flag: "module-2-puzzle#1",
            )),
            actions: [
                (
                    action: showMessage(
                        text: "The HAL module has fallen deep into a narrow crevice between the vending machine and the floor. You try to reach it with your hand, but the gap is too narrow. Your fingers can just barely brush against the module, pushing it slightly further away. You\'re going to need some kind of fishing tool to retrieve it.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[HAL] HAL/Module #2 Inserted",
            note: None,
            only_once: true,
            event: insertItemInto(
                item: "hal_module_2",
                container: "hal_memory_bank",
            ),
            conditions: All([]),
            actions: [
                (
                    action: advanceFlag(
                        name: "hal-reboot",
                    ),
                    priority: None,
                ),
                (
                    action: addFlag(
                        flag: simple(
                            name: "module-2-inserted",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: setItemMovability(
                        item: "hal_module_2",
                        movability: restricted(
                            reason: "It\'s magnetically locked in place.",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: showMessage(
                        text: "Memory module #2 magnetically locks into place and lights up.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "Reveal HAL Module #3",
            note: Some("reveal nature of electronic gizmo once HAL is met"),
            only_once: true,
            event: talkToNpc(
                npc: "hal_9000",
            ),
            conditions: All([]),
            actions: [
                (
                    action: modifyItem(
                        item: "hal_module_3",
                        patch: (
                            name: Some("HAL Memory Module #3"),
                            desc: Some("The final piece of HAL’s fragmented mind. The outer shell is pristine, but something about it feels... watchful. Once inserted, the full system may awaken — and then things might get complicated."),
                            text: None,
                            movability: None,
                            container_state: None,
                            remove_container_state: false,
                            add_abilities: [],
                            remove_abilities: [],
                        ),
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[HAL] HAL/Module #3 Inserted",
            note: None,
            only_once: true,
            event: insertItemInto(
                item: "hal_module_3",
                container: "hal_memory_bank",
            ),
            conditions: All([]),
            actions: [
                (
                    action: advanceFlag(
                        name: "hal-reboot",
                    ),
                    priority: None,
                ),
                (
                    action: addFlag(
                        flag: simple(
                            name: "module-3-inserted",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: setItemMovability(
                        item: "hal_module_3",
                        movability: restricted(
                            reason: "It\'s magnetically locked in place.",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: showMessage(
                        text: "Memory module #3 magnetically locks into place and lights up.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Monolith-Room] HAL/Start Reboot Sequence",
            note: Some("talking to HAL first time initiates the HAL reboot puzzle sequence"),
            only_once: true,
            event: talkToNpc(
                npc: "hal_9000",
            ),
            conditions: All([]),
            actions: [
                (
                    action: addFlag(
                        flag: sequence(
                            name: "hal-reboot",
                            end: Some(3),
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: addFlag(
                        flag: simple(
                            name: "talked-to-hal",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: setNpcState(
                        npc: "hal_9000",
                        state: custom("memory-0"),
                    ),
                    priority: None,
                ),
                (
                    action: npcSays(
                        npc: "hal_9000",
                        quote: "(when you speak, the red light in HAL\'s lens begins to pulse slowly, then grows steady)",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Monolith-Room] HAL/One Module In",
            note: None,
            only_once: false,
            event: always,
            conditions: Pred(hasFlag(
                flag: "hal-reboot#1",
            )),
            actions: [
                (
                    action: setNpcState(
                        npc: "hal_9000",
                        state: custom("memory-1"),
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Monolith-Room] HAL/Two Modules In",
            note: None,
            only_once: false,
            event: always,
            conditions: Pred(hasFlag(
                flag: "hal-reboot#2",
            )),
            actions: [
                (
                    action: setNpcState(
                        npc: "hal_9000",
                        state: custom("memory-2"),
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Monolith-Room] HAL/All Modules In",
            note: None,
            only_once: true,
            event: always,
            conditions: Pred(flagComplete(
                flag: "hal-reboot",
            )),
            actions: [
                (
                    action: awardPoints(
                        amount: 10,
                        reason: "Fully restored HAL\'s memory core",
                    ),
                    priority: None,
                ),
                (
                    action: setNpcState(
                        npc: "hal_9000",
                        state: custom("memory-3"),
                    ),
                    priority: None,
                ),
                (
                    action: showMessage(
                        text: "All memory now restored, HAL-9000 finishes rebooting and is fully operational.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "Turn Hint Radio On",
            note: None,
            only_once: false,
            event: useItem(
                item: "hint_radio",
                ability: turnOn,
            ),
            conditions: All([]),
            actions: [
                (
                    action: modifyItem(
                        item: "hint_radio",
                        patch: (
                            name: Some("HINT Radio (on)"),
                            desc: Some("A black, long-range walkie-talkie style radio transceiver. A label bearing the word \"HINTS\" is affixed to the side. The transmit button has been removed. The \"Power\" LED is on and soft static whispers from the speaker."),
                            text: None,
                            movability: None,
                            container_state: None,
                            remove_container_state: false,
                            add_abilities: [
                                turnOff,
                            ],
                            remove_abilities: [
                                turnOn,
                            ],
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: addFlag(
                        flag: simple(
                            name: "hint-radio-on",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: showMessage(
                        text: "The radio clicks on and emits a soft static.",
                    ),
                    priority: Some(-50),
                ),
            ],
        ),
        (
            name: "Turn Hint Radio On: First Time",
            note: Some("explanatory message and points only on first activation"),
            only_once: true,
            event: useItem(
                item: "hint_radio",
                ability: turnOn,
            ),
            conditions: Pred(hasFlag(
                flag: "burned-fallen-tree",
            )),
            actions: [
                (
                    action: npcSays(
                        npc: "hint_radio_npc",
                        quote: "Congratulations, Candidate, you\'ve passed your first obstacle - though you lose a point for nearly starting a forest fire. I am your -- handler, let\'s say -- and this is your HINT radio. In some circumstances, I may be able to provide some extra direction to help you along -- but it looks better if you don\'t rely on me too heavily.",
                    ),
                    priority: Some(-30),
                ),
                (
                    action: awardPoints(
                        amount: -1,
                        reason: "Started a forest fire instead of solving the obstacle cleanly",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "Turn Hint Radio On: First Time",
            note: Some("explanatory message and points only on first activation"),
            only_once: true,
            event: useItem(
                item: "hint_radio",
                ability: turnOn,
            ),
            conditions: Pred(hasFlag(
                flag: "chopped-fallen-tree",
            )),
            actions: [
                (
                    action: npcSays(
                        npc: "hint_radio_npc",
                        quote: "Congratulations, Candidate. You\'ve cleared the fallen tree, and you get a bonus point for choosing the hard path of chopping through the tree rather than starting a forest fire. I am your -- handler, let\'s say -- and this is your HINT radio. In some circumstances, I may be able to provide some extra direction to help you along -- but it looks better if you don\'t rely on me too heavily.",
                    ),
                    priority: Some(-30),
                ),
                (
                    action: awardPoints(
                        amount: 1,
                        reason: "Chopped through the fallen tree the hard way",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "Turn Hint Radio On: First Time",
            note: Some("explanatory message and points only on first activation"),
            only_once: true,
            event: useItem(
                item: "hint_radio",
                ability: turnOn,
            ),
            conditions: All([]),
            actions: [
                (
                    action: showMessage(
                        text: "A soothing yet somehow disquieting and familiar voice flows from the radio\'s speaker.",
                    ),
                    priority: Some(-40),
                ),
            ],
        ),
        (
            name: "Turn Hint Radio Off",
            note: None,
            only_once: false,
            event: useItem(
                item: "hint_radio",
                ability: turnOff,
            ),
            conditions: All([]),
            actions: [
                (
                    action: modifyItem(
                        item: "hint_radio",
                        patch: (
                            name: Some("HINT Radio (off)"),
                            desc: Some("A black, long-range walkie-talkie style radio transceiver. A label bearing the word \"HINTS\" is affixed to the side. The transmit button has been removed. The \"Power\" LED is off."),
                            text: None,
                            movability: None,
                            container_state: None,
                            remove_container_state: false,
                            add_abilities: [
                                turnOn,
                            ],
                            remove_abilities: [
                                turnOff,
                            ],
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: removeFlag(
                        name: "hint-radio-on",
                    ),
                    priority: None,
                ),
                (
                    action: showMessage(
                        text: "The radio clicks off.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Status] Nauseated",
            note: None,
            only_once: false,
            event: always,
            conditions: All([
                Pred(hasFlag(
                    flag: "status:nauseated",
                )),
                Pred(chancePercent(
                    percent: 50.0,
                )),
            ]),
            actions: [
                (
                    action: spinnerMessage(
                        spinner: "nauseated",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Status] Read Vogon Poetry > Persistent Nausea",
            note: None,
            only_once: false,
            event: useItem(
                item: "vogon_poetry_book",
                ability: read,
            ),
            conditions: All([]),
            actions: [
                (
                    action: showMessage(
                        text: "You nearly get through the first poem when the vomiting begins...",
                    ),
                    priority: None,
                ),
                (
                    action: addFlag(
                        flag: simple(
                            name: "read-vogon-poetry",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: addFlag(
                        flag: simple(
                            name: "status:nauseated",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: damagePlayer(
                        amount: 2,
                        cause: "read the Vogon poetry",
                    ),
                    priority: None,
                ),
                (
                    action: awardPoints(
                        amount: -1,
                        reason: "Voluntarily read Vogon poetry",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Status] Bad Breath",
            note: None,
            only_once: false,
            event: always,
            conditions: All([
                Pred(hasFlag(
                    flag: "status:bad-breath",
                )),
                Pred(chancePercent(
                    percent: 20.0,
                )),
            ]),
            actions: [
                (
                    action: spinnerMessage(
                        spinner: "bad-breath",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Global] Arson-Aid Used",
            note: None,
            only_once: true,
            event: useItem(
                item: "arson_aid",
                ability: ignite,
            ),
            conditions: All([]),
            actions: [
                (
                    action: showMessage(
                        text: "The Initech Arson-Aid melts down into an amorphous, hissing blob. As expected.",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Hint] Towel / Plaque-1 Hint",
            note: None,
            only_once: true,
            event: takeItem(
                item: "towel",
            ),
            conditions: All([]),
            actions: [
                (
                    action: addFlag(
                        flag: simple(
                            name: "got-towel",
                        ),
                    ),
                    priority: None,
                ),
                (
                    action: awardPoints(
                        amount: 3,
                        reason: "Recovered the essential towel every frood should carry",
                    ),
                    priority: None,
                ),
                (
                    action: showMessage(
                        text: "NOW you\'re a frood who really \"knows where his towel is\"!",
                    ),
                    priority: None,
                ),
                (
                    action: scheduleInIf(
                        turns_ahead: 10,
                        condition: All([
                            Pred(hasItem(
                                item: "towel",
                            )),
                            Pred(missingFlag(
                                flag: "read-plaque-1",
                            )),
                            Pred(hasFlag(
                                flag: "tried-read-plaque-1",
                            )),
                        ]),
                        on_false: cancel,
                        actions: [
                            (
                                action: showMessage(
                                    text: "Towels can be awfully handy for cleaning grimy things. Just sayin\'.",
                                ),
                                priority: None,
                            ),
                        ],
                        note: Some("hint: towels can clean things"),
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Global] Fishing Line (attach clip to floss)",
            note: None,
            only_once: false,
            event: useItemOnItem(
                tool: "paper_clip",
                target: "dental_floss",
                interaction: attach,
            ),
            conditions: All([]),
            actions: [
                (
                    action: despawnItem(
                        item: "paper_clip",
                    ),
                    priority: None,
                ),
                (
                    action: despawnItem(
                        item: "dental_floss",
                    ),
                    priority: None,
                ),
                (
                    action: spawnItemInInventory(
                        item: "fishing_line",
                    ),
                    priority: None,
                ),
                (
                    action: showMessage(
                        text: "You MacGyvered the floss and paper clip into a fishing line!",
                    ),
                    priority: None,
                ),
                (
                    action: awardPoints(
                        amount: 3,
                        reason: "Improvised a fishing line from junk drawer staples",
                    ),
                    priority: None,
                ),
            ],
        ),
        (
            name: "[Global] Fishing Line (attach floss to clip)",
            note: None,
            only_once: false,
            event: useItemOnItem(
                tool: "dental_floss",
                target: "paper_clip",
                interaction: attach,
            ),
            conditions: All([]),
            actions: [
                (
                    action: despawnItem(
                        item: "paper_clip",
                    ),
                    priority: None,
                ),
                (
                    action: despawnItem(
                        item: "dental_floss",
                    ),
                    priority: None,
                ),
                (
                    action: spawnItemInInventory(
                        item: "fishing_line",
                    ),
                    priority: None,
                ),
                (
                    action: showMessage(
                        text: "You MacGyvered the floss and paper clip into a fishing line!",
                    ),
                    priority: None,
                ),
                (
                    action: awardPoints(
                        amount: 3,
                        reason: "Improvised a fishing line from junk drawer staples",
                    ),
                    priority: None,
                ),
            ],
        ),
    ],
    goals: [
        (
            id: "get-invited",
            name: "Get an Invitation",
            description: "The receptionist in the Amble Adventures office won\'t help you without an invitation; you\'ll need to get one somehow.",
            group: required,
            activate_when: Some(goalComplete(
                goal_id: "find-the-office",
            )),
            finished_when: hasFlag(
                flag: "got-invitation",
            ),
            failed_when: None,
        ),
        (
            id: "obtain-portal-power",
            name: "Find a Power Source",
            description: "You found a portal gun, but the power source is dead. Find another one or charge the empty battery to get the gun working.",
            group: required,
            activate_when: Some(hasFlag(
                flag: "portal-gun-opened",
            )),
            finished_when: hasFlag(
                flag: "portal-gun-powered",
            ),
            failed_when: None,
        ),
        (
            id: "open-a-portal",
            name: "Open a Portal to... ?",
            description: "Now that you have a suitable power source, you should be able to turn the gun on to open a portal. But where will it lead?",
            group: required,
            activate_when: Some(goalComplete(
                goal_id: "obtain-portal-power",
            )),
            finished_when: hasFlag(
                flag: "portal-opened",
            ),
            failed_when: None,
        ),
        (
            id: "find-the-office",
            name: "Find the Office",
            description: "According to the posted note, there\'s an office somewhere around here and you need to check in. You\'ll need to find it first.",
            group: required,
            activate_when: Some(goalComplete(
                goal_id: "get-oriented",
            )),
            finished_when: reachedRoom(
                room: "b-a-office",
            ),
            failed_when: None,
        ),
        (
            id: "get-visitor-pass",
            name: "Get a Visitor Pass",
            description: "Now that you have an invitation, maybe the receptionist in the office will help you with this -- or maybe she won\'t.",
            group: required,
            activate_when: Some(goalComplete(
                goal_id: "get-invited",
            )),
            finished_when: hasFlag(
                flag: "got-visitor-pass",
            ),
            failed_when: None,
        ),
        (
            id: "activate-elevator",
            name: "Activate the Elevator",
            description: "Now that you have both a visitor pass and the proximity keycard, you should be able to use the elevator off the main lobby.",
            group: required,
            activate_when: Some(goalComplete(
                goal_id: "get-elevator-keycard",
            )),
            finished_when: hasFlag(
                flag: "elevator-activated",
            ),
            failed_when: None,
        ),
        (
            id: "get-elevator-keycard",
            name: "Get the Elevator Keycard",
            description: "The receptionist said the last Candidate had the proximity card just before it melted in the panic room. (The Candidate melted, not the card.) It may still be there.",
            group: required,
            activate_when: Some(goalComplete(
                goal_id: "get-visitor-pass",
            )),
            finished_when: hasFlag(
                flag: "got-elevator-keycard",
            ),
            failed_when: None,
        ),
        (
            id: "get-a-towel",
            name: "Find a Towel",
            description: "No adventurer should ever be without one. In fact, the security bot at the building entrance insists that you have one in your posession before you\'re permitted to enter.",
            group: required,
            activate_when: Some(reachedRoom(
                room: "front-entrance",
            )),
            finished_when: hasFlag(
                flag: "got-towel",
            ),
            failed_when: None,
        ),
        (
            id: "get-past-knight",
            name: "Get Past the Black Knight",
            description: "Find a way to appease the Black Knight to access the rest of the sublevel.",
            group: required,
            activate_when: Some(goalComplete(
                goal_id: "go-to-sublevel",
            )),
            finished_when: hasFlag(
                flag: "appeased-black-knight",
            ),
            failed_when: None,
        ),
        (
            id: "reach-aa3b",
            name: "Investigate Room AA-3B",
            description: "Figure out what\'s behind the mysterious sealed door.",
            group: required,
            activate_when: Some(hasFlag(
                flag: "entered-sublevel-1",
            )),
            finished_when: reachedRoom(
                room: "room-aa-3b",
            ),
            failed_when: None,
        ),
        (
            id: "go-to-sublevel",
            name: "Go Down to AA-3",
            description: "The elevator should now allow you down to sublevel AA-3, and the receptionist said you\'re expected in Room AA-3B for... orientation? Initiation? Obfuscation?",
            group: required,
            activate_when: Some(goalComplete(
                goal_id: "activate-elevator",
            )),
            finished_when: reachedRoom(
                room: "sublevel-1-entrance",
            ),
            failed_when: None,
        ),
        (
            id: "start-melting-plaque-2",
            name: "Melt the Ice Pillar",
            description: "The plaque on the pillar in the snowfield pit is encased in a thick sheet of ice. If you want to read it, you\'ll have to melt it somehow.",
            group: optional,
            activate_when: Some(hasFlag(
                flag: "tried-read-plaque-2",
            )),
            finished_when: hasFlag(
                flag: "campfire-lit",
            ),
            failed_when: None,
        ),
        (
            id: "wait-for-plaque-2-to-melt",
            name: "Wait for the Melt",
            description: "Your fire is working. Hopefully, it will keep burning long enough to melt the ice. You\'ll just have to wait to find out.",
            group: optional,
            activate_when: Some(goalComplete(
                goal_id: "start-melting-plaque-2",
            )),
            finished_when: flagComplete(
                flag: "reveal-ice-plaque",
            ),
            failed_when: None,
        ),
        (
            id: "read-plaque-2",
            name: "Bask in the Wisdom",
            description: "Your campfire kept going long enough, and the plaque in the snowfield ice pit has been revealed. Go and bask in its wisdom.",
            group: optional,
            activate_when: Some(goalComplete(
                goal_id: "wait-for-plaque-2-to-melt",
            )),
            finished_when: hasFlag(
                flag: "read-plaque-2",
            ),
            failed_when: None,
        ),
        (
            id: "clear-fallen-tree",
            name: "Clear the Path",
            description: "A fallen tree blocks the stairs continuing upward and there\'s no way around. There are a couple of different ways you could clear it.",
            group: required,
            activate_when: Some(reachedRoom(
                room: "two-sheds-landing",
            )),
            finished_when: hasFlag(
                flag: "cleared-fallen-tree",
            ),
            failed_when: None,
        ),
        (
            id: "get-oriented",
            name: "What the...?",
            description: "Look around and read the [[item]]scrawled note[[/item]] at [[room]]High Isolated Ridge[[/room]] to get some idea what you\'re doing here. Type \'help\' for some basic guidance.",
            group: optional,
            activate_when: None,
            finished_when: hasFlag(
                flag: "read-scrawled-note",
            ),
            failed_when: None,
        ),
        (
            id: "read-plaque-1",
            name: "Read the Plaque",
            description: "Find a way to clean off the [[item]]plaque[[/item]] by the [[room]]Parish Landing[[/room]], so you can read it.",
            group: optional,
            activate_when: Some(hasFlag(
                flag: "tried-read-plaque-1",
            )),
            finished_when: hasFlag(
                flag: "read-plaque-1",
            ),
            failed_when: None,
        ),
        (
            id: "find-hal-module-1",
            name: "Find HAL Module #1",
            description: "Look around and talk to other characters to figure out where to find HAL\'s first missing module.",
            group: required,
            activate_when: Some(flagInProgress(
                flag: "hal-reboot",
            )),
            finished_when: hasFlag(
                flag: "got-hint-from-emh",
            ),
            failed_when: None,
        ),
        (
            id: "get-hal-module-1",
            name: "Retrieve HAL Module #1",
            description: "The EMH has offered to help restore HAL, but only if you can repair and return his mobile emitter. Assist him and retrieve the first of HAL\'s memory modules.",
            group: required,
            activate_when: Some(flagInProgress(
                flag: "mobilize-emh",
            )),
            finished_when: hasItem(
                item: "hal_module_1",
            ),
            failed_when: None,
        ),
        (
            id: "insert-hal-module-1",
            name: "Insert HAL Module #1",
            description: "Once mobilized, the EMH was able to get the module for you. Insert it in the panel in the Observation room to advance HAL\'s reboot sequence.",
            group: required,
            activate_when: Some(goalComplete(
                goal_id: "get-hal-module-1",
            )),
            finished_when: hasFlag(
                flag: "module-1-inserted",
            ),
            failed_when: None,
        ),
        (
            id: "find-hal-module-2",
            name: "Find HAL Module #2",
            description: "Look around the building and talk to other characters to get a lead on the location of HAL Module #2.",
            group: required,
            activate_when: Some(flagInProgress(
                flag: "hal-reboot",
            )),
            finished_when: hasFlag(
                flag: "found-module-2",
            ),
            failed_when: None,
        ),
        (
            id: "get-hal-module-2",
            name: "Get HAL Module #2",
            description: "You found the module in the vending machine. Now you need to find a way to get it out.",
            group: required,
            activate_when: Some(goalComplete(
                goal_id: "find-hal-module-2",
            )),
            finished_when: hasItem(
                item: "hal_module_2",
            ),
            failed_when: None,
        ),
        (
            id: "insert-hal-module-2",
            name: "Insert HAL Module #2",
            description: "You were able to fish module #2 out of the crevice. Insert it into HAL\'s memory bank to continue rebooting -- if you\'re sure.",
            group: required,
            activate_when: Some(goalComplete(
                goal_id: "get-hal-module-2",
            )),
            finished_when: hasFlag(
                flag: "module-2-inserted",
            ),
            failed_when: None,
        ),
        (
            id: "reboot-hal",
            name: "Reactivate HAL-9000",
            description: "Install HAL\'s missing memory modules to the panel in the Observation Room to fully reactivate him.",
            group: required,
            activate_when: Some(reachedRoom(
                room: "monolith-room",
            )),
            finished_when: flagComplete(
                flag: "hal-reboot",
            ),
            failed_when: None,
        ),
        (
            id: "survive-vogon-poetry",
            name: "Survive the Vogon Experience",
            description: "Recover from reading the galaxy\'s third worst poem.",
            group: r#status-effect,
            activate_when: Some(hasFlag(
                flag: "read-vogon-poetry",
            )),
            finished_when: missingFlag(
                flag: "status:nauseated",
            ),
            failed_when: None,
        ),
        (
            id: "clear-sausage-breath",
            name: "Banish the Foul Breath",
            description: "Dibbler\'s Sausage-Inna-Bun has created the foulest of aftertastes and breath that could repel a horde. Find a way to fix it.",
            group: r#status-effect,
            activate_when: Some(hasFlag(
                flag: "ate-sausage",
            )),
            finished_when: missingFlag(
                flag: "status:bad-breath",
            ),
            failed_when: None,
        ),
    ],
)